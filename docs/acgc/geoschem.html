<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>acgc.geoschem API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../acgc.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;acgc</a>

            <img src="https://acgc.eoas.fsu.edu/wiki/_media/wiki/logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#mapweight1d">mapweight1d</a>
            </li>
            <li>
                    <a class="function" href="#regrid2d">regrid2d</a>
            </li>
            <li>
                    <a class="function" href="#regrid_plevels">regrid_plevels</a>
            </li>
            <li>
                    <a class="function" href="#lon2i">lon2i</a>
            </li>
            <li>
                    <a class="function" href="#lat2j">lat2j</a>
            </li>
            <li>
                    <a class="function" href="#ll2ij">ll2ij</a>
            </li>
            <li>
                    <a class="function" href="#get_lon">get_lon</a>
            </li>
            <li>
                    <a class="function" href="#get_lat">get_lat</a>
            </li>
            <li>
                    <a class="function" href="#get_lev_p">get_lev_p</a>
            </li>
            <li>
                    <a class="function" href="#get_lev_z">get_lev_z</a>
            </li>
            <li>
                    <a class="function" href="#get_hybrid_ab">get_hybrid_ab</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../acgc.html">acgc</a><wbr>.geoschem    </h1>

                        <div class="docstring"><p>Tools for indexing, remapping, interpolating GEOS-Chem grids</p>
</div>

                        <input id="mod-geoschem-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-geoschem-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">&quot;&quot;&quot;Tools for indexing, remapping, interpolating GEOS-Chem grids</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1"># from numba import jit</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1"># @jit(nopython=True)</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="k">def</span> <span class="nf">mapweight1d</span><span class="p">(</span> <span class="n">edge1</span><span class="p">,</span> <span class="n">edge2</span><span class="p">,</span> <span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Calculate mapping weights from source grid with edge1 to destination grid with edge2</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    </span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    Parameters</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    ----------</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    edge1 : array (n,)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">        source grid edge coordinates</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    edge2 : array (m,)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">        destination grid edge coordinates</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">    edgelump : bool, default=True)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">        edgelump only affects situations where the source grid covers a larger domain </span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        than the destination grid (i.e. min(edge1)&lt;min(edge2) or max(edge1)&gt;max(edge2) ).</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">        If True, enforce total mass conservation in mapping weights by lumping excess mass </span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">        in source grid into the corresponding end of destination grid.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">        If False, the mass is conserved in the overlapping domains, but some total mass</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">        can be lost due to difference in overall domain.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    Returns</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    -------</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    weight : array (m,n)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        mapping weights from source to destination grid: new = np.dot(weight,old)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="c1"># Check if the input pedge1 are inceasing</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="k">pass</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;decreasing edge1 values not implemented&#39;</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="n">edge1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">edge1</span> <span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input edge1 must be sorted &#39;</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="c1"># Check if the output edges are increasing</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="k">pass</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;decreasing edge2 values not implemented&#39;</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">edge2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">edge2</span> <span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input edge2 must be sorted &#39;</span><span class="p">)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="c1"># Interpolate pedge2 into pedge1</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="n">idx21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span> <span class="n">edge2</span><span class="p">,</span> <span class="n">edge1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge1</span><span class="p">))</span> <span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="c1"># If the pedge1 max or min are outside pedge2, then make sure the</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="c1"># edges go into the end levels</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="k">if</span> <span class="n">edgelump</span><span class="p">:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="c1"># Empty array for result</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="k">for</span> <span class="n">iNew</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="k">for</span> <span class="n">iOld</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="c1"># Concise version</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>            <span class="n">weight</span><span class="p">[</span><span class="n">iNew</span><span class="p">,</span><span class="n">iOld</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">iOld</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="p">],</span><span class="n">iOld</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="k">return</span> <span class="n">weight</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="k">def</span> <span class="nf">regrid2d</span><span class="p">(</span> <span class="n">array1</span><span class="p">,</span> <span class="n">xe1</span><span class="p">,</span> <span class="n">ye1</span><span class="p">,</span> <span class="n">xe2</span><span class="p">,</span> <span class="n">ye2</span><span class="p">,</span> <span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Mass-conserving remapping of data between regular x-y or lat-lon grids</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">    Parameters</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    ----------</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    array1 : array (n,m)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        input data. Quantities should be extensive (e.g. mass, not mixing ratio).</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    xe1 : array (n+1,)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        source grid edges in x dimension, e.g. longitude</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    ye1 : array (m+1,)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        source grid edges in y dimension, e.g. latitude</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    xe2 : array (p+1,)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        destination grid edges in x dimension, e.g. longitude</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    ye2 : array (q+1,)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        destination grid edges in y dimension, e.g. latitude</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    edgelump : bool, default=True</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        edgelump only affects situations where the source grid covers a larger domain </span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        than the destination grid (i.e. min(edge1)&lt;min(edge2) or max(edge1)&gt;max(edge2) ).</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        If True, enforce total mass conservation in mapping weights by lumping excess mass </span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        in source grid into the corresponding end of destination grid.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        If False, the mass is conserved in the overlapping domains, but some total mass</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        can be lost due to difference in overall domain.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">    Returns</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    -------</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    outarray : array (p,q)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        input data remapped to the destination grid</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="c1"># Sizes</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="n">insize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="n">nxe1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xe1</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="n">nye1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ye1</span><span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="n">nxe2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xe2</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>    <span class="n">nye2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ye2</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="c1"># Ensure arrays conform</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">insize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;array1 must be 2D&#39;</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="k">if</span> <span class="n">insize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nxe1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;xe1 must match size of array1&#39;</span> <span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="k">if</span> <span class="n">insize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nye1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;ye1 must match size of array1&#39;</span> <span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="c1"># Regridding weight matrices</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="n">weightY</span> <span class="o">=</span> <span class="n">mapweight1d</span><span class="p">(</span><span class="n">ye1</span><span class="p">,</span> <span class="n">ye2</span><span class="p">,</span> <span class="n">edgelump</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="n">weightX</span> <span class="o">=</span> <span class="n">mapweight1d</span><span class="p">(</span><span class="n">xe1</span><span class="p">,</span> <span class="n">xe2</span><span class="p">,</span> <span class="n">edgelump</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="c1"># Size of temporary and output arrays</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="n">tmpsize</span> <span class="o">=</span> <span class="p">[</span><span class="n">nye2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nxe1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="n">outsize</span> <span class="o">=</span> <span class="p">[</span><span class="n">nye2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nxe2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="c1"># Temporary array</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="n">a1b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span> <span class="n">tmpsize</span> <span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="n">a1b</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="c1"># Output array</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="n">outarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">outsize</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="n">outarray</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="c1"># Regrid latitude</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xe1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">a1b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">weightY</span><span class="p">,</span> <span class="n">array1</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="c1"># Regrid longitude</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="n">outarray</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">weightX</span><span class="p">,</span> <span class="n">a1b</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    <span class="k">return</span> <span class="n">outarray</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="c1"># @jit(nopython=True)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="k">def</span> <span class="nf">regrid_plevels</span><span class="p">(</span> <span class="n">array1</span><span class="p">,</span> <span class="n">pedge1</span><span class="p">,</span> <span class="n">pedge2</span><span class="p">,</span> <span class="n">intensive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39; Mass-conserving regridding of data on pressure levels</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    Data from the input array will be remapped to the output pressure levels while </span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">    conserving total mass.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">    Parameters</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">    ----------</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">    array1 : array, (p,)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        Array of data that will be remapped.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        Quantities should be extensive (e.g. mass, not mixing ratio) unless the </span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        intensive keyword is used.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">    pedge1 : array (p+1,)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        Pressure edges of the input array1. The length of pedge1 should be one greater than array1. </span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        The element array1[i] is bounded by edges pedge1[i], pedge1[i+1]</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">    pedge2 : array (q+1,)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        Pressure edges of the desired output array.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">    intensive : bool, default=False</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        If True, then array1 will be treated as an intensive quantity (e.g mole fraction, </span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        mixing ratio) during regridding. Each element array1[i] will be multiplied by </span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        (pedge1[i]-pedge[i+1]), which is proportional to airmass if pedge1 is pressure, </span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        before regridding. The output array2, will similarly be dividied by (pedge2[i]-pedge[i+1]) </span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        so that the output is also intensive. </span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        By default, intensive=False is used and the input array is assumed to be extensive.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">    edgelump : bool, default=True </span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        If the max or min of pedge1 extend beyond the max or min of pedge2 and edgelump=True, </span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        the mass will be placed in in the first or last grid level of the output array2, </span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        ensuring that the mass of array2 is the same as array1. </span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        If edgelump=False, then the mass of array2 can be less than array1.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">    Returns</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">    array2 : array (q,)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        Array of remapped data. The length of array2 will be one less than pedge2.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pedge1 must have size len(array1)+1&quot;</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="c1"># Check if the input pedge1 are inceasing</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">pass</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">array1</span> <span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">pedge1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">pedge1</span> <span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input pedge1 must be sorted &#39;</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>    <span class="c1"># Check if the output edges are increasing </span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">pass</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="n">pedge2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">pedge2</span> <span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input pedge2 must be sorted &#39;</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>    <span class="c1"># If input is an intensive quantity, then multiply by the pressure grid spacing</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    <span class="k">if</span> <span class="n">intensive</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="n">array1</span> <span class="o">=</span> <span class="n">array1</span> <span class="o">*</span> <span class="p">(</span> <span class="n">pedge1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">pedge1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="c1"># Interpolate pedge2 into pedge1</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="n">idx21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span> <span class="n">pedge2</span><span class="p">,</span> <span class="n">pedge1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pedge1</span><span class="p">))</span> <span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>    <span class="c1"># If the pedge1 max or min are outside pedge2, then make sure the </span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="c1"># edges go into the end levels</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="k">if</span> <span class="n">edgelump</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>  
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="c1"># Empty array for result</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="n">array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">pedge2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array2</span><span class="p">)):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="c1"># Concise version</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="n">array2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">array1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="c1"># Lengthy version</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="c1">#if ( j &gt;= idx21[i] and j+1 &lt;= idx21[i+1] ):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="c1">#    array2[i] += array1[j]</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="c1">#    #print( &#39;input level {:d} inside output level {:d}&#39;.format(j,i))</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="c1">#elif ( j &lt; idx21[i] and j+1 &gt; idx21[i+1] ):</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="c1">#    array2[i] += array1[j] * (idx21[i+1] - idx21[i])</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>            <span class="c1">#    #print( &#39;output level inside input level&#39;)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="c1">#elif ( j &lt; idx21[i] ):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="c1">#    array2[i] +=  array1[j] * (1 - np.mod(idx21[i],  1)) </span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="c1">#    #print( &#39;input level {:d} at bottom of output level {:d}&#39;.format(j,i))</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="c1">#elif ( j+1 &gt; idx21[i+1] ):</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="c1">#    array2[i] += array1[j] * np.mod( idx21[i+1], 1)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="c1">#    #print( &#39;input level {:d} at top of output level {:d}&#39;.format(j,i))</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="c1">#else:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="c1">#    raise NotImplemented</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>    <span class="c1"># Convert back to an intensive quantity, if necessary</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">if</span> <span class="n">intensive</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">array2</span> <span class="o">=</span> <span class="n">array2</span> <span class="o">/</span> <span class="p">(</span> <span class="n">pedge2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">pedge2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="c1"># Reverse the output array, if necessary</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">array2</span> <span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="k">return</span> <span class="n">array2</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="k">def</span> <span class="nf">_set_center_edge</span><span class="p">(</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Resolve any conflict between center and edge keywords</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">    </span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">    Arguments</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">    ---------</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">    center : bool or None</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">    edge   : bool or None</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">    name : str</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        name of the calling function, only used in error messages</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">    </span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">    Returns</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">    -------</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">    center, edge : bool</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        consistent values: one True and the other False</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">edge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="c1"># If both center and edge are None, default to center</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="n">edge</span>   <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>    <span class="k">elif</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="c1"># Use edge, if that value is boolean</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">center</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">edge</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;: edge must be boolean or None&#39;</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>    <span class="k">elif</span> <span class="n">edge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="c1"># Use center, if that value is boolean</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">edge</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">center</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;: center must be boolean or None&#39;</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="c1"># If both are True or both are False, then raise error</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">if</span> <span class="p">(</span> <span class="p">((</span><span class="n">center</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span>  <span class="ow">and</span> <span class="p">(</span><span class="n">edge</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">))</span> <span class="ow">or</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>             <span class="p">((</span><span class="n">center</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">edge</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">))</span> <span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="c1"># If both center and edge are specified, then raise error</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;: Choose either edge=True or center=True&#39;</span> <span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="c1"># At this point, either center=True or edge=True, but not both</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="c1"># Values aren&#39;t boolean</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;: center and edge must be boolean or None&#39;</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="k">def</span> <span class="nf">lon2i</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Find I grid index for longitude</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">    Parameters</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">    ----------</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    lon : float</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        longitude in degrees</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">    res : float, default=4</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        resolution of grid. See `get_lon` for allowed values</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">    Result</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">    ------</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">    index : int</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        grid index location closest to longitude</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="c1"># Put longitude in expected GC the range [-180,180]</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="n">alon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="n">longrid</span> <span class="o">=</span> <span class="n">get_lon</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="n">nlon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">longrid</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">longrid</span><span class="p">,</span><span class="n">longrid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">360</span><span class="p">),</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlon</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">alon</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="k">def</span> <span class="nf">lat2j</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Find J grid index for latitude</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">    Parameters</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">    ----------</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">    lat : float</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        latitude in degrees</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    res : float, default=4</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        resolution of grid. See `get_lon` for allowed values</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">    Result</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">    ------</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">    index : int</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">        grid index location closest to latitude</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>    <span class="n">alat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="n">latgrid</span> <span class="o">=</span> <span class="n">get_lat</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>    <span class="n">nlat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">latgrid</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">alat</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">alat</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">)):</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lat must be in the range [-90,90]&#39;</span><span class="p">)</span>    
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">latgrid</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlat</span><span class="p">),</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">alat</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="k">def</span> <span class="nf">ll2ij</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Find (I,J) grid index for longitude, latitude</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">    Parameters</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">    ----------</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">    lon, lat : float</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        longitude and latitude in degrees</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">    res : float, default=4</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        resolution of grid. See `get_lon` for allowed values</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">    Result</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">    ------</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">    i, j : int</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        grid index location closest to longitude, latitude</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="n">alon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="n">alat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="n">nlon</span> <span class="o">=</span> <span class="n">alon</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="n">nlat</span> <span class="o">=</span> <span class="n">alat</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nlon</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nlat</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">alon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">alat</span><span class="p">)</span> <span class="o">*</span> <span class="n">alon</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="k">elif</span> <span class="p">(</span><span class="n">nlat</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nlon</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="n">alat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">alon</span><span class="p">)</span> <span class="o">*</span> <span class="n">alat</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="k">elif</span> <span class="n">nlon</span> <span class="o">!=</span> <span class="n">nlat</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon and lat must have the same length or be conformable&#39;</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>    <span class="k">return</span> <span class="n">lon2i</span><span class="p">(</span><span class="n">alon</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">),</span> <span class="n">lat2j</span><span class="p">(</span><span class="n">alat</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="k">def</span> <span class="nf">get_lon</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get array of longitudes for grid centers or edges. </span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">    GMAO grids assumed</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">    - res = 0.5 for 0.5x0.625</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">    - res = 2 for 2x2.5</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">    - res = 4 for 4x5</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">    Parameters</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">    ----------</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">    res : float, default=4</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        latitude resolution of grid</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">    center, edge : bool or None, default=None</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        determines whether returned values are at grid center (center=True) or grid edge (edge=True)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        If both center and edge are None, then center is used</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">    Returns</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">    -------</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">    lon : array (n,)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        longitude in degrees at grid center or edges</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>    <span class="c1"># Resolve any conflict between center and edge</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="n">center</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">_set_center_edge</span><span class="p">(</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;get_lon&#39;</span> <span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="c1"># Longitude edges</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>    <span class="k">if</span> <span class="n">res</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="n">dx</span><span class="o">=</span><span class="mf">2.5</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="n">dx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="n">dx</span><span class="o">=</span><span class="mf">0.625</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span> <span class="s1">&#39;Resolution &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is not defined&#39;</span> <span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>    <span class="c1"># Longitude edges</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>    <span class="n">lonedge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">-</span> <span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="c1"># Get grid centers, if needed</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">lon</span> <span class="o">=</span> <span class="p">(</span> <span class="n">lonedge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lonedge</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">lon</span> <span class="o">=</span> <span class="n">lonedge</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>    <span class="k">return</span> <span class="n">lon</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="k">def</span> <span class="nf">get_lat</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get array of latitudes at grid center or edges</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">    GMAO grids assumed</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">    - res = 0.5 for 0.5x0.625</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">    - res = 2 for 2x2.5</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">    - res = 4 for 4x5</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">    Parameters</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">    ----------</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">    res : float, default=4</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        latitude resolution of grid</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">    center, edge : bool or None, default=None</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        determines whether returned values are at grid center (center=True) or grid edge (edge=True)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        If both center and edge are None, then center is used</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">    Returns</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    -------</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">    lat : array (n,)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        latitude in degrees at grid center or edges</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>    <span class="c1"># Resolve any conflict between center and edge</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="n">center</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">_set_center_edge</span><span class="p">(</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;get_lat&#39;</span> <span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="c1"># Latitude edges</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>    <span class="k">if</span> <span class="n">res</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="n">dy</span><span class="o">=</span><span class="mi">2</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="n">dy</span><span class="o">=</span><span class="mi">4</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">dy</span><span class="o">=</span><span class="mf">0.5</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span> <span class="s1">&#39;Resolution &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is not defined&#39;</span> <span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="c1"># Latitude edges</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="n">latedge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="o">+</span><span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="n">dy</span><span class="p">),</span> <span class="mi">90</span><span class="p">]</span> <span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="c1"># Get grid centers, if needed</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="p">(</span> <span class="n">latedge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">latedge</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="n">latedge</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>    <span class="k">return</span> <span class="n">lat</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="k">def</span> <span class="nf">get_lev_p</span><span class="p">(</span><span class="n">p_surf</span><span class="o">=</span><span class="mf">1013.25</span><span class="p">,</span> <span class="n">nlev</span><span class="o">=</span><span class="mi">47</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get array of pressures at grid centers or edges</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">    </span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">    Parameters</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">    ----------</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">    p_surf : float</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        surface pressure, hPa</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">    nlev : {47,72}</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        number of vertical levels (47 or 72)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">    edge : bool</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        specify edges (True) or centers (False, default)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">        </span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">    Returns</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">    -------</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">    p : array of float</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">        pressures for each vertical level&#39;&#39;&#39;</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>    <span class="c1"># Get A,B values for vertical coordinate</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">get_hybrid_ab</span><span class="p">(</span><span class="n">nlev</span><span class="o">=</span><span class="n">nlev</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">edge</span> <span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>    <span class="c1"># Pressure, hPa</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">p_surf</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>    <span class="k">return</span> <span class="n">P</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="c1"># @jit(nopython=True)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="k">def</span> <span class="nf">get_lev_z</span><span class="p">(</span><span class="n">TK</span><span class="o">=</span><span class="p">[</span><span class="mi">273</span><span class="p">],</span> <span class="n">p_surf</span><span class="o">=</span><span class="mf">1013.25</span><span class="p">,</span> <span class="n">p_edge</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_surf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Calculate the geopotential heights of level edges or centers</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">    Calculations use hypsometric equation, assuing hydrostatic balance</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">    Parameters</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">    ----------</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">    TK : array of float</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">        Temperature for each grid level, K</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">    p_surf : float</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        Surface pressure, hPa</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">    p_edge : array of float, optional</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        Pressure at each grid level edge, hPa</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        Will be calculated if length differs from TK</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">    Q : array of float</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        Specific humidity for each grid level, kg/kg </span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">    z_surf : float</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        Surface altitude, m</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">    edge : bool</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">        specify edges (True) or centers (False, default) for output</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">    Returns</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">    -------</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">    z : array of float</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">        Geopotential height for each grid edge or center, m</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>    <span class="n">funname</span><span class="o">=</span><span class="s1">&#39;geoschem: get_lev_z: &#39;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="c1"># Acceleration due to gravity, m/s2</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>    <span class="n">g0</span> <span class="o">=</span> <span class="mf">9.81</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TK</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">funname</span><span class="p">,</span><span class="s1">&#39;TK must be an array&#39;</span><span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>    <span class="c1"># Number of levels in the temperature profile</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>    <span class="n">nlev</span> <span class="o">=</span> <span class="n">TK</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>    <span class="c1"># Calculate the pressure edges if they aren&#39;t provided in input</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_edge</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nlev</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="c1"># Get pressure at level edges, hPa</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="n">p_edge</span> <span class="o">=</span> <span class="n">get_lev_p</span><span class="p">(</span><span class="n">p_surf</span><span class="o">=</span><span class="n">p_surf</span><span class="p">,</span> <span class="n">nlev</span><span class="o">=</span><span class="n">nlev</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>    <span class="c1"># Initialize array</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>    <span class="n">z_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p_edge</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>    <span class="n">z_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_surf</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>    <span class="c1"># Virtual temperature, K</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>    <span class="n">Tv</span> <span class="o">=</span> <span class="n">TK</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.61</span> <span class="o">*</span> <span class="n">Q</span> <span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>    <span class="c1"># Calculate altitudes with hypsometric equation, m</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>    <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_edge</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="n">z_edge</span><span class="p">[</span><span class="n">L</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_edge</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">287</span> <span class="o">*</span> <span class="n">Tv</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">g0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">p_edge</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">p_edge</span><span class="p">[</span><span class="n">L</span><span class="p">]</span> <span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>    <span class="c1"># Choose grid edge or center altitudes, m</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>    <span class="k">if</span> <span class="n">edge</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">z_edge</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">z_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>    <span class="k">return</span> <span class="n">z</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="k">def</span> <span class="nf">get_hybrid_ab</span><span class="p">(</span><span class="n">nlev</span><span class="o">=</span><span class="mi">47</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get A and B values for the GEOS-5/MERRA/MERRA2 hybrid sigma-pressure vertical coordinate.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">    The pressure at level edge L is P(L) = A(L) + B(L) * PS, where PS is surface pressure in hPa</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">    Parameters</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">    ----------</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">    nlev : {47,72}</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">        number of levels in the desired grid (47 or 72)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">    center, edge : bool</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">        specify if values for level center or edges are desired</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">    Returns </span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">    -------</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">    A, B : array (n,)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>    <span class="c1"># Resolve any conflict between center and edge requests</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>    <span class="n">center</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">_set_center_edge</span><span class="p">(</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;get_hybrid_ab&#39;</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>    <span class="k">if</span> <span class="n">nlev</span> <span class="o">==</span> <span class="mi">47</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>        <span class="c1"># A [hPa] for 47 levels (48 edges)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">4.804826E-02</span><span class="p">,</span> <span class="mf">6.593752E+00</span><span class="p">,</span> <span class="mf">1.313480E+01</span><span class="p">,</span> 
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>               <span class="mf">1.961311E+01</span><span class="p">,</span> <span class="mf">2.609201E+01</span><span class="p">,</span> <span class="mf">3.257081E+01</span><span class="p">,</span> <span class="mf">3.898201E+01</span><span class="p">,</span> 
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>               <span class="mf">4.533901E+01</span><span class="p">,</span> <span class="mf">5.169611E+01</span><span class="p">,</span> <span class="mf">5.805321E+01</span><span class="p">,</span> <span class="mf">6.436264E+01</span><span class="p">,</span> 
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>               <span class="mf">7.062198E+01</span><span class="p">,</span> <span class="mf">7.883422E+01</span><span class="p">,</span> <span class="mf">8.909992E+01</span><span class="p">,</span> <span class="mf">9.936521E+01</span><span class="p">,</span> 
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>               <span class="mf">1.091817E+02</span><span class="p">,</span> <span class="mf">1.189586E+02</span><span class="p">,</span> <span class="mf">1.286959E+02</span><span class="p">,</span> <span class="mf">1.429100E+02</span><span class="p">,</span> 
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>               <span class="mf">1.562600E+02</span><span class="p">,</span> <span class="mf">1.696090E+02</span><span class="p">,</span> <span class="mf">1.816190E+02</span><span class="p">,</span> <span class="mf">1.930970E+02</span><span class="p">,</span> 
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>               <span class="mf">2.032590E+02</span><span class="p">,</span> <span class="mf">2.121500E+02</span><span class="p">,</span> <span class="mf">2.187760E+02</span><span class="p">,</span> <span class="mf">2.238980E+02</span><span class="p">,</span> 
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>               <span class="mf">2.243630E+02</span><span class="p">,</span> <span class="mf">2.168650E+02</span><span class="p">,</span> <span class="mf">2.011920E+02</span><span class="p">,</span> <span class="mf">1.769300E+02</span><span class="p">,</span> 
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>               <span class="mf">1.503930E+02</span><span class="p">,</span> <span class="mf">1.278370E+02</span><span class="p">,</span> <span class="mf">1.086630E+02</span><span class="p">,</span> <span class="mf">9.236572E+01</span><span class="p">,</span> 
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>               <span class="mf">7.851231E+01</span><span class="p">,</span> <span class="mf">5.638791E+01</span><span class="p">,</span> <span class="mf">4.017541E+01</span><span class="p">,</span> <span class="mf">2.836781E+01</span><span class="p">,</span> 
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>               <span class="mf">1.979160E+01</span><span class="p">,</span> <span class="mf">9.292942E+00</span><span class="p">,</span> <span class="mf">4.076571E+00</span><span class="p">,</span> <span class="mf">1.650790E+00</span><span class="p">,</span> 
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>               <span class="mf">6.167791E-01</span><span class="p">,</span> <span class="mf">2.113490E-01</span><span class="p">,</span> <span class="mf">6.600001E-02</span><span class="p">,</span> <span class="mf">1.000000E-02</span> <span class="p">]</span> <span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="c1"># Bp [unitless] for 47 levels (48 edges)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.000000E+00</span><span class="p">,</span> <span class="mf">9.849520E-01</span><span class="p">,</span> <span class="mf">9.634060E-01</span><span class="p">,</span> <span class="mf">9.418650E-01</span><span class="p">,</span> 
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>               <span class="mf">9.203870E-01</span><span class="p">,</span> <span class="mf">8.989080E-01</span><span class="p">,</span> <span class="mf">8.774290E-01</span><span class="p">,</span> <span class="mf">8.560180E-01</span><span class="p">,</span> 
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>               <span class="mf">8.346609E-01</span><span class="p">,</span> <span class="mf">8.133039E-01</span><span class="p">,</span> <span class="mf">7.919469E-01</span><span class="p">,</span> <span class="mf">7.706375E-01</span><span class="p">,</span> 
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>               <span class="mf">7.493782E-01</span><span class="p">,</span> <span class="mf">7.211660E-01</span><span class="p">,</span> <span class="mf">6.858999E-01</span><span class="p">,</span> <span class="mf">6.506349E-01</span><span class="p">,</span> 
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>               <span class="mf">6.158184E-01</span><span class="p">,</span> <span class="mf">5.810415E-01</span><span class="p">,</span> <span class="mf">5.463042E-01</span><span class="p">,</span> <span class="mf">4.945902E-01</span><span class="p">,</span> 
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>               <span class="mf">4.437402E-01</span><span class="p">,</span> <span class="mf">3.928911E-01</span><span class="p">,</span> <span class="mf">3.433811E-01</span><span class="p">,</span> <span class="mf">2.944031E-01</span><span class="p">,</span> 
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>               <span class="mf">2.467411E-01</span><span class="p">,</span> <span class="mf">2.003501E-01</span><span class="p">,</span> <span class="mf">1.562241E-01</span><span class="p">,</span> <span class="mf">1.136021E-01</span><span class="p">,</span> 
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>               <span class="mf">6.372006E-02</span><span class="p">,</span> <span class="mf">2.801004E-02</span><span class="p">,</span> <span class="mf">6.960025E-03</span><span class="p">,</span> <span class="mf">8.175413E-09</span><span class="p">,</span> 
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span> <span class="p">]</span> <span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>    <span class="k">elif</span> <span class="n">nlev</span> <span class="o">==</span> <span class="mi">72</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="c1"># A [hPa] for 72 levels (73 edges)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">4.804826E-02</span><span class="p">,</span> <span class="mf">6.593752E+00</span><span class="p">,</span> <span class="mf">1.313480E+01</span><span class="p">,</span> 
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>               <span class="mf">1.961311E+01</span><span class="p">,</span> <span class="mf">2.609201E+01</span><span class="p">,</span> <span class="mf">3.257081E+01</span><span class="p">,</span> <span class="mf">3.898201E+01</span><span class="p">,</span> 
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>               <span class="mf">4.533901E+01</span><span class="p">,</span> <span class="mf">5.169611E+01</span><span class="p">,</span> <span class="mf">5.805321E+01</span><span class="p">,</span> <span class="mf">6.436264E+01</span><span class="p">,</span> 
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>               <span class="mf">7.062198E+01</span><span class="p">,</span> <span class="mf">7.883422E+01</span><span class="p">,</span> <span class="mf">8.909992E+01</span><span class="p">,</span> <span class="mf">9.936521E+01</span><span class="p">,</span> 
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>               <span class="mf">1.091817E+02</span><span class="p">,</span> <span class="mf">1.189586E+02</span><span class="p">,</span> <span class="mf">1.286959E+02</span><span class="p">,</span> <span class="mf">1.429100E+02</span><span class="p">,</span> 
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>               <span class="mf">1.562600E+02</span><span class="p">,</span> <span class="mf">1.696090E+02</span><span class="p">,</span> <span class="mf">1.816190E+02</span><span class="p">,</span> <span class="mf">1.930970E+02</span><span class="p">,</span> 
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>               <span class="mf">2.032590E+02</span><span class="p">,</span> <span class="mf">2.121500E+02</span><span class="p">,</span> <span class="mf">2.187760E+02</span><span class="p">,</span> <span class="mf">2.238980E+02</span><span class="p">,</span> 
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>               <span class="mf">2.243630E+02</span><span class="p">,</span> <span class="mf">2.168650E+02</span><span class="p">,</span> <span class="mf">2.011920E+02</span><span class="p">,</span> <span class="mf">1.769300E+02</span><span class="p">,</span> 
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>               <span class="mf">1.503930E+02</span><span class="p">,</span> <span class="mf">1.278370E+02</span><span class="p">,</span> <span class="mf">1.086630E+02</span><span class="p">,</span> <span class="mf">9.236572E+01</span><span class="p">,</span> 
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>               <span class="mf">7.851231E+01</span><span class="p">,</span> <span class="mf">6.660341E+01</span><span class="p">,</span> <span class="mf">5.638791E+01</span><span class="p">,</span> <span class="mf">4.764391E+01</span><span class="p">,</span> 
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>               <span class="mf">4.017541E+01</span><span class="p">,</span> <span class="mf">3.381001E+01</span><span class="p">,</span> <span class="mf">2.836781E+01</span><span class="p">,</span> <span class="mf">2.373041E+01</span><span class="p">,</span> 
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>               <span class="mf">1.979160E+01</span><span class="p">,</span> <span class="mf">1.645710E+01</span><span class="p">,</span> <span class="mf">1.364340E+01</span><span class="p">,</span> <span class="mf">1.127690E+01</span><span class="p">,</span> 
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>               <span class="mf">9.292942E+00</span><span class="p">,</span> <span class="mf">7.619842E+00</span><span class="p">,</span> <span class="mf">6.216801E+00</span><span class="p">,</span> <span class="mf">5.046801E+00</span><span class="p">,</span> 
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>               <span class="mf">4.076571E+00</span><span class="p">,</span> <span class="mf">3.276431E+00</span><span class="p">,</span> <span class="mf">2.620211E+00</span><span class="p">,</span> <span class="mf">2.084970E+00</span><span class="p">,</span> 
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>               <span class="mf">1.650790E+00</span><span class="p">,</span> <span class="mf">1.300510E+00</span><span class="p">,</span> <span class="mf">1.019440E+00</span><span class="p">,</span> <span class="mf">7.951341E-01</span><span class="p">,</span> 
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>               <span class="mf">6.167791E-01</span><span class="p">,</span> <span class="mf">4.758061E-01</span><span class="p">,</span> <span class="mf">3.650411E-01</span><span class="p">,</span> <span class="mf">2.785261E-01</span><span class="p">,</span> 
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>               <span class="mf">2.113490E-01</span><span class="p">,</span> <span class="mf">1.594950E-01</span><span class="p">,</span> <span class="mf">1.197030E-01</span><span class="p">,</span> <span class="mf">8.934502E-02</span><span class="p">,</span> 
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>               <span class="mf">6.600001E-02</span><span class="p">,</span> <span class="mf">4.758501E-02</span><span class="p">,</span> <span class="mf">3.270000E-02</span><span class="p">,</span> <span class="mf">2.000000E-02</span><span class="p">,</span> 
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>               <span class="mf">1.000000E-02</span> <span class="p">]</span> <span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>        <span class="c1"># B [unitless] for 72 levels (73 edges)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.000000E+00</span><span class="p">,</span> <span class="mf">9.849520E-01</span><span class="p">,</span> <span class="mf">9.634060E-01</span><span class="p">,</span> <span class="mf">9.418650E-01</span><span class="p">,</span> 
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>               <span class="mf">9.203870E-01</span><span class="p">,</span> <span class="mf">8.989080E-01</span><span class="p">,</span> <span class="mf">8.774290E-01</span><span class="p">,</span> <span class="mf">8.560180E-01</span><span class="p">,</span> 
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>               <span class="mf">8.346609E-01</span><span class="p">,</span> <span class="mf">8.133039E-01</span><span class="p">,</span> <span class="mf">7.919469E-01</span><span class="p">,</span> <span class="mf">7.706375E-01</span><span class="p">,</span> 
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>               <span class="mf">7.493782E-01</span><span class="p">,</span> <span class="mf">7.211660E-01</span><span class="p">,</span> <span class="mf">6.858999E-01</span><span class="p">,</span> <span class="mf">6.506349E-01</span><span class="p">,</span> 
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>               <span class="mf">6.158184E-01</span><span class="p">,</span> <span class="mf">5.810415E-01</span><span class="p">,</span> <span class="mf">5.463042E-01</span><span class="p">,</span> <span class="mf">4.945902E-01</span><span class="p">,</span> 
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>               <span class="mf">4.437402E-01</span><span class="p">,</span> <span class="mf">3.928911E-01</span><span class="p">,</span> <span class="mf">3.433811E-01</span><span class="p">,</span> <span class="mf">2.944031E-01</span><span class="p">,</span> 
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>               <span class="mf">2.467411E-01</span><span class="p">,</span> <span class="mf">2.003501E-01</span><span class="p">,</span> <span class="mf">1.562241E-01</span><span class="p">,</span> <span class="mf">1.136021E-01</span><span class="p">,</span> 
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>               <span class="mf">6.372006E-02</span><span class="p">,</span> <span class="mf">2.801004E-02</span><span class="p">,</span> <span class="mf">6.960025E-03</span><span class="p">,</span> <span class="mf">8.175413E-09</span><span class="p">,</span> 
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>               <span class="mf">0.000000E+00</span> <span class="p">])</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;get_hybrid_ab: A, B not defined for nlev=</span><span class="si">{</span><span class="n">nlev</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>    <span class="c1"># Calculate values at level center</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>    <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span>
</span></pre></div>


            </section>
                <section id="mapweight1d">
                            <input id="mapweight1d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mapweight1d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">edge1</span>, </span><span class="param"><span class="n">edge2</span>, </span><span class="param"><span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mapweight1d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mapweight1d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mapweight1d-12"><a href="#mapweight1d-12"><span class="linenos">12</span></a><span class="k">def</span> <span class="nf">mapweight1d</span><span class="p">(</span> <span class="n">edge1</span><span class="p">,</span> <span class="n">edge2</span><span class="p">,</span> <span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="mapweight1d-13"><a href="#mapweight1d-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Calculate mapping weights from source grid with edge1 to destination grid with edge2</span>
</span><span id="mapweight1d-14"><a href="#mapweight1d-14"><span class="linenos">14</span></a><span class="sd">    </span>
</span><span id="mapweight1d-15"><a href="#mapweight1d-15"><span class="linenos">15</span></a><span class="sd">    Parameters</span>
</span><span id="mapweight1d-16"><a href="#mapweight1d-16"><span class="linenos">16</span></a><span class="sd">    ----------</span>
</span><span id="mapweight1d-17"><a href="#mapweight1d-17"><span class="linenos">17</span></a><span class="sd">    edge1 : array (n,)</span>
</span><span id="mapweight1d-18"><a href="#mapweight1d-18"><span class="linenos">18</span></a><span class="sd">        source grid edge coordinates</span>
</span><span id="mapweight1d-19"><a href="#mapweight1d-19"><span class="linenos">19</span></a><span class="sd">    edge2 : array (m,)</span>
</span><span id="mapweight1d-20"><a href="#mapweight1d-20"><span class="linenos">20</span></a><span class="sd">        destination grid edge coordinates</span>
</span><span id="mapweight1d-21"><a href="#mapweight1d-21"><span class="linenos">21</span></a><span class="sd">    edgelump : bool, default=True)</span>
</span><span id="mapweight1d-22"><a href="#mapweight1d-22"><span class="linenos">22</span></a><span class="sd">        edgelump only affects situations where the source grid covers a larger domain </span>
</span><span id="mapweight1d-23"><a href="#mapweight1d-23"><span class="linenos">23</span></a><span class="sd">        than the destination grid (i.e. min(edge1)&lt;min(edge2) or max(edge1)&gt;max(edge2) ).</span>
</span><span id="mapweight1d-24"><a href="#mapweight1d-24"><span class="linenos">24</span></a><span class="sd">        If True, enforce total mass conservation in mapping weights by lumping excess mass </span>
</span><span id="mapweight1d-25"><a href="#mapweight1d-25"><span class="linenos">25</span></a><span class="sd">        in source grid into the corresponding end of destination grid.</span>
</span><span id="mapweight1d-26"><a href="#mapweight1d-26"><span class="linenos">26</span></a><span class="sd">        If False, the mass is conserved in the overlapping domains, but some total mass</span>
</span><span id="mapweight1d-27"><a href="#mapweight1d-27"><span class="linenos">27</span></a><span class="sd">        can be lost due to difference in overall domain.</span>
</span><span id="mapweight1d-28"><a href="#mapweight1d-28"><span class="linenos">28</span></a>
</span><span id="mapweight1d-29"><a href="#mapweight1d-29"><span class="linenos">29</span></a><span class="sd">    Returns</span>
</span><span id="mapweight1d-30"><a href="#mapweight1d-30"><span class="linenos">30</span></a><span class="sd">    -------</span>
</span><span id="mapweight1d-31"><a href="#mapweight1d-31"><span class="linenos">31</span></a><span class="sd">    weight : array (m,n)</span>
</span><span id="mapweight1d-32"><a href="#mapweight1d-32"><span class="linenos">32</span></a><span class="sd">        mapping weights from source to destination grid: new = np.dot(weight,old)</span>
</span><span id="mapweight1d-33"><a href="#mapweight1d-33"><span class="linenos">33</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="mapweight1d-34"><a href="#mapweight1d-34"><span class="linenos">34</span></a>
</span><span id="mapweight1d-35"><a href="#mapweight1d-35"><span class="linenos">35</span></a>    <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="mapweight1d-36"><a href="#mapweight1d-36"><span class="linenos">36</span></a>
</span><span id="mapweight1d-37"><a href="#mapweight1d-37"><span class="linenos">37</span></a>    <span class="c1"># Check if the input pedge1 are inceasing</span>
</span><span id="mapweight1d-38"><a href="#mapweight1d-38"><span class="linenos">38</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="mapweight1d-39"><a href="#mapweight1d-39"><span class="linenos">39</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="mapweight1d-40"><a href="#mapweight1d-40"><span class="linenos">40</span></a>        <span class="k">pass</span>
</span><span id="mapweight1d-41"><a href="#mapweight1d-41"><span class="linenos">41</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="mapweight1d-42"><a href="#mapweight1d-42"><span class="linenos">42</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;decreasing edge1 values not implemented&#39;</span><span class="p">)</span>
</span><span id="mapweight1d-43"><a href="#mapweight1d-43"><span class="linenos">43</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="mapweight1d-44"><a href="#mapweight1d-44"><span class="linenos">44</span></a>        <span class="n">edge1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">edge1</span> <span class="p">)</span>
</span><span id="mapweight1d-45"><a href="#mapweight1d-45"><span class="linenos">45</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="mapweight1d-46"><a href="#mapweight1d-46"><span class="linenos">46</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input edge1 must be sorted &#39;</span><span class="p">)</span>
</span><span id="mapweight1d-47"><a href="#mapweight1d-47"><span class="linenos">47</span></a>
</span><span id="mapweight1d-48"><a href="#mapweight1d-48"><span class="linenos">48</span></a>    <span class="c1"># Check if the output edges are increasing</span>
</span><span id="mapweight1d-49"><a href="#mapweight1d-49"><span class="linenos">49</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="mapweight1d-50"><a href="#mapweight1d-50"><span class="linenos">50</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="mapweight1d-51"><a href="#mapweight1d-51"><span class="linenos">51</span></a>        <span class="k">pass</span>
</span><span id="mapweight1d-52"><a href="#mapweight1d-52"><span class="linenos">52</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="mapweight1d-53"><a href="#mapweight1d-53"><span class="linenos">53</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;decreasing edge2 values not implemented&#39;</span><span class="p">)</span>
</span><span id="mapweight1d-54"><a href="#mapweight1d-54"><span class="linenos">54</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="mapweight1d-55"><a href="#mapweight1d-55"><span class="linenos">55</span></a>        <span class="n">edge2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">edge2</span> <span class="p">)</span>
</span><span id="mapweight1d-56"><a href="#mapweight1d-56"><span class="linenos">56</span></a>        <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="mapweight1d-57"><a href="#mapweight1d-57"><span class="linenos">57</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="mapweight1d-58"><a href="#mapweight1d-58"><span class="linenos">58</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input edge2 must be sorted &#39;</span><span class="p">)</span>
</span><span id="mapweight1d-59"><a href="#mapweight1d-59"><span class="linenos">59</span></a>
</span><span id="mapweight1d-60"><a href="#mapweight1d-60"><span class="linenos">60</span></a>    <span class="c1"># Interpolate pedge2 into pedge1</span>
</span><span id="mapweight1d-61"><a href="#mapweight1d-61"><span class="linenos">61</span></a>    <span class="n">idx21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span> <span class="n">edge2</span><span class="p">,</span> <span class="n">edge1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge1</span><span class="p">))</span> <span class="p">)</span>
</span><span id="mapweight1d-62"><a href="#mapweight1d-62"><span class="linenos">62</span></a>
</span><span id="mapweight1d-63"><a href="#mapweight1d-63"><span class="linenos">63</span></a>    <span class="c1"># If the pedge1 max or min are outside pedge2, then make sure the</span>
</span><span id="mapweight1d-64"><a href="#mapweight1d-64"><span class="linenos">64</span></a>    <span class="c1"># edges go into the end levels</span>
</span><span id="mapweight1d-65"><a href="#mapweight1d-65"><span class="linenos">65</span></a>    <span class="k">if</span> <span class="n">edgelump</span><span class="p">:</span>
</span><span id="mapweight1d-66"><a href="#mapweight1d-66"><span class="linenos">66</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">0</span>
</span><span id="mapweight1d-67"><a href="#mapweight1d-67"><span class="linenos">67</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</span><span id="mapweight1d-68"><a href="#mapweight1d-68"><span class="linenos">68</span></a>
</span><span id="mapweight1d-69"><a href="#mapweight1d-69"><span class="linenos">69</span></a>    <span class="c1"># Empty array for result</span>
</span><span id="mapweight1d-70"><a href="#mapweight1d-70"><span class="linenos">70</span></a>    <span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
</span><span id="mapweight1d-71"><a href="#mapweight1d-71"><span class="linenos">71</span></a>
</span><span id="mapweight1d-72"><a href="#mapweight1d-72"><span class="linenos">72</span></a>    <span class="k">for</span> <span class="n">iNew</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="mapweight1d-73"><a href="#mapweight1d-73"><span class="linenos">73</span></a>        <span class="k">for</span> <span class="n">iOld</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="p">):</span>
</span><span id="mapweight1d-74"><a href="#mapweight1d-74"><span class="linenos">74</span></a>
</span><span id="mapweight1d-75"><a href="#mapweight1d-75"><span class="linenos">75</span></a>            <span class="c1"># Concise version</span>
</span><span id="mapweight1d-76"><a href="#mapweight1d-76"><span class="linenos">76</span></a>            <span class="n">weight</span><span class="p">[</span><span class="n">iNew</span><span class="p">,</span><span class="n">iOld</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">iOld</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">iNew</span><span class="p">],</span><span class="n">iOld</span><span class="p">)</span> <span class="p">)</span>
</span><span id="mapweight1d-77"><a href="#mapweight1d-77"><span class="linenos">77</span></a>
</span><span id="mapweight1d-78"><a href="#mapweight1d-78"><span class="linenos">78</span></a>    <span class="k">return</span> <span class="n">weight</span>
</span></pre></div>


            <div class="docstring"><p>Calculate mapping weights from source grid with edge1 to destination grid with edge2</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>edge1</strong> (array (n,)):
source grid edge coordinates</li>
<li><strong>edge2</strong> (array (m,)):
destination grid edge coordinates</li>
<li><strong>edgelump</strong> (bool, default=True)):
edgelump only affects situations where the source grid covers a larger domain 
than the destination grid (i.e. min(edge1)<min(edge2) or max(edge1)&gt;max(edge2) ).
If True, enforce total mass conservation in mapping weights by lumping excess mass 
in source grid into the corresponding end of destination grid.
If False, the mass is conserved in the overlapping domains, but some total mass
can be lost due to difference in overall domain.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>weight</strong> (array (m,n)):
mapping weights from source to destination grid: new = np.dot(weight,old)</li>
</ul>
</div>


                </section>
                <section id="regrid2d">
                            <input id="regrid2d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">regrid2d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">array1</span>, </span><span class="param"><span class="n">xe1</span>, </span><span class="param"><span class="n">ye1</span>, </span><span class="param"><span class="n">xe2</span>, </span><span class="param"><span class="n">ye2</span>, </span><span class="param"><span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="regrid2d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#regrid2d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="regrid2d-80"><a href="#regrid2d-80"><span class="linenos"> 80</span></a><span class="k">def</span> <span class="nf">regrid2d</span><span class="p">(</span> <span class="n">array1</span><span class="p">,</span> <span class="n">xe1</span><span class="p">,</span> <span class="n">ye1</span><span class="p">,</span> <span class="n">xe2</span><span class="p">,</span> <span class="n">ye2</span><span class="p">,</span> <span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="regrid2d-81"><a href="#regrid2d-81"><span class="linenos"> 81</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Mass-conserving remapping of data between regular x-y or lat-lon grids</span>
</span><span id="regrid2d-82"><a href="#regrid2d-82"><span class="linenos"> 82</span></a>
</span><span id="regrid2d-83"><a href="#regrid2d-83"><span class="linenos"> 83</span></a><span class="sd">    Parameters</span>
</span><span id="regrid2d-84"><a href="#regrid2d-84"><span class="linenos"> 84</span></a><span class="sd">    ----------</span>
</span><span id="regrid2d-85"><a href="#regrid2d-85"><span class="linenos"> 85</span></a><span class="sd">    array1 : array (n,m)</span>
</span><span id="regrid2d-86"><a href="#regrid2d-86"><span class="linenos"> 86</span></a><span class="sd">        input data. Quantities should be extensive (e.g. mass, not mixing ratio).</span>
</span><span id="regrid2d-87"><a href="#regrid2d-87"><span class="linenos"> 87</span></a><span class="sd">    xe1 : array (n+1,)</span>
</span><span id="regrid2d-88"><a href="#regrid2d-88"><span class="linenos"> 88</span></a><span class="sd">        source grid edges in x dimension, e.g. longitude</span>
</span><span id="regrid2d-89"><a href="#regrid2d-89"><span class="linenos"> 89</span></a><span class="sd">    ye1 : array (m+1,)</span>
</span><span id="regrid2d-90"><a href="#regrid2d-90"><span class="linenos"> 90</span></a><span class="sd">        source grid edges in y dimension, e.g. latitude</span>
</span><span id="regrid2d-91"><a href="#regrid2d-91"><span class="linenos"> 91</span></a><span class="sd">    xe2 : array (p+1,)</span>
</span><span id="regrid2d-92"><a href="#regrid2d-92"><span class="linenos"> 92</span></a><span class="sd">        destination grid edges in x dimension, e.g. longitude</span>
</span><span id="regrid2d-93"><a href="#regrid2d-93"><span class="linenos"> 93</span></a><span class="sd">    ye2 : array (q+1,)</span>
</span><span id="regrid2d-94"><a href="#regrid2d-94"><span class="linenos"> 94</span></a><span class="sd">        destination grid edges in y dimension, e.g. latitude</span>
</span><span id="regrid2d-95"><a href="#regrid2d-95"><span class="linenos"> 95</span></a><span class="sd">    edgelump : bool, default=True</span>
</span><span id="regrid2d-96"><a href="#regrid2d-96"><span class="linenos"> 96</span></a><span class="sd">        edgelump only affects situations where the source grid covers a larger domain </span>
</span><span id="regrid2d-97"><a href="#regrid2d-97"><span class="linenos"> 97</span></a><span class="sd">        than the destination grid (i.e. min(edge1)&lt;min(edge2) or max(edge1)&gt;max(edge2) ).</span>
</span><span id="regrid2d-98"><a href="#regrid2d-98"><span class="linenos"> 98</span></a><span class="sd">        If True, enforce total mass conservation in mapping weights by lumping excess mass </span>
</span><span id="regrid2d-99"><a href="#regrid2d-99"><span class="linenos"> 99</span></a><span class="sd">        in source grid into the corresponding end of destination grid.</span>
</span><span id="regrid2d-100"><a href="#regrid2d-100"><span class="linenos">100</span></a><span class="sd">        If False, the mass is conserved in the overlapping domains, but some total mass</span>
</span><span id="regrid2d-101"><a href="#regrid2d-101"><span class="linenos">101</span></a><span class="sd">        can be lost due to difference in overall domain.</span>
</span><span id="regrid2d-102"><a href="#regrid2d-102"><span class="linenos">102</span></a>
</span><span id="regrid2d-103"><a href="#regrid2d-103"><span class="linenos">103</span></a><span class="sd">    Returns</span>
</span><span id="regrid2d-104"><a href="#regrid2d-104"><span class="linenos">104</span></a><span class="sd">    -------</span>
</span><span id="regrid2d-105"><a href="#regrid2d-105"><span class="linenos">105</span></a><span class="sd">    outarray : array (p,q)</span>
</span><span id="regrid2d-106"><a href="#regrid2d-106"><span class="linenos">106</span></a><span class="sd">        input data remapped to the destination grid</span>
</span><span id="regrid2d-107"><a href="#regrid2d-107"><span class="linenos">107</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="regrid2d-108"><a href="#regrid2d-108"><span class="linenos">108</span></a>
</span><span id="regrid2d-109"><a href="#regrid2d-109"><span class="linenos">109</span></a>    <span class="c1"># Sizes</span>
</span><span id="regrid2d-110"><a href="#regrid2d-110"><span class="linenos">110</span></a>    <span class="n">insize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span>
</span><span id="regrid2d-111"><a href="#regrid2d-111"><span class="linenos">111</span></a>    <span class="n">nxe1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xe1</span><span class="p">)</span>
</span><span id="regrid2d-112"><a href="#regrid2d-112"><span class="linenos">112</span></a>    <span class="n">nye1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ye1</span><span class="p">)</span>
</span><span id="regrid2d-113"><a href="#regrid2d-113"><span class="linenos">113</span></a>    <span class="n">nxe2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xe2</span><span class="p">)</span>
</span><span id="regrid2d-114"><a href="#regrid2d-114"><span class="linenos">114</span></a>    <span class="n">nye2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ye2</span><span class="p">)</span>
</span><span id="regrid2d-115"><a href="#regrid2d-115"><span class="linenos">115</span></a>
</span><span id="regrid2d-116"><a href="#regrid2d-116"><span class="linenos">116</span></a>    <span class="c1"># Ensure arrays conform</span>
</span><span id="regrid2d-117"><a href="#regrid2d-117"><span class="linenos">117</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">insize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">:</span>
</span><span id="regrid2d-118"><a href="#regrid2d-118"><span class="linenos">118</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;array1 must be 2D&#39;</span><span class="p">)</span>
</span><span id="regrid2d-119"><a href="#regrid2d-119"><span class="linenos">119</span></a>    <span class="k">if</span> <span class="n">insize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nxe1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="regrid2d-120"><a href="#regrid2d-120"><span class="linenos">120</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;xe1 must match size of array1&#39;</span> <span class="p">)</span>
</span><span id="regrid2d-121"><a href="#regrid2d-121"><span class="linenos">121</span></a>    <span class="k">if</span> <span class="n">insize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nye1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="regrid2d-122"><a href="#regrid2d-122"><span class="linenos">122</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;ye1 must match size of array1&#39;</span> <span class="p">)</span>
</span><span id="regrid2d-123"><a href="#regrid2d-123"><span class="linenos">123</span></a>
</span><span id="regrid2d-124"><a href="#regrid2d-124"><span class="linenos">124</span></a>    <span class="c1"># Regridding weight matrices</span>
</span><span id="regrid2d-125"><a href="#regrid2d-125"><span class="linenos">125</span></a>    <span class="n">weightY</span> <span class="o">=</span> <span class="n">mapweight1d</span><span class="p">(</span><span class="n">ye1</span><span class="p">,</span> <span class="n">ye2</span><span class="p">,</span> <span class="n">edgelump</span><span class="p">)</span>
</span><span id="regrid2d-126"><a href="#regrid2d-126"><span class="linenos">126</span></a>    <span class="n">weightX</span> <span class="o">=</span> <span class="n">mapweight1d</span><span class="p">(</span><span class="n">xe1</span><span class="p">,</span> <span class="n">xe2</span><span class="p">,</span> <span class="n">edgelump</span><span class="p">)</span>
</span><span id="regrid2d-127"><a href="#regrid2d-127"><span class="linenos">127</span></a>
</span><span id="regrid2d-128"><a href="#regrid2d-128"><span class="linenos">128</span></a>    <span class="c1"># Size of temporary and output arrays</span>
</span><span id="regrid2d-129"><a href="#regrid2d-129"><span class="linenos">129</span></a>    <span class="n">tmpsize</span> <span class="o">=</span> <span class="p">[</span><span class="n">nye2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nxe1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="regrid2d-130"><a href="#regrid2d-130"><span class="linenos">130</span></a>    <span class="n">outsize</span> <span class="o">=</span> <span class="p">[</span><span class="n">nye2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nxe2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="regrid2d-131"><a href="#regrid2d-131"><span class="linenos">131</span></a>
</span><span id="regrid2d-132"><a href="#regrid2d-132"><span class="linenos">132</span></a>    <span class="c1"># Temporary array</span>
</span><span id="regrid2d-133"><a href="#regrid2d-133"><span class="linenos">133</span></a>    <span class="n">a1b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span> <span class="n">tmpsize</span> <span class="p">)</span>
</span><span id="regrid2d-134"><a href="#regrid2d-134"><span class="linenos">134</span></a>    <span class="n">a1b</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="regrid2d-135"><a href="#regrid2d-135"><span class="linenos">135</span></a>
</span><span id="regrid2d-136"><a href="#regrid2d-136"><span class="linenos">136</span></a>    <span class="c1"># Output array</span>
</span><span id="regrid2d-137"><a href="#regrid2d-137"><span class="linenos">137</span></a>    <span class="n">outarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">outsize</span><span class="p">)</span>
</span><span id="regrid2d-138"><a href="#regrid2d-138"><span class="linenos">138</span></a>    <span class="n">outarray</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="regrid2d-139"><a href="#regrid2d-139"><span class="linenos">139</span></a>
</span><span id="regrid2d-140"><a href="#regrid2d-140"><span class="linenos">140</span></a>    <span class="c1"># Regrid latitude</span>
</span><span id="regrid2d-141"><a href="#regrid2d-141"><span class="linenos">141</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xe1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="regrid2d-142"><a href="#regrid2d-142"><span class="linenos">142</span></a>        <span class="n">a1b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">weightY</span><span class="p">,</span> <span class="n">array1</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="p">)</span>
</span><span id="regrid2d-143"><a href="#regrid2d-143"><span class="linenos">143</span></a>
</span><span id="regrid2d-144"><a href="#regrid2d-144"><span class="linenos">144</span></a>    <span class="c1"># Regrid longitude</span>
</span><span id="regrid2d-145"><a href="#regrid2d-145"><span class="linenos">145</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="regrid2d-146"><a href="#regrid2d-146"><span class="linenos">146</span></a>        <span class="n">outarray</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">weightX</span><span class="p">,</span> <span class="n">a1b</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="p">)</span>
</span><span id="regrid2d-147"><a href="#regrid2d-147"><span class="linenos">147</span></a>
</span><span id="regrid2d-148"><a href="#regrid2d-148"><span class="linenos">148</span></a>    <span class="k">return</span> <span class="n">outarray</span>
</span></pre></div>


            <div class="docstring"><p>Mass-conserving remapping of data between regular x-y or lat-lon grids</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>array1</strong> (array (n,m)):
input data. Quantities should be extensive (e.g. mass, not mixing ratio).</li>
<li><strong>xe1</strong> (array (n+1,)):
source grid edges in x dimension, e.g. longitude</li>
<li><strong>ye1</strong> (array (m+1,)):
source grid edges in y dimension, e.g. latitude</li>
<li><strong>xe2</strong> (array (p+1,)):
destination grid edges in x dimension, e.g. longitude</li>
<li><strong>ye2</strong> (array (q+1,)):
destination grid edges in y dimension, e.g. latitude</li>
<li><strong>edgelump</strong> (bool, default=True):
edgelump only affects situations where the source grid covers a larger domain 
than the destination grid (i.e. min(edge1)<min(edge2) or max(edge1)&gt;max(edge2) ).
If True, enforce total mass conservation in mapping weights by lumping excess mass 
in source grid into the corresponding end of destination grid.
If False, the mass is conserved in the overlapping domains, but some total mass
can be lost due to difference in overall domain.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>outarray</strong> (array (p,q)):
input data remapped to the destination grid</li>
</ul>
</div>


                </section>
                <section id="regrid_plevels">
                            <input id="regrid_plevels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">regrid_plevels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">array1</span>, </span><span class="param"><span class="n">pedge1</span>, </span><span class="param"><span class="n">pedge2</span>, </span><span class="param"><span class="n">intensive</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="regrid_plevels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#regrid_plevels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="regrid_plevels-151"><a href="#regrid_plevels-151"><span class="linenos">151</span></a><span class="k">def</span> <span class="nf">regrid_plevels</span><span class="p">(</span> <span class="n">array1</span><span class="p">,</span> <span class="n">pedge1</span><span class="p">,</span> <span class="n">pedge2</span><span class="p">,</span> <span class="n">intensive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgelump</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="regrid_plevels-152"><a href="#regrid_plevels-152"><span class="linenos">152</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39; Mass-conserving regridding of data on pressure levels</span>
</span><span id="regrid_plevels-153"><a href="#regrid_plevels-153"><span class="linenos">153</span></a><span class="sd">    Data from the input array will be remapped to the output pressure levels while </span>
</span><span id="regrid_plevels-154"><a href="#regrid_plevels-154"><span class="linenos">154</span></a><span class="sd">    conserving total mass.</span>
</span><span id="regrid_plevels-155"><a href="#regrid_plevels-155"><span class="linenos">155</span></a>
</span><span id="regrid_plevels-156"><a href="#regrid_plevels-156"><span class="linenos">156</span></a><span class="sd">    Parameters</span>
</span><span id="regrid_plevels-157"><a href="#regrid_plevels-157"><span class="linenos">157</span></a><span class="sd">    ----------</span>
</span><span id="regrid_plevels-158"><a href="#regrid_plevels-158"><span class="linenos">158</span></a><span class="sd">    array1 : array, (p,)</span>
</span><span id="regrid_plevels-159"><a href="#regrid_plevels-159"><span class="linenos">159</span></a><span class="sd">        Array of data that will be remapped.</span>
</span><span id="regrid_plevels-160"><a href="#regrid_plevels-160"><span class="linenos">160</span></a><span class="sd">        Quantities should be extensive (e.g. mass, not mixing ratio) unless the </span>
</span><span id="regrid_plevels-161"><a href="#regrid_plevels-161"><span class="linenos">161</span></a><span class="sd">        intensive keyword is used.</span>
</span><span id="regrid_plevels-162"><a href="#regrid_plevels-162"><span class="linenos">162</span></a><span class="sd">    pedge1 : array (p+1,)</span>
</span><span id="regrid_plevels-163"><a href="#regrid_plevels-163"><span class="linenos">163</span></a><span class="sd">        Pressure edges of the input array1. The length of pedge1 should be one greater than array1. </span>
</span><span id="regrid_plevels-164"><a href="#regrid_plevels-164"><span class="linenos">164</span></a><span class="sd">        The element array1[i] is bounded by edges pedge1[i], pedge1[i+1]</span>
</span><span id="regrid_plevels-165"><a href="#regrid_plevels-165"><span class="linenos">165</span></a><span class="sd">    pedge2 : array (q+1,)</span>
</span><span id="regrid_plevels-166"><a href="#regrid_plevels-166"><span class="linenos">166</span></a><span class="sd">        Pressure edges of the desired output array.</span>
</span><span id="regrid_plevels-167"><a href="#regrid_plevels-167"><span class="linenos">167</span></a><span class="sd">    intensive : bool, default=False</span>
</span><span id="regrid_plevels-168"><a href="#regrid_plevels-168"><span class="linenos">168</span></a><span class="sd">        If True, then array1 will be treated as an intensive quantity (e.g mole fraction, </span>
</span><span id="regrid_plevels-169"><a href="#regrid_plevels-169"><span class="linenos">169</span></a><span class="sd">        mixing ratio) during regridding. Each element array1[i] will be multiplied by </span>
</span><span id="regrid_plevels-170"><a href="#regrid_plevels-170"><span class="linenos">170</span></a><span class="sd">        (pedge1[i]-pedge[i+1]), which is proportional to airmass if pedge1 is pressure, </span>
</span><span id="regrid_plevels-171"><a href="#regrid_plevels-171"><span class="linenos">171</span></a><span class="sd">        before regridding. The output array2, will similarly be dividied by (pedge2[i]-pedge[i+1]) </span>
</span><span id="regrid_plevels-172"><a href="#regrid_plevels-172"><span class="linenos">172</span></a><span class="sd">        so that the output is also intensive. </span>
</span><span id="regrid_plevels-173"><a href="#regrid_plevels-173"><span class="linenos">173</span></a><span class="sd">        By default, intensive=False is used and the input array is assumed to be extensive.</span>
</span><span id="regrid_plevels-174"><a href="#regrid_plevels-174"><span class="linenos">174</span></a><span class="sd">    edgelump : bool, default=True </span>
</span><span id="regrid_plevels-175"><a href="#regrid_plevels-175"><span class="linenos">175</span></a><span class="sd">        If the max or min of pedge1 extend beyond the max or min of pedge2 and edgelump=True, </span>
</span><span id="regrid_plevels-176"><a href="#regrid_plevels-176"><span class="linenos">176</span></a><span class="sd">        the mass will be placed in in the first or last grid level of the output array2, </span>
</span><span id="regrid_plevels-177"><a href="#regrid_plevels-177"><span class="linenos">177</span></a><span class="sd">        ensuring that the mass of array2 is the same as array1. </span>
</span><span id="regrid_plevels-178"><a href="#regrid_plevels-178"><span class="linenos">178</span></a><span class="sd">        If edgelump=False, then the mass of array2 can be less than array1.</span>
</span><span id="regrid_plevels-179"><a href="#regrid_plevels-179"><span class="linenos">179</span></a>
</span><span id="regrid_plevels-180"><a href="#regrid_plevels-180"><span class="linenos">180</span></a><span class="sd">    Returns</span>
</span><span id="regrid_plevels-181"><a href="#regrid_plevels-181"><span class="linenos">181</span></a><span class="sd">    array2 : array (q,)</span>
</span><span id="regrid_plevels-182"><a href="#regrid_plevels-182"><span class="linenos">182</span></a><span class="sd">        Array of remapped data. The length of array2 will be one less than pedge2.</span>
</span><span id="regrid_plevels-183"><a href="#regrid_plevels-183"><span class="linenos">183</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="regrid_plevels-184"><a href="#regrid_plevels-184"><span class="linenos">184</span></a>
</span><span id="regrid_plevels-185"><a href="#regrid_plevels-185"><span class="linenos">185</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
</span><span id="regrid_plevels-186"><a href="#regrid_plevels-186"><span class="linenos">186</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pedge1 must have size len(array1)+1&quot;</span><span class="p">)</span>
</span><span id="regrid_plevels-187"><a href="#regrid_plevels-187"><span class="linenos">187</span></a>
</span><span id="regrid_plevels-188"><a href="#regrid_plevels-188"><span class="linenos">188</span></a>    <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="regrid_plevels-189"><a href="#regrid_plevels-189"><span class="linenos">189</span></a>
</span><span id="regrid_plevels-190"><a href="#regrid_plevels-190"><span class="linenos">190</span></a>    <span class="c1"># Check if the input pedge1 are inceasing</span>
</span><span id="regrid_plevels-191"><a href="#regrid_plevels-191"><span class="linenos">191</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="regrid_plevels-192"><a href="#regrid_plevels-192"><span class="linenos">192</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="regrid_plevels-193"><a href="#regrid_plevels-193"><span class="linenos">193</span></a>        <span class="k">pass</span>
</span><span id="regrid_plevels-194"><a href="#regrid_plevels-194"><span class="linenos">194</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="regrid_plevels-195"><a href="#regrid_plevels-195"><span class="linenos">195</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="regrid_plevels-196"><a href="#regrid_plevels-196"><span class="linenos">196</span></a>        <span class="n">array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">array1</span> <span class="p">)</span>
</span><span id="regrid_plevels-197"><a href="#regrid_plevels-197"><span class="linenos">197</span></a>        <span class="n">pedge1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">pedge1</span> <span class="p">)</span>
</span><span id="regrid_plevels-198"><a href="#regrid_plevels-198"><span class="linenos">198</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="regrid_plevels-199"><a href="#regrid_plevels-199"><span class="linenos">199</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input pedge1 must be sorted &#39;</span><span class="p">)</span>
</span><span id="regrid_plevels-200"><a href="#regrid_plevels-200"><span class="linenos">200</span></a>
</span><span id="regrid_plevels-201"><a href="#regrid_plevels-201"><span class="linenos">201</span></a>    <span class="c1"># Check if the output edges are increasing </span>
</span><span id="regrid_plevels-202"><a href="#regrid_plevels-202"><span class="linenos">202</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="regrid_plevels-203"><a href="#regrid_plevels-203"><span class="linenos">203</span></a>        <span class="c1"># All are increasing, do nothing</span>
</span><span id="regrid_plevels-204"><a href="#regrid_plevels-204"><span class="linenos">204</span></a>        <span class="k">pass</span>
</span><span id="regrid_plevels-205"><a href="#regrid_plevels-205"><span class="linenos">205</span></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pedge2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="regrid_plevels-206"><a href="#regrid_plevels-206"><span class="linenos">206</span></a>        <span class="c1"># All are decreasing, reverse</span>
</span><span id="regrid_plevels-207"><a href="#regrid_plevels-207"><span class="linenos">207</span></a>        <span class="n">pedge2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">pedge2</span> <span class="p">)</span>
</span><span id="regrid_plevels-208"><a href="#regrid_plevels-208"><span class="linenos">208</span></a>        <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="regrid_plevels-209"><a href="#regrid_plevels-209"><span class="linenos">209</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="regrid_plevels-210"><a href="#regrid_plevels-210"><span class="linenos">210</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Input pedge2 must be sorted &#39;</span><span class="p">)</span>
</span><span id="regrid_plevels-211"><a href="#regrid_plevels-211"><span class="linenos">211</span></a>
</span><span id="regrid_plevels-212"><a href="#regrid_plevels-212"><span class="linenos">212</span></a>    <span class="c1"># If input is an intensive quantity, then multiply by the pressure grid spacing</span>
</span><span id="regrid_plevels-213"><a href="#regrid_plevels-213"><span class="linenos">213</span></a>    <span class="k">if</span> <span class="n">intensive</span><span class="p">:</span>
</span><span id="regrid_plevels-214"><a href="#regrid_plevels-214"><span class="linenos">214</span></a>        <span class="n">array1</span> <span class="o">=</span> <span class="n">array1</span> <span class="o">*</span> <span class="p">(</span> <span class="n">pedge1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">pedge1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</span><span id="regrid_plevels-215"><a href="#regrid_plevels-215"><span class="linenos">215</span></a>
</span><span id="regrid_plevels-216"><a href="#regrid_plevels-216"><span class="linenos">216</span></a>    <span class="c1"># Interpolate pedge2 into pedge1</span>
</span><span id="regrid_plevels-217"><a href="#regrid_plevels-217"><span class="linenos">217</span></a>    <span class="n">idx21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span> <span class="n">pedge2</span><span class="p">,</span> <span class="n">pedge1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pedge1</span><span class="p">))</span> <span class="p">)</span>
</span><span id="regrid_plevels-218"><a href="#regrid_plevels-218"><span class="linenos">218</span></a>
</span><span id="regrid_plevels-219"><a href="#regrid_plevels-219"><span class="linenos">219</span></a>    <span class="c1"># If the pedge1 max or min are outside pedge2, then make sure the </span>
</span><span id="regrid_plevels-220"><a href="#regrid_plevels-220"><span class="linenos">220</span></a>    <span class="c1"># edges go into the end levels</span>
</span><span id="regrid_plevels-221"><a href="#regrid_plevels-221"><span class="linenos">221</span></a>    <span class="k">if</span> <span class="n">edgelump</span><span class="p">:</span>
</span><span id="regrid_plevels-222"><a href="#regrid_plevels-222"><span class="linenos">222</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">0</span>
</span><span id="regrid_plevels-223"><a href="#regrid_plevels-223"><span class="linenos">223</span></a>        <span class="n">idx21</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pedge1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>  
</span><span id="regrid_plevels-224"><a href="#regrid_plevels-224"><span class="linenos">224</span></a>
</span><span id="regrid_plevels-225"><a href="#regrid_plevels-225"><span class="linenos">225</span></a>    <span class="c1"># Empty array for result</span>
</span><span id="regrid_plevels-226"><a href="#regrid_plevels-226"><span class="linenos">226</span></a>    <span class="n">array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">pedge2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
</span><span id="regrid_plevels-227"><a href="#regrid_plevels-227"><span class="linenos">227</span></a>
</span><span id="regrid_plevels-228"><a href="#regrid_plevels-228"><span class="linenos">228</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array2</span><span class="p">)):</span>
</span><span id="regrid_plevels-229"><a href="#regrid_plevels-229"><span class="linenos">229</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="p">):</span>
</span><span id="regrid_plevels-230"><a href="#regrid_plevels-230"><span class="linenos">230</span></a>
</span><span id="regrid_plevels-231"><a href="#regrid_plevels-231"><span class="linenos">231</span></a>            <span class="c1"># Concise version</span>
</span><span id="regrid_plevels-232"><a href="#regrid_plevels-232"><span class="linenos">232</span></a>            <span class="n">array2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">array1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">idx21</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>
</span><span id="regrid_plevels-233"><a href="#regrid_plevels-233"><span class="linenos">233</span></a>
</span><span id="regrid_plevels-234"><a href="#regrid_plevels-234"><span class="linenos">234</span></a>            <span class="c1"># Lengthy version</span>
</span><span id="regrid_plevels-235"><a href="#regrid_plevels-235"><span class="linenos">235</span></a>            <span class="c1">#if ( j &gt;= idx21[i] and j+1 &lt;= idx21[i+1] ):</span>
</span><span id="regrid_plevels-236"><a href="#regrid_plevels-236"><span class="linenos">236</span></a>            <span class="c1">#    array2[i] += array1[j]</span>
</span><span id="regrid_plevels-237"><a href="#regrid_plevels-237"><span class="linenos">237</span></a>            <span class="c1">#    #print( &#39;input level {:d} inside output level {:d}&#39;.format(j,i))</span>
</span><span id="regrid_plevels-238"><a href="#regrid_plevels-238"><span class="linenos">238</span></a>            <span class="c1">#elif ( j &lt; idx21[i] and j+1 &gt; idx21[i+1] ):</span>
</span><span id="regrid_plevels-239"><a href="#regrid_plevels-239"><span class="linenos">239</span></a>            <span class="c1">#    array2[i] += array1[j] * (idx21[i+1] - idx21[i])</span>
</span><span id="regrid_plevels-240"><a href="#regrid_plevels-240"><span class="linenos">240</span></a>            <span class="c1">#    #print( &#39;output level inside input level&#39;)</span>
</span><span id="regrid_plevels-241"><a href="#regrid_plevels-241"><span class="linenos">241</span></a>            <span class="c1">#elif ( j &lt; idx21[i] ):</span>
</span><span id="regrid_plevels-242"><a href="#regrid_plevels-242"><span class="linenos">242</span></a>            <span class="c1">#    array2[i] +=  array1[j] * (1 - np.mod(idx21[i],  1)) </span>
</span><span id="regrid_plevels-243"><a href="#regrid_plevels-243"><span class="linenos">243</span></a>            <span class="c1">#    #print( &#39;input level {:d} at bottom of output level {:d}&#39;.format(j,i))</span>
</span><span id="regrid_plevels-244"><a href="#regrid_plevels-244"><span class="linenos">244</span></a>            <span class="c1">#elif ( j+1 &gt; idx21[i+1] ):</span>
</span><span id="regrid_plevels-245"><a href="#regrid_plevels-245"><span class="linenos">245</span></a>            <span class="c1">#    array2[i] += array1[j] * np.mod( idx21[i+1], 1)</span>
</span><span id="regrid_plevels-246"><a href="#regrid_plevels-246"><span class="linenos">246</span></a>            <span class="c1">#    #print( &#39;input level {:d} at top of output level {:d}&#39;.format(j,i))</span>
</span><span id="regrid_plevels-247"><a href="#regrid_plevels-247"><span class="linenos">247</span></a>            <span class="c1">#else:</span>
</span><span id="regrid_plevels-248"><a href="#regrid_plevels-248"><span class="linenos">248</span></a>            <span class="c1">#    raise NotImplemented</span>
</span><span id="regrid_plevels-249"><a href="#regrid_plevels-249"><span class="linenos">249</span></a>
</span><span id="regrid_plevels-250"><a href="#regrid_plevels-250"><span class="linenos">250</span></a>    <span class="c1"># Convert back to an intensive quantity, if necessary</span>
</span><span id="regrid_plevels-251"><a href="#regrid_plevels-251"><span class="linenos">251</span></a>    <span class="k">if</span> <span class="n">intensive</span><span class="p">:</span>
</span><span id="regrid_plevels-252"><a href="#regrid_plevels-252"><span class="linenos">252</span></a>        <span class="n">array2</span> <span class="o">=</span> <span class="n">array2</span> <span class="o">/</span> <span class="p">(</span> <span class="n">pedge2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">pedge2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</span><span id="regrid_plevels-253"><a href="#regrid_plevels-253"><span class="linenos">253</span></a>
</span><span id="regrid_plevels-254"><a href="#regrid_plevels-254"><span class="linenos">254</span></a>    <span class="c1"># Reverse the output array, if necessary</span>
</span><span id="regrid_plevels-255"><a href="#regrid_plevels-255"><span class="linenos">255</span></a>    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
</span><span id="regrid_plevels-256"><a href="#regrid_plevels-256"><span class="linenos">256</span></a>        <span class="n">array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span> <span class="n">array2</span> <span class="p">)</span>
</span><span id="regrid_plevels-257"><a href="#regrid_plevels-257"><span class="linenos">257</span></a>
</span><span id="regrid_plevels-258"><a href="#regrid_plevels-258"><span class="linenos">258</span></a>    <span class="k">return</span> <span class="n">array2</span>
</span></pre></div>


            <div class="docstring"><p>Mass-conserving regridding of data on pressure levels
Data from the input array will be remapped to the output pressure levels while 
conserving total mass.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>array1</strong> (array, (p,)):
Array of data that will be remapped.
Quantities should be extensive (e.g. mass, not mixing ratio) unless the 
intensive keyword is used.</li>
<li><strong>pedge1</strong> (array (p+1,)):
Pressure edges of the input array1. The length of pedge1 should be one greater than array1. 
The element array1[i] is bounded by edges pedge1[i], pedge1[i+1]</li>
<li><strong>pedge2</strong> (array (q+1,)):
Pressure edges of the desired output array.</li>
<li><strong>intensive</strong> (bool, default=False):
If True, then array1 will be treated as an intensive quantity (e.g mole fraction, 
mixing ratio) during regridding. Each element array1[i] will be multiplied by 
(pedge1[i]-pedge[i+1]), which is proportional to airmass if pedge1 is pressure, 
before regridding. The output array2, will similarly be dividied by (pedge2[i]-pedge[i+1]) 
so that the output is also intensive. 
By default, intensive=False is used and the input array is assumed to be extensive.</li>
<li><strong>edgelump</strong> (bool, default=True):
If the max or min of pedge1 extend beyond the max or min of pedge2 and edgelump=True, 
the mass will be placed in in the first or last grid level of the output array2, 
ensuring that the mass of array2 is the same as array1. 
If edgelump=False, then the mass of array2 can be less than array1.</li>
<li><strong>Returns</strong></li>
<li><strong>array2</strong> (array (q,)):
Array of remapped data. The length of array2 will be one less than pedge2.</li>
</ul>
</div>


                </section>
                <section id="lon2i">
                            <input id="lon2i-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lon2i</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">lon</span>, </span><span class="param"><span class="n">res</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="lon2i-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lon2i"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lon2i-315"><a href="#lon2i-315"><span class="linenos">315</span></a><span class="k">def</span> <span class="nf">lon2i</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="lon2i-316"><a href="#lon2i-316"><span class="linenos">316</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Find I grid index for longitude</span>
</span><span id="lon2i-317"><a href="#lon2i-317"><span class="linenos">317</span></a>
</span><span id="lon2i-318"><a href="#lon2i-318"><span class="linenos">318</span></a><span class="sd">    Parameters</span>
</span><span id="lon2i-319"><a href="#lon2i-319"><span class="linenos">319</span></a><span class="sd">    ----------</span>
</span><span id="lon2i-320"><a href="#lon2i-320"><span class="linenos">320</span></a><span class="sd">    lon : float</span>
</span><span id="lon2i-321"><a href="#lon2i-321"><span class="linenos">321</span></a><span class="sd">        longitude in degrees</span>
</span><span id="lon2i-322"><a href="#lon2i-322"><span class="linenos">322</span></a><span class="sd">    res : float, default=4</span>
</span><span id="lon2i-323"><a href="#lon2i-323"><span class="linenos">323</span></a><span class="sd">        resolution of grid. See `get_lon` for allowed values</span>
</span><span id="lon2i-324"><a href="#lon2i-324"><span class="linenos">324</span></a>
</span><span id="lon2i-325"><a href="#lon2i-325"><span class="linenos">325</span></a><span class="sd">    Result</span>
</span><span id="lon2i-326"><a href="#lon2i-326"><span class="linenos">326</span></a><span class="sd">    ------</span>
</span><span id="lon2i-327"><a href="#lon2i-327"><span class="linenos">327</span></a><span class="sd">    index : int</span>
</span><span id="lon2i-328"><a href="#lon2i-328"><span class="linenos">328</span></a><span class="sd">        grid index location closest to longitude</span>
</span><span id="lon2i-329"><a href="#lon2i-329"><span class="linenos">329</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="lon2i-330"><a href="#lon2i-330"><span class="linenos">330</span></a>    <span class="c1"># Put longitude in expected GC the range [-180,180]</span>
</span><span id="lon2i-331"><a href="#lon2i-331"><span class="linenos">331</span></a>    <span class="n">alon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
</span><span id="lon2i-332"><a href="#lon2i-332"><span class="linenos">332</span></a>    <span class="n">longrid</span> <span class="o">=</span> <span class="n">get_lon</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lon2i-333"><a href="#lon2i-333"><span class="linenos">333</span></a>    <span class="n">nlon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">longrid</span><span class="p">)</span>
</span><span id="lon2i-334"><a href="#lon2i-334"><span class="linenos">334</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">longrid</span><span class="p">,</span><span class="n">longrid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">360</span><span class="p">),</span>
</span><span id="lon2i-335"><a href="#lon2i-335"><span class="linenos">335</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlon</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span>
</span><span id="lon2i-336"><a href="#lon2i-336"><span class="linenos">336</span></a>                <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
</span><span id="lon2i-337"><a href="#lon2i-337"><span class="linenos">337</span></a>                <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
</span><span id="lon2i-338"><a href="#lon2i-338"><span class="linenos">338</span></a>    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">alon</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Find I grid index for longitude</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>lon</strong> (float):
longitude in degrees</li>
<li><strong>res</strong> (float, default=4):
resolution of grid. See <code><a href="#get_lon">get_lon</a></code> for allowed values</li>
</ul>

<h6 id="result">Result</h6>

<p>index : int
    grid index location closest to longitude</p>
</div>


                </section>
                <section id="lat2j">
                            <input id="lat2j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lat2j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">lat</span>, </span><span class="param"><span class="n">res</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="lat2j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lat2j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lat2j-340"><a href="#lat2j-340"><span class="linenos">340</span></a><span class="k">def</span> <span class="nf">lat2j</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="lat2j-341"><a href="#lat2j-341"><span class="linenos">341</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Find J grid index for latitude</span>
</span><span id="lat2j-342"><a href="#lat2j-342"><span class="linenos">342</span></a>
</span><span id="lat2j-343"><a href="#lat2j-343"><span class="linenos">343</span></a><span class="sd">    Parameters</span>
</span><span id="lat2j-344"><a href="#lat2j-344"><span class="linenos">344</span></a><span class="sd">    ----------</span>
</span><span id="lat2j-345"><a href="#lat2j-345"><span class="linenos">345</span></a><span class="sd">    lat : float</span>
</span><span id="lat2j-346"><a href="#lat2j-346"><span class="linenos">346</span></a><span class="sd">        latitude in degrees</span>
</span><span id="lat2j-347"><a href="#lat2j-347"><span class="linenos">347</span></a><span class="sd">    res : float, default=4</span>
</span><span id="lat2j-348"><a href="#lat2j-348"><span class="linenos">348</span></a><span class="sd">        resolution of grid. See `get_lon` for allowed values</span>
</span><span id="lat2j-349"><a href="#lat2j-349"><span class="linenos">349</span></a>
</span><span id="lat2j-350"><a href="#lat2j-350"><span class="linenos">350</span></a><span class="sd">    Result</span>
</span><span id="lat2j-351"><a href="#lat2j-351"><span class="linenos">351</span></a><span class="sd">    ------</span>
</span><span id="lat2j-352"><a href="#lat2j-352"><span class="linenos">352</span></a><span class="sd">    index : int</span>
</span><span id="lat2j-353"><a href="#lat2j-353"><span class="linenos">353</span></a><span class="sd">        grid index location closest to latitude</span>
</span><span id="lat2j-354"><a href="#lat2j-354"><span class="linenos">354</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="lat2j-355"><a href="#lat2j-355"><span class="linenos">355</span></a>    <span class="n">alat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
</span><span id="lat2j-356"><a href="#lat2j-356"><span class="linenos">356</span></a>    <span class="n">latgrid</span> <span class="o">=</span> <span class="n">get_lat</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lat2j-357"><a href="#lat2j-357"><span class="linenos">357</span></a>    <span class="n">nlat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">latgrid</span><span class="p">)</span>
</span><span id="lat2j-358"><a href="#lat2j-358"><span class="linenos">358</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">alat</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">alat</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">)):</span>
</span><span id="lat2j-359"><a href="#lat2j-359"><span class="linenos">359</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lat must be in the range [-90,90]&#39;</span><span class="p">)</span>    
</span><span id="lat2j-360"><a href="#lat2j-360"><span class="linenos">360</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">latgrid</span><span class="p">,</span>
</span><span id="lat2j-361"><a href="#lat2j-361"><span class="linenos">361</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlat</span><span class="p">),</span>
</span><span id="lat2j-362"><a href="#lat2j-362"><span class="linenos">362</span></a>                <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
</span><span id="lat2j-363"><a href="#lat2j-363"><span class="linenos">363</span></a>                <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
</span><span id="lat2j-364"><a href="#lat2j-364"><span class="linenos">364</span></a>    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">alat</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Find J grid index for latitude</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>lat</strong> (float):
latitude in degrees</li>
<li><strong>res</strong> (float, default=4):
resolution of grid. See <code><a href="#get_lon">get_lon</a></code> for allowed values</li>
</ul>

<h6 id="result">Result</h6>

<p>index : int
    grid index location closest to latitude</p>
</div>


                </section>
                <section id="ll2ij">
                            <input id="ll2ij-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ll2ij</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">lon</span>, </span><span class="param"><span class="n">lat</span>, </span><span class="param"><span class="n">res</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ll2ij-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ll2ij"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ll2ij-366"><a href="#ll2ij-366"><span class="linenos">366</span></a><span class="k">def</span> <span class="nf">ll2ij</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="ll2ij-367"><a href="#ll2ij-367"><span class="linenos">367</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Find (I,J) grid index for longitude, latitude</span>
</span><span id="ll2ij-368"><a href="#ll2ij-368"><span class="linenos">368</span></a>
</span><span id="ll2ij-369"><a href="#ll2ij-369"><span class="linenos">369</span></a>
</span><span id="ll2ij-370"><a href="#ll2ij-370"><span class="linenos">370</span></a><span class="sd">    Parameters</span>
</span><span id="ll2ij-371"><a href="#ll2ij-371"><span class="linenos">371</span></a><span class="sd">    ----------</span>
</span><span id="ll2ij-372"><a href="#ll2ij-372"><span class="linenos">372</span></a><span class="sd">    lon, lat : float</span>
</span><span id="ll2ij-373"><a href="#ll2ij-373"><span class="linenos">373</span></a><span class="sd">        longitude and latitude in degrees</span>
</span><span id="ll2ij-374"><a href="#ll2ij-374"><span class="linenos">374</span></a><span class="sd">    res : float, default=4</span>
</span><span id="ll2ij-375"><a href="#ll2ij-375"><span class="linenos">375</span></a><span class="sd">        resolution of grid. See `get_lon` for allowed values</span>
</span><span id="ll2ij-376"><a href="#ll2ij-376"><span class="linenos">376</span></a>
</span><span id="ll2ij-377"><a href="#ll2ij-377"><span class="linenos">377</span></a><span class="sd">    Result</span>
</span><span id="ll2ij-378"><a href="#ll2ij-378"><span class="linenos">378</span></a><span class="sd">    ------</span>
</span><span id="ll2ij-379"><a href="#ll2ij-379"><span class="linenos">379</span></a><span class="sd">    i, j : int</span>
</span><span id="ll2ij-380"><a href="#ll2ij-380"><span class="linenos">380</span></a><span class="sd">        grid index location closest to longitude, latitude</span>
</span><span id="ll2ij-381"><a href="#ll2ij-381"><span class="linenos">381</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="ll2ij-382"><a href="#ll2ij-382"><span class="linenos">382</span></a>    <span class="n">alon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
</span><span id="ll2ij-383"><a href="#ll2ij-383"><span class="linenos">383</span></a>    <span class="n">alat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
</span><span id="ll2ij-384"><a href="#ll2ij-384"><span class="linenos">384</span></a>    <span class="n">nlon</span> <span class="o">=</span> <span class="n">alon</span><span class="o">.</span><span class="n">size</span>
</span><span id="ll2ij-385"><a href="#ll2ij-385"><span class="linenos">385</span></a>    <span class="n">nlat</span> <span class="o">=</span> <span class="n">alat</span><span class="o">.</span><span class="n">size</span>
</span><span id="ll2ij-386"><a href="#ll2ij-386"><span class="linenos">386</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nlon</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nlat</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ll2ij-387"><a href="#ll2ij-387"><span class="linenos">387</span></a>        <span class="n">alon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">alat</span><span class="p">)</span> <span class="o">*</span> <span class="n">alon</span>
</span><span id="ll2ij-388"><a href="#ll2ij-388"><span class="linenos">388</span></a>    <span class="k">elif</span> <span class="p">(</span><span class="n">nlat</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nlon</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ll2ij-389"><a href="#ll2ij-389"><span class="linenos">389</span></a>        <span class="n">alat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">alon</span><span class="p">)</span> <span class="o">*</span> <span class="n">alat</span>
</span><span id="ll2ij-390"><a href="#ll2ij-390"><span class="linenos">390</span></a>    <span class="k">elif</span> <span class="n">nlon</span> <span class="o">!=</span> <span class="n">nlat</span><span class="p">:</span>
</span><span id="ll2ij-391"><a href="#ll2ij-391"><span class="linenos">391</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon and lat must have the same length or be conformable&#39;</span><span class="p">)</span>
</span><span id="ll2ij-392"><a href="#ll2ij-392"><span class="linenos">392</span></a>    <span class="k">return</span> <span class="n">lon2i</span><span class="p">(</span><span class="n">alon</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">),</span> <span class="n">lat2j</span><span class="p">(</span><span class="n">alat</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Find (I,J) grid index for longitude, latitude</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>lon, lat</strong> (float):
longitude and latitude in degrees</li>
<li><strong>res</strong> (float, default=4):
resolution of grid. See <code><a href="#get_lon">get_lon</a></code> for allowed values</li>
</ul>

<h6 id="result">Result</h6>

<p>i, j : int
    grid index location closest to longitude, latitude</p>
</div>


                </section>
                <section id="get_lon">
                            <input id="get_lon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">res</span><span class="o">=</span><span class="mi">4</span>, </span><span class="param"><span class="n">center</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">edge</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_lon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_lon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_lon-394"><a href="#get_lon-394"><span class="linenos">394</span></a><span class="k">def</span> <span class="nf">get_lon</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="get_lon-395"><a href="#get_lon-395"><span class="linenos">395</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get array of longitudes for grid centers or edges. </span>
</span><span id="get_lon-396"><a href="#get_lon-396"><span class="linenos">396</span></a>
</span><span id="get_lon-397"><a href="#get_lon-397"><span class="linenos">397</span></a><span class="sd">    GMAO grids assumed</span>
</span><span id="get_lon-398"><a href="#get_lon-398"><span class="linenos">398</span></a><span class="sd">    - res = 0.5 for 0.5x0.625</span>
</span><span id="get_lon-399"><a href="#get_lon-399"><span class="linenos">399</span></a><span class="sd">    - res = 2 for 2x2.5</span>
</span><span id="get_lon-400"><a href="#get_lon-400"><span class="linenos">400</span></a><span class="sd">    - res = 4 for 4x5</span>
</span><span id="get_lon-401"><a href="#get_lon-401"><span class="linenos">401</span></a>
</span><span id="get_lon-402"><a href="#get_lon-402"><span class="linenos">402</span></a><span class="sd">    Parameters</span>
</span><span id="get_lon-403"><a href="#get_lon-403"><span class="linenos">403</span></a><span class="sd">    ----------</span>
</span><span id="get_lon-404"><a href="#get_lon-404"><span class="linenos">404</span></a><span class="sd">    res : float, default=4</span>
</span><span id="get_lon-405"><a href="#get_lon-405"><span class="linenos">405</span></a><span class="sd">        latitude resolution of grid</span>
</span><span id="get_lon-406"><a href="#get_lon-406"><span class="linenos">406</span></a><span class="sd">    center, edge : bool or None, default=None</span>
</span><span id="get_lon-407"><a href="#get_lon-407"><span class="linenos">407</span></a><span class="sd">        determines whether returned values are at grid center (center=True) or grid edge (edge=True)</span>
</span><span id="get_lon-408"><a href="#get_lon-408"><span class="linenos">408</span></a><span class="sd">        If both center and edge are None, then center is used</span>
</span><span id="get_lon-409"><a href="#get_lon-409"><span class="linenos">409</span></a>
</span><span id="get_lon-410"><a href="#get_lon-410"><span class="linenos">410</span></a><span class="sd">    Returns</span>
</span><span id="get_lon-411"><a href="#get_lon-411"><span class="linenos">411</span></a><span class="sd">    -------</span>
</span><span id="get_lon-412"><a href="#get_lon-412"><span class="linenos">412</span></a><span class="sd">    lon : array (n,)</span>
</span><span id="get_lon-413"><a href="#get_lon-413"><span class="linenos">413</span></a><span class="sd">        longitude in degrees at grid center or edges</span>
</span><span id="get_lon-414"><a href="#get_lon-414"><span class="linenos">414</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="get_lon-415"><a href="#get_lon-415"><span class="linenos">415</span></a>
</span><span id="get_lon-416"><a href="#get_lon-416"><span class="linenos">416</span></a>    <span class="c1"># Resolve any conflict between center and edge</span>
</span><span id="get_lon-417"><a href="#get_lon-417"><span class="linenos">417</span></a>    <span class="n">center</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">_set_center_edge</span><span class="p">(</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;get_lon&#39;</span> <span class="p">)</span>
</span><span id="get_lon-418"><a href="#get_lon-418"><span class="linenos">418</span></a>
</span><span id="get_lon-419"><a href="#get_lon-419"><span class="linenos">419</span></a>    <span class="c1"># Longitude edges</span>
</span><span id="get_lon-420"><a href="#get_lon-420"><span class="linenos">420</span></a>    <span class="k">if</span> <span class="n">res</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
</span><span id="get_lon-421"><a href="#get_lon-421"><span class="linenos">421</span></a>        <span class="n">dx</span><span class="o">=</span><span class="mf">2.5</span>
</span><span id="get_lon-422"><a href="#get_lon-422"><span class="linenos">422</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
</span><span id="get_lon-423"><a href="#get_lon-423"><span class="linenos">423</span></a>        <span class="n">dx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="get_lon-424"><a href="#get_lon-424"><span class="linenos">424</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mf">0.5</span><span class="p">:</span>
</span><span id="get_lon-425"><a href="#get_lon-425"><span class="linenos">425</span></a>        <span class="n">dx</span><span class="o">=</span><span class="mf">0.625</span>
</span><span id="get_lon-426"><a href="#get_lon-426"><span class="linenos">426</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_lon-427"><a href="#get_lon-427"><span class="linenos">427</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span> <span class="s1">&#39;Resolution &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is not defined&#39;</span> <span class="p">)</span>
</span><span id="get_lon-428"><a href="#get_lon-428"><span class="linenos">428</span></a>
</span><span id="get_lon-429"><a href="#get_lon-429"><span class="linenos">429</span></a>    <span class="c1"># Longitude edges</span>
</span><span id="get_lon-430"><a href="#get_lon-430"><span class="linenos">430</span></a>    <span class="n">lonedge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">-</span> <span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
</span><span id="get_lon-431"><a href="#get_lon-431"><span class="linenos">431</span></a>
</span><span id="get_lon-432"><a href="#get_lon-432"><span class="linenos">432</span></a>    <span class="c1"># Get grid centers, if needed</span>
</span><span id="get_lon-433"><a href="#get_lon-433"><span class="linenos">433</span></a>    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
</span><span id="get_lon-434"><a href="#get_lon-434"><span class="linenos">434</span></a>        <span class="n">lon</span> <span class="o">=</span> <span class="p">(</span> <span class="n">lonedge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lonedge</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="get_lon-435"><a href="#get_lon-435"><span class="linenos">435</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_lon-436"><a href="#get_lon-436"><span class="linenos">436</span></a>        <span class="n">lon</span> <span class="o">=</span> <span class="n">lonedge</span>
</span><span id="get_lon-437"><a href="#get_lon-437"><span class="linenos">437</span></a>
</span><span id="get_lon-438"><a href="#get_lon-438"><span class="linenos">438</span></a>    <span class="k">return</span> <span class="n">lon</span>
</span></pre></div>


            <div class="docstring"><p>Get array of longitudes for grid centers or edges. </p>

<p>GMAO grids assumed</p>

<ul>
<li>res = 0.5 for 0.5x0.625</li>
<li>res = 2 for 2x2.5</li>
<li>res = 4 for 4x5</li>
</ul>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>res</strong> (float, default=4):
latitude resolution of grid</li>
<li><strong>center, edge</strong> (bool or None, default=None):
determines whether returned values are at grid center (center=True) or grid edge (edge=True)
If both center and edge are None, then center is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>lon</strong> (array (n,)):
longitude in degrees at grid center or edges</li>
</ul>
</div>


                </section>
                <section id="get_lat">
                            <input id="get_lat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lat</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">res</span><span class="o">=</span><span class="mi">4</span>, </span><span class="param"><span class="n">center</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">edge</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_lat-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_lat"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_lat-440"><a href="#get_lat-440"><span class="linenos">440</span></a><span class="k">def</span> <span class="nf">get_lat</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="get_lat-441"><a href="#get_lat-441"><span class="linenos">441</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get array of latitudes at grid center or edges</span>
</span><span id="get_lat-442"><a href="#get_lat-442"><span class="linenos">442</span></a>
</span><span id="get_lat-443"><a href="#get_lat-443"><span class="linenos">443</span></a><span class="sd">    GMAO grids assumed</span>
</span><span id="get_lat-444"><a href="#get_lat-444"><span class="linenos">444</span></a><span class="sd">    - res = 0.5 for 0.5x0.625</span>
</span><span id="get_lat-445"><a href="#get_lat-445"><span class="linenos">445</span></a><span class="sd">    - res = 2 for 2x2.5</span>
</span><span id="get_lat-446"><a href="#get_lat-446"><span class="linenos">446</span></a><span class="sd">    - res = 4 for 4x5</span>
</span><span id="get_lat-447"><a href="#get_lat-447"><span class="linenos">447</span></a>
</span><span id="get_lat-448"><a href="#get_lat-448"><span class="linenos">448</span></a><span class="sd">    Parameters</span>
</span><span id="get_lat-449"><a href="#get_lat-449"><span class="linenos">449</span></a><span class="sd">    ----------</span>
</span><span id="get_lat-450"><a href="#get_lat-450"><span class="linenos">450</span></a><span class="sd">    res : float, default=4</span>
</span><span id="get_lat-451"><a href="#get_lat-451"><span class="linenos">451</span></a><span class="sd">        latitude resolution of grid</span>
</span><span id="get_lat-452"><a href="#get_lat-452"><span class="linenos">452</span></a><span class="sd">    center, edge : bool or None, default=None</span>
</span><span id="get_lat-453"><a href="#get_lat-453"><span class="linenos">453</span></a><span class="sd">        determines whether returned values are at grid center (center=True) or grid edge (edge=True)</span>
</span><span id="get_lat-454"><a href="#get_lat-454"><span class="linenos">454</span></a><span class="sd">        If both center and edge are None, then center is used</span>
</span><span id="get_lat-455"><a href="#get_lat-455"><span class="linenos">455</span></a>
</span><span id="get_lat-456"><a href="#get_lat-456"><span class="linenos">456</span></a><span class="sd">    Returns</span>
</span><span id="get_lat-457"><a href="#get_lat-457"><span class="linenos">457</span></a><span class="sd">    -------</span>
</span><span id="get_lat-458"><a href="#get_lat-458"><span class="linenos">458</span></a><span class="sd">    lat : array (n,)</span>
</span><span id="get_lat-459"><a href="#get_lat-459"><span class="linenos">459</span></a><span class="sd">        latitude in degrees at grid center or edges</span>
</span><span id="get_lat-460"><a href="#get_lat-460"><span class="linenos">460</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="get_lat-461"><a href="#get_lat-461"><span class="linenos">461</span></a>
</span><span id="get_lat-462"><a href="#get_lat-462"><span class="linenos">462</span></a>    <span class="c1"># Resolve any conflict between center and edge</span>
</span><span id="get_lat-463"><a href="#get_lat-463"><span class="linenos">463</span></a>    <span class="n">center</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">_set_center_edge</span><span class="p">(</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;get_lat&#39;</span> <span class="p">)</span>
</span><span id="get_lat-464"><a href="#get_lat-464"><span class="linenos">464</span></a>
</span><span id="get_lat-465"><a href="#get_lat-465"><span class="linenos">465</span></a>    <span class="c1"># Latitude edges</span>
</span><span id="get_lat-466"><a href="#get_lat-466"><span class="linenos">466</span></a>    <span class="k">if</span> <span class="n">res</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
</span><span id="get_lat-467"><a href="#get_lat-467"><span class="linenos">467</span></a>        <span class="n">dy</span><span class="o">=</span><span class="mi">2</span>
</span><span id="get_lat-468"><a href="#get_lat-468"><span class="linenos">468</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
</span><span id="get_lat-469"><a href="#get_lat-469"><span class="linenos">469</span></a>        <span class="n">dy</span><span class="o">=</span><span class="mi">4</span>
</span><span id="get_lat-470"><a href="#get_lat-470"><span class="linenos">470</span></a>    <span class="k">elif</span> <span class="n">res</span><span class="o">==</span><span class="mf">0.5</span><span class="p">:</span>
</span><span id="get_lat-471"><a href="#get_lat-471"><span class="linenos">471</span></a>        <span class="n">dy</span><span class="o">=</span><span class="mf">0.5</span>
</span><span id="get_lat-472"><a href="#get_lat-472"><span class="linenos">472</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_lat-473"><a href="#get_lat-473"><span class="linenos">473</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span> <span class="s1">&#39;Resolution &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is not defined&#39;</span> <span class="p">)</span>
</span><span id="get_lat-474"><a href="#get_lat-474"><span class="linenos">474</span></a>
</span><span id="get_lat-475"><a href="#get_lat-475"><span class="linenos">475</span></a>    <span class="c1"># Latitude edges</span>
</span><span id="get_lat-476"><a href="#get_lat-476"><span class="linenos">476</span></a>    <span class="n">latedge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="o">+</span><span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="n">dy</span><span class="p">),</span> <span class="mi">90</span><span class="p">]</span> <span class="p">)</span>
</span><span id="get_lat-477"><a href="#get_lat-477"><span class="linenos">477</span></a>
</span><span id="get_lat-478"><a href="#get_lat-478"><span class="linenos">478</span></a>    <span class="c1"># Get grid centers, if needed</span>
</span><span id="get_lat-479"><a href="#get_lat-479"><span class="linenos">479</span></a>    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
</span><span id="get_lat-480"><a href="#get_lat-480"><span class="linenos">480</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="p">(</span> <span class="n">latedge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">latedge</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="get_lat-481"><a href="#get_lat-481"><span class="linenos">481</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_lat-482"><a href="#get_lat-482"><span class="linenos">482</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="n">latedge</span>
</span><span id="get_lat-483"><a href="#get_lat-483"><span class="linenos">483</span></a>
</span><span id="get_lat-484"><a href="#get_lat-484"><span class="linenos">484</span></a>    <span class="k">return</span> <span class="n">lat</span>
</span></pre></div>


            <div class="docstring"><p>Get array of latitudes at grid center or edges</p>

<p>GMAO grids assumed</p>

<ul>
<li>res = 0.5 for 0.5x0.625</li>
<li>res = 2 for 2x2.5</li>
<li>res = 4 for 4x5</li>
</ul>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>res</strong> (float, default=4):
latitude resolution of grid</li>
<li><strong>center, edge</strong> (bool or None, default=None):
determines whether returned values are at grid center (center=True) or grid edge (edge=True)
If both center and edge are None, then center is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>lat</strong> (array (n,)):
latitude in degrees at grid center or edges</li>
</ul>
</div>


                </section>
                <section id="get_lev_p">
                            <input id="get_lev_p-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lev_p</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">p_surf</span><span class="o">=</span><span class="mf">1013.25</span>, </span><span class="param"><span class="n">nlev</span><span class="o">=</span><span class="mi">47</span>, </span><span class="param"><span class="n">edge</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_lev_p-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_lev_p"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_lev_p-486"><a href="#get_lev_p-486"><span class="linenos">486</span></a><span class="k">def</span> <span class="nf">get_lev_p</span><span class="p">(</span><span class="n">p_surf</span><span class="o">=</span><span class="mf">1013.25</span><span class="p">,</span> <span class="n">nlev</span><span class="o">=</span><span class="mi">47</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="get_lev_p-487"><a href="#get_lev_p-487"><span class="linenos">487</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get array of pressures at grid centers or edges</span>
</span><span id="get_lev_p-488"><a href="#get_lev_p-488"><span class="linenos">488</span></a><span class="sd">    </span>
</span><span id="get_lev_p-489"><a href="#get_lev_p-489"><span class="linenos">489</span></a><span class="sd">    Parameters</span>
</span><span id="get_lev_p-490"><a href="#get_lev_p-490"><span class="linenos">490</span></a><span class="sd">    ----------</span>
</span><span id="get_lev_p-491"><a href="#get_lev_p-491"><span class="linenos">491</span></a><span class="sd">    p_surf : float</span>
</span><span id="get_lev_p-492"><a href="#get_lev_p-492"><span class="linenos">492</span></a><span class="sd">        surface pressure, hPa</span>
</span><span id="get_lev_p-493"><a href="#get_lev_p-493"><span class="linenos">493</span></a><span class="sd">    nlev : {47,72}</span>
</span><span id="get_lev_p-494"><a href="#get_lev_p-494"><span class="linenos">494</span></a><span class="sd">        number of vertical levels (47 or 72)</span>
</span><span id="get_lev_p-495"><a href="#get_lev_p-495"><span class="linenos">495</span></a><span class="sd">    edge : bool</span>
</span><span id="get_lev_p-496"><a href="#get_lev_p-496"><span class="linenos">496</span></a><span class="sd">        specify edges (True) or centers (False, default)</span>
</span><span id="get_lev_p-497"><a href="#get_lev_p-497"><span class="linenos">497</span></a><span class="sd">        </span>
</span><span id="get_lev_p-498"><a href="#get_lev_p-498"><span class="linenos">498</span></a><span class="sd">    Returns</span>
</span><span id="get_lev_p-499"><a href="#get_lev_p-499"><span class="linenos">499</span></a><span class="sd">    -------</span>
</span><span id="get_lev_p-500"><a href="#get_lev_p-500"><span class="linenos">500</span></a><span class="sd">    p : array of float</span>
</span><span id="get_lev_p-501"><a href="#get_lev_p-501"><span class="linenos">501</span></a><span class="sd">        pressures for each vertical level&#39;&#39;&#39;</span>
</span><span id="get_lev_p-502"><a href="#get_lev_p-502"><span class="linenos">502</span></a>
</span><span id="get_lev_p-503"><a href="#get_lev_p-503"><span class="linenos">503</span></a>    <span class="c1"># Get A,B values for vertical coordinate</span>
</span><span id="get_lev_p-504"><a href="#get_lev_p-504"><span class="linenos">504</span></a>    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">get_hybrid_ab</span><span class="p">(</span><span class="n">nlev</span><span class="o">=</span><span class="n">nlev</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">edge</span> <span class="p">)</span>
</span><span id="get_lev_p-505"><a href="#get_lev_p-505"><span class="linenos">505</span></a>
</span><span id="get_lev_p-506"><a href="#get_lev_p-506"><span class="linenos">506</span></a>    <span class="c1"># Pressure, hPa</span>
</span><span id="get_lev_p-507"><a href="#get_lev_p-507"><span class="linenos">507</span></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">p_surf</span>
</span><span id="get_lev_p-508"><a href="#get_lev_p-508"><span class="linenos">508</span></a>
</span><span id="get_lev_p-509"><a href="#get_lev_p-509"><span class="linenos">509</span></a>    <span class="k">return</span> <span class="n">P</span>
</span></pre></div>


            <div class="docstring"><p>Get array of pressures at grid centers or edges</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_surf</strong> (float):
surface pressure, hPa</li>
<li><strong>nlev</strong> ({47,72}):
number of vertical levels (47 or 72)</li>
<li><strong>edge</strong> (bool):
specify edges (True) or centers (False, default)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>p</strong> (array of float):
pressures for each vertical level</li>
</ul>
</div>


                </section>
                <section id="get_lev_z">
                            <input id="get_lev_z-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lev_z</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">TK</span><span class="o">=</span><span class="p">[</span><span class="mi">273</span><span class="p">]</span>, </span><span class="param"><span class="n">p_surf</span><span class="o">=</span><span class="mf">1013.25</span>, </span><span class="param"><span class="n">p_edge</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>, </span><span class="param"><span class="n">Q</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">z_surf</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">edge</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_lev_z-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_lev_z"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_lev_z-512"><a href="#get_lev_z-512"><span class="linenos">512</span></a><span class="k">def</span> <span class="nf">get_lev_z</span><span class="p">(</span><span class="n">TK</span><span class="o">=</span><span class="p">[</span><span class="mi">273</span><span class="p">],</span> <span class="n">p_surf</span><span class="o">=</span><span class="mf">1013.25</span><span class="p">,</span> <span class="n">p_edge</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_surf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="get_lev_z-513"><a href="#get_lev_z-513"><span class="linenos">513</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Calculate the geopotential heights of level edges or centers</span>
</span><span id="get_lev_z-514"><a href="#get_lev_z-514"><span class="linenos">514</span></a>
</span><span id="get_lev_z-515"><a href="#get_lev_z-515"><span class="linenos">515</span></a><span class="sd">    Calculations use hypsometric equation, assuing hydrostatic balance</span>
</span><span id="get_lev_z-516"><a href="#get_lev_z-516"><span class="linenos">516</span></a>
</span><span id="get_lev_z-517"><a href="#get_lev_z-517"><span class="linenos">517</span></a><span class="sd">    Parameters</span>
</span><span id="get_lev_z-518"><a href="#get_lev_z-518"><span class="linenos">518</span></a><span class="sd">    ----------</span>
</span><span id="get_lev_z-519"><a href="#get_lev_z-519"><span class="linenos">519</span></a><span class="sd">    TK : array of float</span>
</span><span id="get_lev_z-520"><a href="#get_lev_z-520"><span class="linenos">520</span></a><span class="sd">        Temperature for each grid level, K</span>
</span><span id="get_lev_z-521"><a href="#get_lev_z-521"><span class="linenos">521</span></a><span class="sd">    p_surf : float</span>
</span><span id="get_lev_z-522"><a href="#get_lev_z-522"><span class="linenos">522</span></a><span class="sd">        Surface pressure, hPa</span>
</span><span id="get_lev_z-523"><a href="#get_lev_z-523"><span class="linenos">523</span></a><span class="sd">    p_edge : array of float, optional</span>
</span><span id="get_lev_z-524"><a href="#get_lev_z-524"><span class="linenos">524</span></a><span class="sd">        Pressure at each grid level edge, hPa</span>
</span><span id="get_lev_z-525"><a href="#get_lev_z-525"><span class="linenos">525</span></a><span class="sd">        Will be calculated if length differs from TK</span>
</span><span id="get_lev_z-526"><a href="#get_lev_z-526"><span class="linenos">526</span></a><span class="sd">    Q : array of float</span>
</span><span id="get_lev_z-527"><a href="#get_lev_z-527"><span class="linenos">527</span></a><span class="sd">        Specific humidity for each grid level, kg/kg </span>
</span><span id="get_lev_z-528"><a href="#get_lev_z-528"><span class="linenos">528</span></a><span class="sd">    z_surf : float</span>
</span><span id="get_lev_z-529"><a href="#get_lev_z-529"><span class="linenos">529</span></a><span class="sd">        Surface altitude, m</span>
</span><span id="get_lev_z-530"><a href="#get_lev_z-530"><span class="linenos">530</span></a><span class="sd">    edge : bool</span>
</span><span id="get_lev_z-531"><a href="#get_lev_z-531"><span class="linenos">531</span></a><span class="sd">        specify edges (True) or centers (False, default) for output</span>
</span><span id="get_lev_z-532"><a href="#get_lev_z-532"><span class="linenos">532</span></a>
</span><span id="get_lev_z-533"><a href="#get_lev_z-533"><span class="linenos">533</span></a><span class="sd">    Returns</span>
</span><span id="get_lev_z-534"><a href="#get_lev_z-534"><span class="linenos">534</span></a><span class="sd">    -------</span>
</span><span id="get_lev_z-535"><a href="#get_lev_z-535"><span class="linenos">535</span></a><span class="sd">    z : array of float</span>
</span><span id="get_lev_z-536"><a href="#get_lev_z-536"><span class="linenos">536</span></a><span class="sd">        Geopotential height for each grid edge or center, m</span>
</span><span id="get_lev_z-537"><a href="#get_lev_z-537"><span class="linenos">537</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="get_lev_z-538"><a href="#get_lev_z-538"><span class="linenos">538</span></a>
</span><span id="get_lev_z-539"><a href="#get_lev_z-539"><span class="linenos">539</span></a>    <span class="n">funname</span><span class="o">=</span><span class="s1">&#39;geoschem: get_lev_z: &#39;</span>
</span><span id="get_lev_z-540"><a href="#get_lev_z-540"><span class="linenos">540</span></a>
</span><span id="get_lev_z-541"><a href="#get_lev_z-541"><span class="linenos">541</span></a>    <span class="c1"># Acceleration due to gravity, m/s2</span>
</span><span id="get_lev_z-542"><a href="#get_lev_z-542"><span class="linenos">542</span></a>    <span class="n">g0</span> <span class="o">=</span> <span class="mf">9.81</span>
</span><span id="get_lev_z-543"><a href="#get_lev_z-543"><span class="linenos">543</span></a>
</span><span id="get_lev_z-544"><a href="#get_lev_z-544"><span class="linenos">544</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TK</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="get_lev_z-545"><a href="#get_lev_z-545"><span class="linenos">545</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">funname</span><span class="p">,</span><span class="s1">&#39;TK must be an array&#39;</span><span class="p">)</span>
</span><span id="get_lev_z-546"><a href="#get_lev_z-546"><span class="linenos">546</span></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="get_lev_z-547"><a href="#get_lev_z-547"><span class="linenos">547</span></a>
</span><span id="get_lev_z-548"><a href="#get_lev_z-548"><span class="linenos">548</span></a>    <span class="c1"># Number of levels in the temperature profile</span>
</span><span id="get_lev_z-549"><a href="#get_lev_z-549"><span class="linenos">549</span></a>    <span class="n">nlev</span> <span class="o">=</span> <span class="n">TK</span><span class="o">.</span><span class="n">size</span>
</span><span id="get_lev_z-550"><a href="#get_lev_z-550"><span class="linenos">550</span></a>
</span><span id="get_lev_z-551"><a href="#get_lev_z-551"><span class="linenos">551</span></a>    <span class="c1"># Calculate the pressure edges if they aren&#39;t provided in input</span>
</span><span id="get_lev_z-552"><a href="#get_lev_z-552"><span class="linenos">552</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_edge</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nlev</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
</span><span id="get_lev_z-553"><a href="#get_lev_z-553"><span class="linenos">553</span></a>        <span class="c1"># Get pressure at level edges, hPa</span>
</span><span id="get_lev_z-554"><a href="#get_lev_z-554"><span class="linenos">554</span></a>        <span class="n">p_edge</span> <span class="o">=</span> <span class="n">get_lev_p</span><span class="p">(</span><span class="n">p_surf</span><span class="o">=</span><span class="n">p_surf</span><span class="p">,</span> <span class="n">nlev</span><span class="o">=</span><span class="n">nlev</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
</span><span id="get_lev_z-555"><a href="#get_lev_z-555"><span class="linenos">555</span></a>
</span><span id="get_lev_z-556"><a href="#get_lev_z-556"><span class="linenos">556</span></a>    <span class="c1"># Initialize array</span>
</span><span id="get_lev_z-557"><a href="#get_lev_z-557"><span class="linenos">557</span></a>    <span class="n">z_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p_edge</span><span class="p">)</span>
</span><span id="get_lev_z-558"><a href="#get_lev_z-558"><span class="linenos">558</span></a>    <span class="n">z_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_surf</span>
</span><span id="get_lev_z-559"><a href="#get_lev_z-559"><span class="linenos">559</span></a>
</span><span id="get_lev_z-560"><a href="#get_lev_z-560"><span class="linenos">560</span></a>    <span class="c1"># Virtual temperature, K</span>
</span><span id="get_lev_z-561"><a href="#get_lev_z-561"><span class="linenos">561</span></a>    <span class="n">Tv</span> <span class="o">=</span> <span class="n">TK</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.61</span> <span class="o">*</span> <span class="n">Q</span> <span class="p">)</span>
</span><span id="get_lev_z-562"><a href="#get_lev_z-562"><span class="linenos">562</span></a>
</span><span id="get_lev_z-563"><a href="#get_lev_z-563"><span class="linenos">563</span></a>    <span class="c1"># Calculate altitudes with hypsometric equation, m</span>
</span><span id="get_lev_z-564"><a href="#get_lev_z-564"><span class="linenos">564</span></a>    <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_edge</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="get_lev_z-565"><a href="#get_lev_z-565"><span class="linenos">565</span></a>        <span class="n">z_edge</span><span class="p">[</span><span class="n">L</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_edge</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">287</span> <span class="o">*</span> <span class="n">Tv</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">g0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">p_edge</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">p_edge</span><span class="p">[</span><span class="n">L</span><span class="p">]</span> <span class="p">)</span>
</span><span id="get_lev_z-566"><a href="#get_lev_z-566"><span class="linenos">566</span></a>
</span><span id="get_lev_z-567"><a href="#get_lev_z-567"><span class="linenos">567</span></a>    <span class="c1"># Choose grid edge or center altitudes, m</span>
</span><span id="get_lev_z-568"><a href="#get_lev_z-568"><span class="linenos">568</span></a>    <span class="k">if</span> <span class="n">edge</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="get_lev_z-569"><a href="#get_lev_z-569"><span class="linenos">569</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">z_edge</span>
</span><span id="get_lev_z-570"><a href="#get_lev_z-570"><span class="linenos">570</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_lev_z-571"><a href="#get_lev_z-571"><span class="linenos">571</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">z_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="get_lev_z-572"><a href="#get_lev_z-572"><span class="linenos">572</span></a>
</span><span id="get_lev_z-573"><a href="#get_lev_z-573"><span class="linenos">573</span></a>    <span class="k">return</span> <span class="n">z</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the geopotential heights of level edges or centers</p>

<p>Calculations use hypsometric equation, assuing hydrostatic balance</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>TK</strong> (array of float):
Temperature for each grid level, K</li>
<li><strong>p_surf</strong> (float):
Surface pressure, hPa</li>
<li><strong>p_edge</strong> (array of float, optional):
Pressure at each grid level edge, hPa
Will be calculated if length differs from TK</li>
<li><strong>Q</strong> (array of float):
Specific humidity for each grid level, kg/kg</li>
<li><strong>z_surf</strong> (float):
Surface altitude, m</li>
<li><strong>edge</strong> (bool):
specify edges (True) or centers (False, default) for output</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>z</strong> (array of float):
Geopotential height for each grid edge or center, m</li>
</ul>
</div>


                </section>
                <section id="get_hybrid_ab">
                            <input id="get_hybrid_ab-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_hybrid_ab</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">nlev</span><span class="o">=</span><span class="mi">47</span>, </span><span class="param"><span class="n">edge</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">center</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_hybrid_ab-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_hybrid_ab"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_hybrid_ab-575"><a href="#get_hybrid_ab-575"><span class="linenos">575</span></a><span class="k">def</span> <span class="nf">get_hybrid_ab</span><span class="p">(</span><span class="n">nlev</span><span class="o">=</span><span class="mi">47</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="get_hybrid_ab-576"><a href="#get_hybrid_ab-576"><span class="linenos">576</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Get A and B values for the GEOS-5/MERRA/MERRA2 hybrid sigma-pressure vertical coordinate.</span>
</span><span id="get_hybrid_ab-577"><a href="#get_hybrid_ab-577"><span class="linenos">577</span></a>
</span><span id="get_hybrid_ab-578"><a href="#get_hybrid_ab-578"><span class="linenos">578</span></a><span class="sd">    The pressure at level edge L is P(L) = A(L) + B(L) * PS, where PS is surface pressure in hPa</span>
</span><span id="get_hybrid_ab-579"><a href="#get_hybrid_ab-579"><span class="linenos">579</span></a>
</span><span id="get_hybrid_ab-580"><a href="#get_hybrid_ab-580"><span class="linenos">580</span></a><span class="sd">    Parameters</span>
</span><span id="get_hybrid_ab-581"><a href="#get_hybrid_ab-581"><span class="linenos">581</span></a><span class="sd">    ----------</span>
</span><span id="get_hybrid_ab-582"><a href="#get_hybrid_ab-582"><span class="linenos">582</span></a><span class="sd">    nlev : {47,72}</span>
</span><span id="get_hybrid_ab-583"><a href="#get_hybrid_ab-583"><span class="linenos">583</span></a><span class="sd">        number of levels in the desired grid (47 or 72)</span>
</span><span id="get_hybrid_ab-584"><a href="#get_hybrid_ab-584"><span class="linenos">584</span></a><span class="sd">    center, edge : bool</span>
</span><span id="get_hybrid_ab-585"><a href="#get_hybrid_ab-585"><span class="linenos">585</span></a><span class="sd">        specify if values for level center or edges are desired</span>
</span><span id="get_hybrid_ab-586"><a href="#get_hybrid_ab-586"><span class="linenos">586</span></a>
</span><span id="get_hybrid_ab-587"><a href="#get_hybrid_ab-587"><span class="linenos">587</span></a><span class="sd">    Returns </span>
</span><span id="get_hybrid_ab-588"><a href="#get_hybrid_ab-588"><span class="linenos">588</span></a><span class="sd">    -------</span>
</span><span id="get_hybrid_ab-589"><a href="#get_hybrid_ab-589"><span class="linenos">589</span></a><span class="sd">    A, B : array (n,)</span>
</span><span id="get_hybrid_ab-590"><a href="#get_hybrid_ab-590"><span class="linenos">590</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="get_hybrid_ab-591"><a href="#get_hybrid_ab-591"><span class="linenos">591</span></a>
</span><span id="get_hybrid_ab-592"><a href="#get_hybrid_ab-592"><span class="linenos">592</span></a>    <span class="c1"># Resolve any conflict between center and edge requests</span>
</span><span id="get_hybrid_ab-593"><a href="#get_hybrid_ab-593"><span class="linenos">593</span></a>    <span class="n">center</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">_set_center_edge</span><span class="p">(</span> <span class="n">center</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;get_hybrid_ab&#39;</span><span class="p">)</span>
</span><span id="get_hybrid_ab-594"><a href="#get_hybrid_ab-594"><span class="linenos">594</span></a>
</span><span id="get_hybrid_ab-595"><a href="#get_hybrid_ab-595"><span class="linenos">595</span></a>    <span class="k">if</span> <span class="n">nlev</span> <span class="o">==</span> <span class="mi">47</span><span class="p">:</span>
</span><span id="get_hybrid_ab-596"><a href="#get_hybrid_ab-596"><span class="linenos">596</span></a>
</span><span id="get_hybrid_ab-597"><a href="#get_hybrid_ab-597"><span class="linenos">597</span></a>        <span class="c1"># A [hPa] for 47 levels (48 edges)</span>
</span><span id="get_hybrid_ab-598"><a href="#get_hybrid_ab-598"><span class="linenos">598</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">4.804826E-02</span><span class="p">,</span> <span class="mf">6.593752E+00</span><span class="p">,</span> <span class="mf">1.313480E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-599"><a href="#get_hybrid_ab-599"><span class="linenos">599</span></a>               <span class="mf">1.961311E+01</span><span class="p">,</span> <span class="mf">2.609201E+01</span><span class="p">,</span> <span class="mf">3.257081E+01</span><span class="p">,</span> <span class="mf">3.898201E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-600"><a href="#get_hybrid_ab-600"><span class="linenos">600</span></a>               <span class="mf">4.533901E+01</span><span class="p">,</span> <span class="mf">5.169611E+01</span><span class="p">,</span> <span class="mf">5.805321E+01</span><span class="p">,</span> <span class="mf">6.436264E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-601"><a href="#get_hybrid_ab-601"><span class="linenos">601</span></a>               <span class="mf">7.062198E+01</span><span class="p">,</span> <span class="mf">7.883422E+01</span><span class="p">,</span> <span class="mf">8.909992E+01</span><span class="p">,</span> <span class="mf">9.936521E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-602"><a href="#get_hybrid_ab-602"><span class="linenos">602</span></a>               <span class="mf">1.091817E+02</span><span class="p">,</span> <span class="mf">1.189586E+02</span><span class="p">,</span> <span class="mf">1.286959E+02</span><span class="p">,</span> <span class="mf">1.429100E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-603"><a href="#get_hybrid_ab-603"><span class="linenos">603</span></a>               <span class="mf">1.562600E+02</span><span class="p">,</span> <span class="mf">1.696090E+02</span><span class="p">,</span> <span class="mf">1.816190E+02</span><span class="p">,</span> <span class="mf">1.930970E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-604"><a href="#get_hybrid_ab-604"><span class="linenos">604</span></a>               <span class="mf">2.032590E+02</span><span class="p">,</span> <span class="mf">2.121500E+02</span><span class="p">,</span> <span class="mf">2.187760E+02</span><span class="p">,</span> <span class="mf">2.238980E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-605"><a href="#get_hybrid_ab-605"><span class="linenos">605</span></a>               <span class="mf">2.243630E+02</span><span class="p">,</span> <span class="mf">2.168650E+02</span><span class="p">,</span> <span class="mf">2.011920E+02</span><span class="p">,</span> <span class="mf">1.769300E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-606"><a href="#get_hybrid_ab-606"><span class="linenos">606</span></a>               <span class="mf">1.503930E+02</span><span class="p">,</span> <span class="mf">1.278370E+02</span><span class="p">,</span> <span class="mf">1.086630E+02</span><span class="p">,</span> <span class="mf">9.236572E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-607"><a href="#get_hybrid_ab-607"><span class="linenos">607</span></a>               <span class="mf">7.851231E+01</span><span class="p">,</span> <span class="mf">5.638791E+01</span><span class="p">,</span> <span class="mf">4.017541E+01</span><span class="p">,</span> <span class="mf">2.836781E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-608"><a href="#get_hybrid_ab-608"><span class="linenos">608</span></a>               <span class="mf">1.979160E+01</span><span class="p">,</span> <span class="mf">9.292942E+00</span><span class="p">,</span> <span class="mf">4.076571E+00</span><span class="p">,</span> <span class="mf">1.650790E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-609"><a href="#get_hybrid_ab-609"><span class="linenos">609</span></a>               <span class="mf">6.167791E-01</span><span class="p">,</span> <span class="mf">2.113490E-01</span><span class="p">,</span> <span class="mf">6.600001E-02</span><span class="p">,</span> <span class="mf">1.000000E-02</span> <span class="p">]</span> <span class="p">)</span>
</span><span id="get_hybrid_ab-610"><a href="#get_hybrid_ab-610"><span class="linenos">610</span></a>
</span><span id="get_hybrid_ab-611"><a href="#get_hybrid_ab-611"><span class="linenos">611</span></a>        <span class="c1"># Bp [unitless] for 47 levels (48 edges)</span>
</span><span id="get_hybrid_ab-612"><a href="#get_hybrid_ab-612"><span class="linenos">612</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.000000E+00</span><span class="p">,</span> <span class="mf">9.849520E-01</span><span class="p">,</span> <span class="mf">9.634060E-01</span><span class="p">,</span> <span class="mf">9.418650E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-613"><a href="#get_hybrid_ab-613"><span class="linenos">613</span></a>               <span class="mf">9.203870E-01</span><span class="p">,</span> <span class="mf">8.989080E-01</span><span class="p">,</span> <span class="mf">8.774290E-01</span><span class="p">,</span> <span class="mf">8.560180E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-614"><a href="#get_hybrid_ab-614"><span class="linenos">614</span></a>               <span class="mf">8.346609E-01</span><span class="p">,</span> <span class="mf">8.133039E-01</span><span class="p">,</span> <span class="mf">7.919469E-01</span><span class="p">,</span> <span class="mf">7.706375E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-615"><a href="#get_hybrid_ab-615"><span class="linenos">615</span></a>               <span class="mf">7.493782E-01</span><span class="p">,</span> <span class="mf">7.211660E-01</span><span class="p">,</span> <span class="mf">6.858999E-01</span><span class="p">,</span> <span class="mf">6.506349E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-616"><a href="#get_hybrid_ab-616"><span class="linenos">616</span></a>               <span class="mf">6.158184E-01</span><span class="p">,</span> <span class="mf">5.810415E-01</span><span class="p">,</span> <span class="mf">5.463042E-01</span><span class="p">,</span> <span class="mf">4.945902E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-617"><a href="#get_hybrid_ab-617"><span class="linenos">617</span></a>               <span class="mf">4.437402E-01</span><span class="p">,</span> <span class="mf">3.928911E-01</span><span class="p">,</span> <span class="mf">3.433811E-01</span><span class="p">,</span> <span class="mf">2.944031E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-618"><a href="#get_hybrid_ab-618"><span class="linenos">618</span></a>               <span class="mf">2.467411E-01</span><span class="p">,</span> <span class="mf">2.003501E-01</span><span class="p">,</span> <span class="mf">1.562241E-01</span><span class="p">,</span> <span class="mf">1.136021E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-619"><a href="#get_hybrid_ab-619"><span class="linenos">619</span></a>               <span class="mf">6.372006E-02</span><span class="p">,</span> <span class="mf">2.801004E-02</span><span class="p">,</span> <span class="mf">6.960025E-03</span><span class="p">,</span> <span class="mf">8.175413E-09</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-620"><a href="#get_hybrid_ab-620"><span class="linenos">620</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-621"><a href="#get_hybrid_ab-621"><span class="linenos">621</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-622"><a href="#get_hybrid_ab-622"><span class="linenos">622</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-623"><a href="#get_hybrid_ab-623"><span class="linenos">623</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span> <span class="p">]</span> <span class="p">)</span>
</span><span id="get_hybrid_ab-624"><a href="#get_hybrid_ab-624"><span class="linenos">624</span></a>
</span><span id="get_hybrid_ab-625"><a href="#get_hybrid_ab-625"><span class="linenos">625</span></a>    <span class="k">elif</span> <span class="n">nlev</span> <span class="o">==</span> <span class="mi">72</span><span class="p">:</span>
</span><span id="get_hybrid_ab-626"><a href="#get_hybrid_ab-626"><span class="linenos">626</span></a>
</span><span id="get_hybrid_ab-627"><a href="#get_hybrid_ab-627"><span class="linenos">627</span></a>        <span class="c1"># A [hPa] for 72 levels (73 edges)</span>
</span><span id="get_hybrid_ab-628"><a href="#get_hybrid_ab-628"><span class="linenos">628</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">4.804826E-02</span><span class="p">,</span> <span class="mf">6.593752E+00</span><span class="p">,</span> <span class="mf">1.313480E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-629"><a href="#get_hybrid_ab-629"><span class="linenos">629</span></a>               <span class="mf">1.961311E+01</span><span class="p">,</span> <span class="mf">2.609201E+01</span><span class="p">,</span> <span class="mf">3.257081E+01</span><span class="p">,</span> <span class="mf">3.898201E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-630"><a href="#get_hybrid_ab-630"><span class="linenos">630</span></a>               <span class="mf">4.533901E+01</span><span class="p">,</span> <span class="mf">5.169611E+01</span><span class="p">,</span> <span class="mf">5.805321E+01</span><span class="p">,</span> <span class="mf">6.436264E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-631"><a href="#get_hybrid_ab-631"><span class="linenos">631</span></a>               <span class="mf">7.062198E+01</span><span class="p">,</span> <span class="mf">7.883422E+01</span><span class="p">,</span> <span class="mf">8.909992E+01</span><span class="p">,</span> <span class="mf">9.936521E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-632"><a href="#get_hybrid_ab-632"><span class="linenos">632</span></a>               <span class="mf">1.091817E+02</span><span class="p">,</span> <span class="mf">1.189586E+02</span><span class="p">,</span> <span class="mf">1.286959E+02</span><span class="p">,</span> <span class="mf">1.429100E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-633"><a href="#get_hybrid_ab-633"><span class="linenos">633</span></a>               <span class="mf">1.562600E+02</span><span class="p">,</span> <span class="mf">1.696090E+02</span><span class="p">,</span> <span class="mf">1.816190E+02</span><span class="p">,</span> <span class="mf">1.930970E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-634"><a href="#get_hybrid_ab-634"><span class="linenos">634</span></a>               <span class="mf">2.032590E+02</span><span class="p">,</span> <span class="mf">2.121500E+02</span><span class="p">,</span> <span class="mf">2.187760E+02</span><span class="p">,</span> <span class="mf">2.238980E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-635"><a href="#get_hybrid_ab-635"><span class="linenos">635</span></a>               <span class="mf">2.243630E+02</span><span class="p">,</span> <span class="mf">2.168650E+02</span><span class="p">,</span> <span class="mf">2.011920E+02</span><span class="p">,</span> <span class="mf">1.769300E+02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-636"><a href="#get_hybrid_ab-636"><span class="linenos">636</span></a>               <span class="mf">1.503930E+02</span><span class="p">,</span> <span class="mf">1.278370E+02</span><span class="p">,</span> <span class="mf">1.086630E+02</span><span class="p">,</span> <span class="mf">9.236572E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-637"><a href="#get_hybrid_ab-637"><span class="linenos">637</span></a>               <span class="mf">7.851231E+01</span><span class="p">,</span> <span class="mf">6.660341E+01</span><span class="p">,</span> <span class="mf">5.638791E+01</span><span class="p">,</span> <span class="mf">4.764391E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-638"><a href="#get_hybrid_ab-638"><span class="linenos">638</span></a>               <span class="mf">4.017541E+01</span><span class="p">,</span> <span class="mf">3.381001E+01</span><span class="p">,</span> <span class="mf">2.836781E+01</span><span class="p">,</span> <span class="mf">2.373041E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-639"><a href="#get_hybrid_ab-639"><span class="linenos">639</span></a>               <span class="mf">1.979160E+01</span><span class="p">,</span> <span class="mf">1.645710E+01</span><span class="p">,</span> <span class="mf">1.364340E+01</span><span class="p">,</span> <span class="mf">1.127690E+01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-640"><a href="#get_hybrid_ab-640"><span class="linenos">640</span></a>               <span class="mf">9.292942E+00</span><span class="p">,</span> <span class="mf">7.619842E+00</span><span class="p">,</span> <span class="mf">6.216801E+00</span><span class="p">,</span> <span class="mf">5.046801E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-641"><a href="#get_hybrid_ab-641"><span class="linenos">641</span></a>               <span class="mf">4.076571E+00</span><span class="p">,</span> <span class="mf">3.276431E+00</span><span class="p">,</span> <span class="mf">2.620211E+00</span><span class="p">,</span> <span class="mf">2.084970E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-642"><a href="#get_hybrid_ab-642"><span class="linenos">642</span></a>               <span class="mf">1.650790E+00</span><span class="p">,</span> <span class="mf">1.300510E+00</span><span class="p">,</span> <span class="mf">1.019440E+00</span><span class="p">,</span> <span class="mf">7.951341E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-643"><a href="#get_hybrid_ab-643"><span class="linenos">643</span></a>               <span class="mf">6.167791E-01</span><span class="p">,</span> <span class="mf">4.758061E-01</span><span class="p">,</span> <span class="mf">3.650411E-01</span><span class="p">,</span> <span class="mf">2.785261E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-644"><a href="#get_hybrid_ab-644"><span class="linenos">644</span></a>               <span class="mf">2.113490E-01</span><span class="p">,</span> <span class="mf">1.594950E-01</span><span class="p">,</span> <span class="mf">1.197030E-01</span><span class="p">,</span> <span class="mf">8.934502E-02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-645"><a href="#get_hybrid_ab-645"><span class="linenos">645</span></a>               <span class="mf">6.600001E-02</span><span class="p">,</span> <span class="mf">4.758501E-02</span><span class="p">,</span> <span class="mf">3.270000E-02</span><span class="p">,</span> <span class="mf">2.000000E-02</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-646"><a href="#get_hybrid_ab-646"><span class="linenos">646</span></a>               <span class="mf">1.000000E-02</span> <span class="p">]</span> <span class="p">)</span>
</span><span id="get_hybrid_ab-647"><a href="#get_hybrid_ab-647"><span class="linenos">647</span></a>
</span><span id="get_hybrid_ab-648"><a href="#get_hybrid_ab-648"><span class="linenos">648</span></a>        <span class="c1"># B [unitless] for 72 levels (73 edges)</span>
</span><span id="get_hybrid_ab-649"><a href="#get_hybrid_ab-649"><span class="linenos">649</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.000000E+00</span><span class="p">,</span> <span class="mf">9.849520E-01</span><span class="p">,</span> <span class="mf">9.634060E-01</span><span class="p">,</span> <span class="mf">9.418650E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-650"><a href="#get_hybrid_ab-650"><span class="linenos">650</span></a>               <span class="mf">9.203870E-01</span><span class="p">,</span> <span class="mf">8.989080E-01</span><span class="p">,</span> <span class="mf">8.774290E-01</span><span class="p">,</span> <span class="mf">8.560180E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-651"><a href="#get_hybrid_ab-651"><span class="linenos">651</span></a>               <span class="mf">8.346609E-01</span><span class="p">,</span> <span class="mf">8.133039E-01</span><span class="p">,</span> <span class="mf">7.919469E-01</span><span class="p">,</span> <span class="mf">7.706375E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-652"><a href="#get_hybrid_ab-652"><span class="linenos">652</span></a>               <span class="mf">7.493782E-01</span><span class="p">,</span> <span class="mf">7.211660E-01</span><span class="p">,</span> <span class="mf">6.858999E-01</span><span class="p">,</span> <span class="mf">6.506349E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-653"><a href="#get_hybrid_ab-653"><span class="linenos">653</span></a>               <span class="mf">6.158184E-01</span><span class="p">,</span> <span class="mf">5.810415E-01</span><span class="p">,</span> <span class="mf">5.463042E-01</span><span class="p">,</span> <span class="mf">4.945902E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-654"><a href="#get_hybrid_ab-654"><span class="linenos">654</span></a>               <span class="mf">4.437402E-01</span><span class="p">,</span> <span class="mf">3.928911E-01</span><span class="p">,</span> <span class="mf">3.433811E-01</span><span class="p">,</span> <span class="mf">2.944031E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-655"><a href="#get_hybrid_ab-655"><span class="linenos">655</span></a>               <span class="mf">2.467411E-01</span><span class="p">,</span> <span class="mf">2.003501E-01</span><span class="p">,</span> <span class="mf">1.562241E-01</span><span class="p">,</span> <span class="mf">1.136021E-01</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-656"><a href="#get_hybrid_ab-656"><span class="linenos">656</span></a>               <span class="mf">6.372006E-02</span><span class="p">,</span> <span class="mf">2.801004E-02</span><span class="p">,</span> <span class="mf">6.960025E-03</span><span class="p">,</span> <span class="mf">8.175413E-09</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-657"><a href="#get_hybrid_ab-657"><span class="linenos">657</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-658"><a href="#get_hybrid_ab-658"><span class="linenos">658</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-659"><a href="#get_hybrid_ab-659"><span class="linenos">659</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-660"><a href="#get_hybrid_ab-660"><span class="linenos">660</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-661"><a href="#get_hybrid_ab-661"><span class="linenos">661</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-662"><a href="#get_hybrid_ab-662"><span class="linenos">662</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-663"><a href="#get_hybrid_ab-663"><span class="linenos">663</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-664"><a href="#get_hybrid_ab-664"><span class="linenos">664</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-665"><a href="#get_hybrid_ab-665"><span class="linenos">665</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-666"><a href="#get_hybrid_ab-666"><span class="linenos">666</span></a>               <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> <span class="mf">0.000000E+00</span><span class="p">,</span> 
</span><span id="get_hybrid_ab-667"><a href="#get_hybrid_ab-667"><span class="linenos">667</span></a>               <span class="mf">0.000000E+00</span> <span class="p">])</span>
</span><span id="get_hybrid_ab-668"><a href="#get_hybrid_ab-668"><span class="linenos">668</span></a>
</span><span id="get_hybrid_ab-669"><a href="#get_hybrid_ab-669"><span class="linenos">669</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_hybrid_ab-670"><a href="#get_hybrid_ab-670"><span class="linenos">670</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;get_hybrid_ab: A, B not defined for nlev=</span><span class="si">{</span><span class="n">nlev</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span>
</span><span id="get_hybrid_ab-671"><a href="#get_hybrid_ab-671"><span class="linenos">671</span></a>
</span><span id="get_hybrid_ab-672"><a href="#get_hybrid_ab-672"><span class="linenos">672</span></a>    <span class="c1"># Calculate values at level center</span>
</span><span id="get_hybrid_ab-673"><a href="#get_hybrid_ab-673"><span class="linenos">673</span></a>    <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="get_hybrid_ab-674"><a href="#get_hybrid_ab-674"><span class="linenos">674</span></a>
</span><span id="get_hybrid_ab-675"><a href="#get_hybrid_ab-675"><span class="linenos">675</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="get_hybrid_ab-676"><a href="#get_hybrid_ab-676"><span class="linenos">676</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="get_hybrid_ab-677"><a href="#get_hybrid_ab-677"><span class="linenos">677</span></a>
</span><span id="get_hybrid_ab-678"><a href="#get_hybrid_ab-678"><span class="linenos">678</span></a>    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span>
</span></pre></div>


            <div class="docstring"><p>Get A and B values for the GEOS-5/MERRA/MERRA2 hybrid sigma-pressure vertical coordinate.</p>

<p>The pressure at level edge L is P(L) = A(L) + B(L) * PS, where PS is surface pressure in hPa</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>nlev</strong> ({47,72}):
number of levels in the desired grid (47 or 72)</li>
<li><strong>center, edge</strong> (bool):
specify if values for level center or edges are desired</li>
</ul>

<h6 id="returns">Returns</h6>

<p>A, B : array (n,)</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>