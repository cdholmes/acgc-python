<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>acgc.stats.bivariate_lines API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../stats.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;acgc.stats</a>

            <img src="https://acgc.eoas.fsu.edu/wiki/_media/wiki/logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#sma">sma</a>
            </li>
            <li>
                    <a class="function" href="#smafit">smafit</a>
            </li>
            <li>
                    <a class="function" href="#sen">sen</a>
            </li>
            <li>
                    <a class="function" href="#sen_slope">sen_slope</a>
            </li>
            <li>
                    <a class="function" href="#york">york</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../acgc.html">acgc</a><wbr>.<a href="./../stats.html">stats</a><wbr>.bivariate_lines    </h1>

                        <div class="docstring"><p>Specialized methods of bivariate line fitting</p>

<ul>
<li>Standard major axis (SMA) also called reduced major axis (RMA)</li>
<li>York regression, for data with errors in x and y</li>
<li>Theil-Sen, non-parametric slope estimation (use numba to accelerate the function in this module)</li>
</ul>
</div>

                        <input id="mod-bivariate_lines-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-bivariate_lines-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&quot;&quot;&quot;Specialized methods of bivariate line fitting</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">* Standard major axis (SMA) also called reduced major axis (RMA)</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">* York regression, for data with errors in x and y</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">* Theil-Sen, non-parametric slope estimation (use numba to accelerate the function in this module)</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1"># from collections import namedtuple</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">sklearn.covariance</span> <span class="kn">import</span> <span class="n">MinCovDet</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">statsmodels.robust.norms</span> <span class="k">as</span> <span class="nn">norms</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1">#from numba import jit</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="s2">&quot;sma&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="s2">&quot;smafit&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="s2">&quot;sen&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>    <span class="s2">&quot;sen_slope&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="s2">&quot;york&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="p">]</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="c1"># Aliases</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="k">def</span> <span class="nf">sen_slope</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Alias for `sen`&#39;&#39;&#39;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="k">return</span> <span class="n">sen</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">def</span> <span class="nf">smafit</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Alias for `sma`&#39;&#39;&#39;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="k">return</span> <span class="n">sma</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="k">def</span> <span class="nf">sma</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>           <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>           <span class="n">cl</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>           <span class="n">intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>           <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">robust_method</span><span class="o">=</span><span class="s1">&#39;FastMCD&#39;</span><span class="p">):</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Standard Major-Axis (SMA) line fitting</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    </span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    Calculate standard major axis, aka reduced major axis, fit to </span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    data X and Y. The main advantage of this over ordinary least squares is </span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    that the best fit of Y to X will be the same as the best fit of X to Y.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    </span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    The fit equations and confidence intervals are implemented following </span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    Warton et al. (2006). Robust fits use the FastMCD covariance estimate </span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    from Rousseeuw and Van Driessen (1999). While there are many alternative </span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    robust covariance estimators (e.g. other papers by D.I. Warton using M-estimators), </span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    the FastMCD algorithm is default in Matlab. When the standard error or </span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    uncertainty of each point is known, then weighted SMA may be preferrable to </span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    robust SMA. The conventional choice of weights for each point i is </span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    W_i = 1 / ( var(X_i) + var(Y_i) ), where var() is the variance </span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    (squared standard error).</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    </span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    References </span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    Warton, D. I., Wright, I. J., Falster, D. S. and Westoby, M.: </span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        Bivariate line-fitting methods for allometry, Biol. Rev., 81(02), 259, </span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">        doi:10.1017/S1464793106007007, 2006.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    Rousseeuw, P. J. and Van Driessen, K.: A Fast Algorithm for the Minimum </span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        Covariance Determinant Estimator, Technometrics, 41(3), 1999.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    Parameters</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    ----------</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    X, Y : array_like or str</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        Input values, Must have same length.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    W    : array_like or str, optional</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        array of weights for each X-Y point, typically W_i = 1/(var(X_i)+var(Y_i)) </span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    data : dict_like, optional</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        data structure containing variables. Used when X, Y, or W are str.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    cl   : float (default = 0.95)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        Desired confidence level for output. </span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    intercept : bool, default=True</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        Specify if the fitted model should include a non-zero intercept.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        The model will be forced through the origin (0,0) if intercept=False.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">        Use statistical methods that are robust to the presence of outliers</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    robust_method: {&#39;FastMCD&#39; (default), &#39;Huber&#39;, &#39;Biweight&#39;}</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        Method for calculating robust variance and covariance. Options:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        - &#39;MCD&#39; or &#39;FastMCD&#39; for Fast MCD</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        - &#39;Huber&#39; for Huber&#39;s T: reduce, not eliminate, influence of outliers</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        - &#39;Biweight&#39; for Tukey&#39;s Biweight: reduces then eliminates influence of outliers</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        </span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">    Returns</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    -------</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    fitresult : dict </span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        Contains the following keys:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        - slope (float)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">            Slope or Gradient of Y vs. X</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        - intercept (float)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">            Y intercept.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        - slope_ste (float)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            Standard error of slope estimate</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        - intercept_ste (float)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">            standard error of intercept estimate</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        - slope_interval ([float, float])</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            confidence interval for gradient at confidence level cl</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        - intercept_interval ([float, float])</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">            confidence interval for intercept at confidence level cl</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        - df_model (float)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">            degrees of freedom for model</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        - df_resid (float)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">            degrees of freedom for residuals</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        - params ([float,float])</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">            array of fitted parameters</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">str2var</span><span class="p">(</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="p">):</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;Extract variable named v from Dataframe named data&#39;&#39;&#39;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Argument data must be provided with a key named &#39;</span><span class="o">+</span><span class="n">v</span> <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>    <span class="c1"># If variables are provided as strings, get values from the data structure</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">str2var</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">str2var</span><span class="p">(</span> <span class="n">Y</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">W</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">str2var</span><span class="p">(</span> <span class="n">W</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="c1"># Make sure arrays have the same length</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="k">assert</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="p">),</span> <span class="s1">&#39;Arrays X and Y must have the same length&#39;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="k">if</span> <span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="k">assert</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="p">),</span> <span class="s1">&#39;Array W must have the same length as X and Y&#39;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="c1"># Make sure cl is within the range 0-1</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">cl</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;cl must be less than 1&#39;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">cl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;cl must be greater than 0&#39;</span>  
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="c1"># Drop any NaN elements of X, Y, or W</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="c1"># Infinite values are allowed but will make the result undefined</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="c1"># idx = ~np.logical_or( np.isnan(X0), np.isnan(Y0) )</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="n">X0</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="n">Y0</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="n">W0</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>    <span class="c1"># Number of observations</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X0</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="c1"># Degrees of freedom for the model</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="k">if</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="n">dfmod</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="n">dfmod</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="c1"># Choose whether to use methods robust to outliers</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="c1"># Choose the robust method</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="p">((</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;mcd&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;fastmcd&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="c1"># FAST MCD</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="c1"># intercept=False could possibly be supported by calculating</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                <span class="c1"># using mcd.support_ as weights in an explicit variance/covariance calculation</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;FastMCD method only supports SMA with intercept&#39;</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="c1"># Fit robust model of mean and covariance</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="n">mcd</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="c1"># Robust mean</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">location_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">location_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>            <span class="c1"># Robust variance of X, Y</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="n">Vx</span>    <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">covariance_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">Vy</span>    <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">covariance_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="c1"># Robust covariance</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="n">Vxy</span>   <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">covariance_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="c1"># Number of observations used in mean and covariance estimate</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="c1"># excludes observations marked as outliers</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">support_</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">elif</span> <span class="p">((</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;biweight&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;huber&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="c1"># Tukey&#39;s Biweight and Huber&#39;s T</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="k">if</span> <span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;biweight&#39;</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>                <span class="n">norm</span> <span class="o">=</span> <span class="n">norms</span><span class="o">.</span><span class="n">TukeyBiweight</span><span class="p">()</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>                <span class="n">norm</span> <span class="o">=</span> <span class="n">norms</span><span class="o">.</span><span class="n">HuberT</span><span class="p">()</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="c1"># Get weights for downweighting outliers</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="c1"># Fitting a linear model the easiest way to get these</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>            <span class="c1"># Options include &quot;TukeyBiweight&quot; (totally removes large deviates)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="c1"># &quot;HuberT&quot; (linear, not squared weighting of large deviates)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="n">rweights</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">rlm</span><span class="p">(</span><span class="s1">&#39;y~x+1&#39;</span><span class="p">,{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">X0</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">Y0</span><span class="p">},</span><span class="n">M</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">weights</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="c1"># Sum of weight and weights squared, for convienience</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="n">rsum</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">rweights</span> <span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="n">rsum2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="c1"># Mean</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">X0</span> <span class="o">*</span> <span class="n">rweights</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">Y0</span> <span class="o">*</span> <span class="n">rweights</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="c1"># Force intercept through zero, if requested</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>                <span class="n">Xmean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>                <span class="n">Ymean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="c1"># Variance &amp; Covariance</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">Vx</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">X0</span><span class="o">-</span><span class="n">Xmean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum2</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="n">Vy</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">Y0</span><span class="o">-</span><span class="n">Ymean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum2</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="n">Vxy</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">X0</span><span class="o">-</span><span class="n">Xmean</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y0</span><span class="o">-</span><span class="n">Ymean</span><span class="p">)</span> <span class="o">*</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum2</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="c1"># Effective number of observations</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="n">rsum</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;sma hasn&#39;t implemented robust_method={:</span><span class="si">%s</span><span class="s2">}&quot;</span><span class="o">.</span>\
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>                                      <span class="nb">format</span><span class="p">(</span><span class="n">robust_method</span><span class="p">))</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="n">wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="c1"># Average values</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X0</span> <span class="o">*</span> <span class="n">W0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Y0</span> <span class="o">*</span> <span class="n">W0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="c1"># Covariance matrix</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span> <span class="n">X0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aweights</span><span class="o">=</span><span class="n">W0</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="c1"># Variance</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="n">Vx</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="n">Vy</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="c1"># Covariance</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="n">Vxy</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="c1"># Force the line to pass through origin by setting means to zero</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="n">wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W0</span><span class="p">)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="c1"># Sum of squares in place of variance and covariance</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="n">Vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">X0</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">W0</span> <span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">Vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">Y0</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">W0</span> <span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="n">Vxy</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">X0</span><span class="o">*</span><span class="n">Y0</span> <span class="o">*</span> <span class="n">W0</span> <span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="c1"># Standard deviation</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="n">Sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Vx</span> <span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="n">Sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Vy</span> <span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="c1"># Correlation coefficient (equivalent to np.corrcoef()[1,0] for non-robust cases)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">Vxy</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Vx</span> <span class="o">*</span> <span class="n">Vy</span> <span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="c1">#############</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>    <span class="c1"># SLOPE</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>    <span class="n">Slope</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">Sy</span> <span class="o">/</span> <span class="n">Sx</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>    <span class="c1"># Standard error of slope estimate</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="n">ste_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span> <span class="o">*</span> <span class="n">Sy</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">Sx</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>    <span class="c1"># Confidence interval for Slope</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    <span class="n">ci_grad</span> <span class="o">=</span> <span class="n">Slope</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">B</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>    <span class="c1">#############</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>    <span class="c1"># INTERCEPT</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>    <span class="k">if</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">Intercept</span> <span class="o">=</span> <span class="n">Ymean</span> <span class="o">-</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">Xmean</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="c1"># Standard deviation of residuals</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="c1"># New Method: Formula from smatr R package (Warton)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="c1"># This formula avoids large residuals of outliers when using robust=True</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">Sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Vy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">Vxy</span> <span class="o">+</span> <span class="n">Slope</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>  <span class="n">Vx</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="c1"># OLD METHOD</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="c1"># Standard deviation of residuals</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="c1">#resid = Y0 - (Intercept + Slope * X0 )    </span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="c1"># Population standard deviation of the residuals</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="c1">#Sr = np.std( resid, ddof=0 )      </span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="c1"># Standard error of the intercept estimate</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="n">ste_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Sr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">N</span> <span class="o">+</span> <span class="n">Xmean</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ste_slope</span><span class="o">**</span><span class="mi">2</span>  <span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="c1"># Confidence interval for Intercept</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">tcrit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">isf</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cl</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">ci_int</span> <span class="o">=</span> <span class="n">Intercept</span> <span class="o">+</span> <span class="n">ste_int</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">tcrit</span><span class="p">,</span><span class="n">tcrit</span><span class="p">])</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="c1"># Set Intercept quantities to zero</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="n">Intercept</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="n">ste_int</span>   <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="n">ci_int</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">slope</span>            <span class="o">=</span> <span class="n">Slope</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                   <span class="n">intercept</span>        <span class="o">=</span> <span class="n">Intercept</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                   <span class="n">slope_ste</span>        <span class="o">=</span> <span class="n">ste_slope</span><span class="p">,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                   <span class="n">intercept_ste</span>    <span class="o">=</span> <span class="n">ste_int</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                   <span class="n">slope_interval</span>   <span class="o">=</span> <span class="n">ci_grad</span><span class="p">,</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                   <span class="n">intercept_interval</span> <span class="o">=</span> <span class="n">ci_int</span><span class="p">,</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                   <span class="n">df_model</span>         <span class="o">=</span> <span class="n">dfmod</span><span class="p">,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                   <span class="n">df_resid</span>         <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                   <span class="n">params</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Slope</span><span class="p">,</span><span class="n">Intercept</span><span class="p">]),</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                   <span class="n">nobs</span>             <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                   <span class="n">fittedvalues</span>     <span class="o">=</span> <span class="n">Intercept</span> <span class="o">+</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">X0</span><span class="p">,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>                   <span class="n">resid</span>            <span class="o">=</span> <span class="n">Intercept</span> <span class="o">+</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">X0</span> <span class="o">-</span> <span class="n">Y0</span> <span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>    <span class="c1"># return Slope, Intercept, ste_slope, ste_int, ci_grad, ci_int</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="k">def</span> <span class="nf">york</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">err_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">err_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rerr_xy</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;York regression accounting for error in x and y</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">    Follows the notation and algorithm of York et al. (2004) Section III</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">    </span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">    Parameters</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">    ----------</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">    x, y : ndarray</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        dependent (x) and independent (y) variables for fitting</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">    err_x, err_y : ndarray (default=1)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        standard deviation of errors/uncertainty in x and y</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">    rerr_xy : float (default=0)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        correlation coefficient for errors in x and y, </span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        default to rerr_xy=0 meaning that the errors in x are unrelated to errors in y</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        err_x, err_y, and rerr_xy can be constants or arrays of the same length as x and y</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">    </span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">    Returns</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">    -------</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">    fitresult : dict </span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        Contains the following keys:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        - slope (float)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            Slope or Gradient of Y vs. X</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        - intercept (float)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            Y intercept.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">        - slope_ste (float)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">            Standard error of slope estimate</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        - intercept_ste (float)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">            standard error of intercept estimate</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">        - slope_interval ([float, float])</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">            confidence interval for gradient at confidence level cl</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">        - intercept_interval ([float, float])</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">            confidence interval for intercept at confidence level cl</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">        - df_model (float)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">            degrees of freedom for model</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">        - df_resid (float)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">            degrees of freedom for residuals</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        - params ([float,float])</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">            array of fitted parameters</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="c1"># relative error tolerance required for convergence</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-15</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>    <span class="c1"># Initial guess for slope, from ordinary least squares</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="c1"># Weights for x and y</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="n">wx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">err_x</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="n">wy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">err_y</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>    <span class="c1"># Combined weights</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span> <span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>    <span class="c1"># Iterate until solution converges, but not more 50 times</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="n">maxiter</span><span class="o">=</span><span class="mi">50</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">maxiter</span><span class="p">):</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="c1"># Weight for point i</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">/</span> <span class="p">(</span> <span class="n">wx</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">rerr_xy</span> <span class="o">*</span> <span class="n">alpha</span> <span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="n">Wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="c1"># Weighted means</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="n">Xbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">x</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="n">Ybar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">y</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="c1"># Deviation from weighted means</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">Xbar</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">V</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">Ybar</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="c1"># parameter needed for slope</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">beta</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="p">(</span> <span class="n">U</span> <span class="o">/</span> <span class="n">wy</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span> <span class="o">/</span> <span class="n">wx</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">U</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">rerr_xy</span> <span class="o">/</span> <span class="n">alpha</span> <span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="c1"># Update slope estimate</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">bnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">V</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">U</span> <span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="c1"># Break from loop if new value is very close to old value</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">bnew</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">b</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">rtol</span><span class="p">:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>            <span class="k">break</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">bnew</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">maxiter</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;York regression failed to converge in </span><span class="si">{</span><span class="n">maxiter</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1"> iterations&#39;</span> <span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>    <span class="c1"># Intercept</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">Ybar</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">Xbar</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>    <span class="c1"># least-squares adjusted points, expectation values of X and Y</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>    <span class="n">xa</span> <span class="o">=</span> <span class="n">Xbar</span> <span class="o">+</span> <span class="n">beta</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="n">ya</span> <span class="o">=</span> <span class="n">Ybar</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">beta</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    <span class="c1"># Mean of adjusted points</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>    <span class="n">xabar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">xa</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>    <span class="n">yabar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">ya</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="c1"># Devaiation of adjusted points from their means</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>    <span class="n">u</span> <span class="o">=</span> <span class="n">xa</span> <span class="o">-</span> <span class="n">xabar</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">ya</span> <span class="o">-</span> <span class="n">yabar</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="c1"># Variance of slope and intercept estimates</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>    <span class="n">varb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>    <span class="n">vara</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Wsum</span> <span class="o">+</span> <span class="n">xabar</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">varb</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>    <span class="c1"># Standard error of slope and intercept</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>    <span class="n">siga</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">vara</span> <span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>    <span class="n">sigb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">varb</span> <span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>    <span class="c1"># Define a named tuple type that will contain the results</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="c1"># result = namedtuple( &#39;result&#39;, &#39;slope intercept sigs sigi params sigma&#39; )</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>    <span class="c1"># Return results as a named tuple, User can access as a regular tuple too</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>    <span class="c1"># return result( b, a, sigb, siga, [b,a], [sigb, siga] )</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="n">dfmod</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">slope</span>         <span class="o">=</span> <span class="n">b</span><span class="p">,</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                <span class="n">intercept</span>        <span class="o">=</span> <span class="n">a</span><span class="p">,</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                <span class="n">slope_ste</span>        <span class="o">=</span> <span class="n">sigb</span><span class="p">,</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>                <span class="n">intercept_ste</span>    <span class="o">=</span> <span class="n">siga</span><span class="p">,</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>                <span class="n">slope_interval</span>   <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>                <span class="n">intercept_interval</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>                <span class="n">df_model</span>         <span class="o">=</span> <span class="n">dfmod</span><span class="p">,</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                <span class="n">df_resid</span>         <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                <span class="n">params</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">]),</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>                <span class="n">nobs</span>             <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                <span class="n">fittedvalues</span>     <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                <span class="n">resid</span>            <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="c1">#@jit(nopython=True)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="k">def</span> <span class="nf">sen</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">):</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Estimate linear trend using the Thiel-Sen method</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">    </span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">    This non-parametric method finds the median slope among all</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">    combinations of time points. </span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    scipy.stats.theilslopes provides the same slope estimate, with  </span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">    confidence intervals. However, this function is faster for </span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">    large datasets due to Numba </span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">    </span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">    Parameters</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">    ----------</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">    x : array_like (N,)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">        independent variable</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">    y : array_like (N,)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">        dependent variable</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">    </span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">    Returns</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">    -------</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">    sen : float</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        the median slope</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">    slopes : array (N*N,)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">        all slope estimates from all combinations of x and y</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sen function is slow unless numba.jit is used. Use scipy.stats.theilslopes instead.&#39;</span><span class="p">,</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>                    <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">y</span> <span class="p">):</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inputs x and y must have same dimension&#39;</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>    <span class="c1"># Find number of time points</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>    <span class="c1"># Array to hold all slope estimates</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>    <span class="n">slopes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="c1"># Slope between elements i and j</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="n">slopeij</span> <span class="o">=</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="n">slopes</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">slopeij</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>    <span class="c1"># Thiel-Sen estimate is the median slope, neglecting NaN</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>    <span class="n">sen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span> <span class="n">slopes</span> <span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>    <span class="k">return</span> <span class="n">sen</span><span class="p">,</span> <span class="n">slopes</span>
</span></pre></div>


            </section>
                <section id="sma">
                            <input id="sma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sma</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">X</span>,</span><span class="param">	<span class="n">Y</span>,</span><span class="param">	<span class="n">W</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">data</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cl</span><span class="o">=</span><span class="mf">0.95</span>,</span><span class="param">	<span class="n">intercept</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">robust</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">robust_method</span><span class="o">=</span><span class="s1">&#39;FastMCD&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sma-33"><a href="#sma-33"><span class="linenos"> 33</span></a><span class="k">def</span> <span class="nf">sma</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="sma-34"><a href="#sma-34"><span class="linenos"> 34</span></a>           <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="sma-35"><a href="#sma-35"><span class="linenos"> 35</span></a>           <span class="n">cl</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
</span><span id="sma-36"><a href="#sma-36"><span class="linenos"> 36</span></a>           <span class="n">intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="sma-37"><a href="#sma-37"><span class="linenos"> 37</span></a>           <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">robust_method</span><span class="o">=</span><span class="s1">&#39;FastMCD&#39;</span><span class="p">):</span>
</span><span id="sma-38"><a href="#sma-38"><span class="linenos"> 38</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Standard Major-Axis (SMA) line fitting</span>
</span><span id="sma-39"><a href="#sma-39"><span class="linenos"> 39</span></a><span class="sd">    </span>
</span><span id="sma-40"><a href="#sma-40"><span class="linenos"> 40</span></a><span class="sd">    Calculate standard major axis, aka reduced major axis, fit to </span>
</span><span id="sma-41"><a href="#sma-41"><span class="linenos"> 41</span></a><span class="sd">    data X and Y. The main advantage of this over ordinary least squares is </span>
</span><span id="sma-42"><a href="#sma-42"><span class="linenos"> 42</span></a><span class="sd">    that the best fit of Y to X will be the same as the best fit of X to Y.</span>
</span><span id="sma-43"><a href="#sma-43"><span class="linenos"> 43</span></a><span class="sd">    </span>
</span><span id="sma-44"><a href="#sma-44"><span class="linenos"> 44</span></a><span class="sd">    The fit equations and confidence intervals are implemented following </span>
</span><span id="sma-45"><a href="#sma-45"><span class="linenos"> 45</span></a><span class="sd">    Warton et al. (2006). Robust fits use the FastMCD covariance estimate </span>
</span><span id="sma-46"><a href="#sma-46"><span class="linenos"> 46</span></a><span class="sd">    from Rousseeuw and Van Driessen (1999). While there are many alternative </span>
</span><span id="sma-47"><a href="#sma-47"><span class="linenos"> 47</span></a><span class="sd">    robust covariance estimators (e.g. other papers by D.I. Warton using M-estimators), </span>
</span><span id="sma-48"><a href="#sma-48"><span class="linenos"> 48</span></a><span class="sd">    the FastMCD algorithm is default in Matlab. When the standard error or </span>
</span><span id="sma-49"><a href="#sma-49"><span class="linenos"> 49</span></a><span class="sd">    uncertainty of each point is known, then weighted SMA may be preferrable to </span>
</span><span id="sma-50"><a href="#sma-50"><span class="linenos"> 50</span></a><span class="sd">    robust SMA. The conventional choice of weights for each point i is </span>
</span><span id="sma-51"><a href="#sma-51"><span class="linenos"> 51</span></a><span class="sd">    W_i = 1 / ( var(X_i) + var(Y_i) ), where var() is the variance </span>
</span><span id="sma-52"><a href="#sma-52"><span class="linenos"> 52</span></a><span class="sd">    (squared standard error).</span>
</span><span id="sma-53"><a href="#sma-53"><span class="linenos"> 53</span></a><span class="sd">    </span>
</span><span id="sma-54"><a href="#sma-54"><span class="linenos"> 54</span></a><span class="sd">    References </span>
</span><span id="sma-55"><a href="#sma-55"><span class="linenos"> 55</span></a><span class="sd">    Warton, D. I., Wright, I. J., Falster, D. S. and Westoby, M.: </span>
</span><span id="sma-56"><a href="#sma-56"><span class="linenos"> 56</span></a><span class="sd">        Bivariate line-fitting methods for allometry, Biol. Rev., 81(02), 259, </span>
</span><span id="sma-57"><a href="#sma-57"><span class="linenos"> 57</span></a><span class="sd">        doi:10.1017/S1464793106007007, 2006.</span>
</span><span id="sma-58"><a href="#sma-58"><span class="linenos"> 58</span></a><span class="sd">    Rousseeuw, P. J. and Van Driessen, K.: A Fast Algorithm for the Minimum </span>
</span><span id="sma-59"><a href="#sma-59"><span class="linenos"> 59</span></a><span class="sd">        Covariance Determinant Estimator, Technometrics, 41(3), 1999.</span>
</span><span id="sma-60"><a href="#sma-60"><span class="linenos"> 60</span></a>
</span><span id="sma-61"><a href="#sma-61"><span class="linenos"> 61</span></a><span class="sd">    Parameters</span>
</span><span id="sma-62"><a href="#sma-62"><span class="linenos"> 62</span></a><span class="sd">    ----------</span>
</span><span id="sma-63"><a href="#sma-63"><span class="linenos"> 63</span></a><span class="sd">    X, Y : array_like or str</span>
</span><span id="sma-64"><a href="#sma-64"><span class="linenos"> 64</span></a><span class="sd">        Input values, Must have same length.</span>
</span><span id="sma-65"><a href="#sma-65"><span class="linenos"> 65</span></a><span class="sd">    W    : array_like or str, optional</span>
</span><span id="sma-66"><a href="#sma-66"><span class="linenos"> 66</span></a><span class="sd">        array of weights for each X-Y point, typically W_i = 1/(var(X_i)+var(Y_i)) </span>
</span><span id="sma-67"><a href="#sma-67"><span class="linenos"> 67</span></a><span class="sd">    data : dict_like, optional</span>
</span><span id="sma-68"><a href="#sma-68"><span class="linenos"> 68</span></a><span class="sd">        data structure containing variables. Used when X, Y, or W are str.</span>
</span><span id="sma-69"><a href="#sma-69"><span class="linenos"> 69</span></a><span class="sd">    cl   : float (default = 0.95)</span>
</span><span id="sma-70"><a href="#sma-70"><span class="linenos"> 70</span></a><span class="sd">        Desired confidence level for output. </span>
</span><span id="sma-71"><a href="#sma-71"><span class="linenos"> 71</span></a><span class="sd">    intercept : bool, default=True</span>
</span><span id="sma-72"><a href="#sma-72"><span class="linenos"> 72</span></a><span class="sd">        Specify if the fitted model should include a non-zero intercept.</span>
</span><span id="sma-73"><a href="#sma-73"><span class="linenos"> 73</span></a><span class="sd">        The model will be forced through the origin (0,0) if intercept=False.</span>
</span><span id="sma-74"><a href="#sma-74"><span class="linenos"> 74</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="sma-75"><a href="#sma-75"><span class="linenos"> 75</span></a><span class="sd">        Use statistical methods that are robust to the presence of outliers</span>
</span><span id="sma-76"><a href="#sma-76"><span class="linenos"> 76</span></a><span class="sd">    robust_method: {&#39;FastMCD&#39; (default), &#39;Huber&#39;, &#39;Biweight&#39;}</span>
</span><span id="sma-77"><a href="#sma-77"><span class="linenos"> 77</span></a><span class="sd">        Method for calculating robust variance and covariance. Options:</span>
</span><span id="sma-78"><a href="#sma-78"><span class="linenos"> 78</span></a><span class="sd">        - &#39;MCD&#39; or &#39;FastMCD&#39; for Fast MCD</span>
</span><span id="sma-79"><a href="#sma-79"><span class="linenos"> 79</span></a><span class="sd">        - &#39;Huber&#39; for Huber&#39;s T: reduce, not eliminate, influence of outliers</span>
</span><span id="sma-80"><a href="#sma-80"><span class="linenos"> 80</span></a><span class="sd">        - &#39;Biweight&#39; for Tukey&#39;s Biweight: reduces then eliminates influence of outliers</span>
</span><span id="sma-81"><a href="#sma-81"><span class="linenos"> 81</span></a>
</span><span id="sma-82"><a href="#sma-82"><span class="linenos"> 82</span></a><span class="sd">        </span>
</span><span id="sma-83"><a href="#sma-83"><span class="linenos"> 83</span></a><span class="sd">    Returns</span>
</span><span id="sma-84"><a href="#sma-84"><span class="linenos"> 84</span></a><span class="sd">    -------</span>
</span><span id="sma-85"><a href="#sma-85"><span class="linenos"> 85</span></a><span class="sd">    fitresult : dict </span>
</span><span id="sma-86"><a href="#sma-86"><span class="linenos"> 86</span></a><span class="sd">        Contains the following keys:</span>
</span><span id="sma-87"><a href="#sma-87"><span class="linenos"> 87</span></a><span class="sd">        - slope (float)</span>
</span><span id="sma-88"><a href="#sma-88"><span class="linenos"> 88</span></a><span class="sd">            Slope or Gradient of Y vs. X</span>
</span><span id="sma-89"><a href="#sma-89"><span class="linenos"> 89</span></a><span class="sd">        - intercept (float)</span>
</span><span id="sma-90"><a href="#sma-90"><span class="linenos"> 90</span></a><span class="sd">            Y intercept.</span>
</span><span id="sma-91"><a href="#sma-91"><span class="linenos"> 91</span></a><span class="sd">        - slope_ste (float)</span>
</span><span id="sma-92"><a href="#sma-92"><span class="linenos"> 92</span></a><span class="sd">            Standard error of slope estimate</span>
</span><span id="sma-93"><a href="#sma-93"><span class="linenos"> 93</span></a><span class="sd">        - intercept_ste (float)</span>
</span><span id="sma-94"><a href="#sma-94"><span class="linenos"> 94</span></a><span class="sd">            standard error of intercept estimate</span>
</span><span id="sma-95"><a href="#sma-95"><span class="linenos"> 95</span></a><span class="sd">        - slope_interval ([float, float])</span>
</span><span id="sma-96"><a href="#sma-96"><span class="linenos"> 96</span></a><span class="sd">            confidence interval for gradient at confidence level cl</span>
</span><span id="sma-97"><a href="#sma-97"><span class="linenos"> 97</span></a><span class="sd">        - intercept_interval ([float, float])</span>
</span><span id="sma-98"><a href="#sma-98"><span class="linenos"> 98</span></a><span class="sd">            confidence interval for intercept at confidence level cl</span>
</span><span id="sma-99"><a href="#sma-99"><span class="linenos"> 99</span></a><span class="sd">        - df_model (float)</span>
</span><span id="sma-100"><a href="#sma-100"><span class="linenos">100</span></a><span class="sd">            degrees of freedom for model</span>
</span><span id="sma-101"><a href="#sma-101"><span class="linenos">101</span></a><span class="sd">        - df_resid (float)</span>
</span><span id="sma-102"><a href="#sma-102"><span class="linenos">102</span></a><span class="sd">            degrees of freedom for residuals</span>
</span><span id="sma-103"><a href="#sma-103"><span class="linenos">103</span></a><span class="sd">        - params ([float,float])</span>
</span><span id="sma-104"><a href="#sma-104"><span class="linenos">104</span></a><span class="sd">            array of fitted parameters</span>
</span><span id="sma-105"><a href="#sma-105"><span class="linenos">105</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="sma-106"><a href="#sma-106"><span class="linenos">106</span></a>
</span><span id="sma-107"><a href="#sma-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">str2var</span><span class="p">(</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="p">):</span>
</span><span id="sma-108"><a href="#sma-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;Extract variable named v from Dataframe named data&#39;&#39;&#39;</span>
</span><span id="sma-109"><a href="#sma-109"><span class="linenos">109</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="sma-110"><a href="#sma-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
</span><span id="sma-111"><a href="#sma-111"><span class="linenos">111</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="sma-112"><a href="#sma-112"><span class="linenos">112</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Argument data must be provided with a key named &#39;</span><span class="o">+</span><span class="n">v</span> <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="sma-113"><a href="#sma-113"><span class="linenos">113</span></a>
</span><span id="sma-114"><a href="#sma-114"><span class="linenos">114</span></a>    <span class="c1"># If variables are provided as strings, get values from the data structure</span>
</span><span id="sma-115"><a href="#sma-115"><span class="linenos">115</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
</span><span id="sma-116"><a href="#sma-116"><span class="linenos">116</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">str2var</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
</span><span id="sma-117"><a href="#sma-117"><span class="linenos">117</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
</span><span id="sma-118"><a href="#sma-118"><span class="linenos">118</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">str2var</span><span class="p">(</span> <span class="n">Y</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
</span><span id="sma-119"><a href="#sma-119"><span class="linenos">119</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">W</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
</span><span id="sma-120"><a href="#sma-120"><span class="linenos">120</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">str2var</span><span class="p">(</span> <span class="n">W</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
</span><span id="sma-121"><a href="#sma-121"><span class="linenos">121</span></a>
</span><span id="sma-122"><a href="#sma-122"><span class="linenos">122</span></a>    <span class="c1"># Make sure arrays have the same length</span>
</span><span id="sma-123"><a href="#sma-123"><span class="linenos">123</span></a>    <span class="k">assert</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="p">),</span> <span class="s1">&#39;Arrays X and Y must have the same length&#39;</span>
</span><span id="sma-124"><a href="#sma-124"><span class="linenos">124</span></a>    <span class="k">if</span> <span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="sma-125"><a href="#sma-125"><span class="linenos">125</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="sma-126"><a href="#sma-126"><span class="linenos">126</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="sma-127"><a href="#sma-127"><span class="linenos">127</span></a>        <span class="k">assert</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="p">),</span> <span class="s1">&#39;Array W must have the same length as X and Y&#39;</span>
</span><span id="sma-128"><a href="#sma-128"><span class="linenos">128</span></a>
</span><span id="sma-129"><a href="#sma-129"><span class="linenos">129</span></a>    <span class="c1"># Make sure cl is within the range 0-1</span>
</span><span id="sma-130"><a href="#sma-130"><span class="linenos">130</span></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">cl</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;cl must be less than 1&#39;</span>
</span><span id="sma-131"><a href="#sma-131"><span class="linenos">131</span></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">cl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;cl must be greater than 0&#39;</span>  
</span><span id="sma-132"><a href="#sma-132"><span class="linenos">132</span></a>
</span><span id="sma-133"><a href="#sma-133"><span class="linenos">133</span></a>    <span class="c1"># Drop any NaN elements of X, Y, or W</span>
</span><span id="sma-134"><a href="#sma-134"><span class="linenos">134</span></a>    <span class="c1"># Infinite values are allowed but will make the result undefined</span>
</span><span id="sma-135"><a href="#sma-135"><span class="linenos">135</span></a>    <span class="c1"># idx = ~np.logical_or( np.isnan(X0), np.isnan(Y0) )</span>
</span><span id="sma-136"><a href="#sma-136"><span class="linenos">136</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="sma-137"><a href="#sma-137"><span class="linenos">137</span></a>
</span><span id="sma-138"><a href="#sma-138"><span class="linenos">138</span></a>    <span class="n">X0</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="sma-139"><a href="#sma-139"><span class="linenos">139</span></a>    <span class="n">Y0</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="sma-140"><a href="#sma-140"><span class="linenos">140</span></a>    <span class="n">W0</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="sma-141"><a href="#sma-141"><span class="linenos">141</span></a>
</span><span id="sma-142"><a href="#sma-142"><span class="linenos">142</span></a>    <span class="c1"># Number of observations</span>
</span><span id="sma-143"><a href="#sma-143"><span class="linenos">143</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X0</span><span class="p">)</span>
</span><span id="sma-144"><a href="#sma-144"><span class="linenos">144</span></a>
</span><span id="sma-145"><a href="#sma-145"><span class="linenos">145</span></a>    <span class="c1"># Degrees of freedom for the model</span>
</span><span id="sma-146"><a href="#sma-146"><span class="linenos">146</span></a>    <span class="k">if</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="sma-147"><a href="#sma-147"><span class="linenos">147</span></a>        <span class="n">dfmod</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="sma-148"><a href="#sma-148"><span class="linenos">148</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="sma-149"><a href="#sma-149"><span class="linenos">149</span></a>        <span class="n">dfmod</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="sma-150"><a href="#sma-150"><span class="linenos">150</span></a>
</span><span id="sma-151"><a href="#sma-151"><span class="linenos">151</span></a>
</span><span id="sma-152"><a href="#sma-152"><span class="linenos">152</span></a>    <span class="c1"># Choose whether to use methods robust to outliers</span>
</span><span id="sma-153"><a href="#sma-153"><span class="linenos">153</span></a>    <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="sma-154"><a href="#sma-154"><span class="linenos">154</span></a>
</span><span id="sma-155"><a href="#sma-155"><span class="linenos">155</span></a>        <span class="c1"># Choose the robust method</span>
</span><span id="sma-156"><a href="#sma-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="p">((</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;mcd&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;fastmcd&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="sma-157"><a href="#sma-157"><span class="linenos">157</span></a>            <span class="c1"># FAST MCD</span>
</span><span id="sma-158"><a href="#sma-158"><span class="linenos">158</span></a>
</span><span id="sma-159"><a href="#sma-159"><span class="linenos">159</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="sma-160"><a href="#sma-160"><span class="linenos">160</span></a>                <span class="c1"># intercept=False could possibly be supported by calculating</span>
</span><span id="sma-161"><a href="#sma-161"><span class="linenos">161</span></a>                <span class="c1"># using mcd.support_ as weights in an explicit variance/covariance calculation</span>
</span><span id="sma-162"><a href="#sma-162"><span class="linenos">162</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;FastMCD method only supports SMA with intercept&#39;</span><span class="p">)</span>
</span><span id="sma-163"><a href="#sma-163"><span class="linenos">163</span></a>
</span><span id="sma-164"><a href="#sma-164"><span class="linenos">164</span></a>            <span class="c1"># Fit robust model of mean and covariance</span>
</span><span id="sma-165"><a href="#sma-165"><span class="linenos">165</span></a>            <span class="n">mcd</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span>
</span><span id="sma-166"><a href="#sma-166"><span class="linenos">166</span></a>
</span><span id="sma-167"><a href="#sma-167"><span class="linenos">167</span></a>            <span class="c1"># Robust mean</span>
</span><span id="sma-168"><a href="#sma-168"><span class="linenos">168</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">location_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="sma-169"><a href="#sma-169"><span class="linenos">169</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">location_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="sma-170"><a href="#sma-170"><span class="linenos">170</span></a>
</span><span id="sma-171"><a href="#sma-171"><span class="linenos">171</span></a>            <span class="c1"># Robust variance of X, Y</span>
</span><span id="sma-172"><a href="#sma-172"><span class="linenos">172</span></a>            <span class="n">Vx</span>    <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">covariance_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="sma-173"><a href="#sma-173"><span class="linenos">173</span></a>            <span class="n">Vy</span>    <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">covariance_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="sma-174"><a href="#sma-174"><span class="linenos">174</span></a>
</span><span id="sma-175"><a href="#sma-175"><span class="linenos">175</span></a>            <span class="c1"># Robust covariance</span>
</span><span id="sma-176"><a href="#sma-176"><span class="linenos">176</span></a>            <span class="n">Vxy</span>   <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">covariance_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="sma-177"><a href="#sma-177"><span class="linenos">177</span></a>
</span><span id="sma-178"><a href="#sma-178"><span class="linenos">178</span></a>            <span class="c1"># Number of observations used in mean and covariance estimate</span>
</span><span id="sma-179"><a href="#sma-179"><span class="linenos">179</span></a>            <span class="c1"># excludes observations marked as outliers</span>
</span><span id="sma-180"><a href="#sma-180"><span class="linenos">180</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">support_</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="sma-181"><a href="#sma-181"><span class="linenos">181</span></a>
</span><span id="sma-182"><a href="#sma-182"><span class="linenos">182</span></a>        <span class="k">elif</span> <span class="p">((</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;biweight&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;huber&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="sma-183"><a href="#sma-183"><span class="linenos">183</span></a>
</span><span id="sma-184"><a href="#sma-184"><span class="linenos">184</span></a>            <span class="c1"># Tukey&#39;s Biweight and Huber&#39;s T</span>
</span><span id="sma-185"><a href="#sma-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">robust_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;biweight&#39;</span><span class="p">:</span>
</span><span id="sma-186"><a href="#sma-186"><span class="linenos">186</span></a>                <span class="n">norm</span> <span class="o">=</span> <span class="n">norms</span><span class="o">.</span><span class="n">TukeyBiweight</span><span class="p">()</span>
</span><span id="sma-187"><a href="#sma-187"><span class="linenos">187</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="sma-188"><a href="#sma-188"><span class="linenos">188</span></a>                <span class="n">norm</span> <span class="o">=</span> <span class="n">norms</span><span class="o">.</span><span class="n">HuberT</span><span class="p">()</span>
</span><span id="sma-189"><a href="#sma-189"><span class="linenos">189</span></a>
</span><span id="sma-190"><a href="#sma-190"><span class="linenos">190</span></a>            <span class="c1"># Get weights for downweighting outliers</span>
</span><span id="sma-191"><a href="#sma-191"><span class="linenos">191</span></a>            <span class="c1"># Fitting a linear model the easiest way to get these</span>
</span><span id="sma-192"><a href="#sma-192"><span class="linenos">192</span></a>            <span class="c1"># Options include &quot;TukeyBiweight&quot; (totally removes large deviates)</span>
</span><span id="sma-193"><a href="#sma-193"><span class="linenos">193</span></a>            <span class="c1"># &quot;HuberT&quot; (linear, not squared weighting of large deviates)</span>
</span><span id="sma-194"><a href="#sma-194"><span class="linenos">194</span></a>            <span class="n">rweights</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">rlm</span><span class="p">(</span><span class="s1">&#39;y~x+1&#39;</span><span class="p">,{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">X0</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">Y0</span><span class="p">},</span><span class="n">M</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">weights</span>
</span><span id="sma-195"><a href="#sma-195"><span class="linenos">195</span></a>
</span><span id="sma-196"><a href="#sma-196"><span class="linenos">196</span></a>            <span class="c1"># Sum of weight and weights squared, for convienience</span>
</span><span id="sma-197"><a href="#sma-197"><span class="linenos">197</span></a>            <span class="n">rsum</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">rweights</span> <span class="p">)</span>
</span><span id="sma-198"><a href="#sma-198"><span class="linenos">198</span></a>            <span class="n">rsum2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</span><span id="sma-199"><a href="#sma-199"><span class="linenos">199</span></a>
</span><span id="sma-200"><a href="#sma-200"><span class="linenos">200</span></a>            <span class="c1"># Mean</span>
</span><span id="sma-201"><a href="#sma-201"><span class="linenos">201</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">X0</span> <span class="o">*</span> <span class="n">rweights</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum</span>
</span><span id="sma-202"><a href="#sma-202"><span class="linenos">202</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">Y0</span> <span class="o">*</span> <span class="n">rweights</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum</span>
</span><span id="sma-203"><a href="#sma-203"><span class="linenos">203</span></a>
</span><span id="sma-204"><a href="#sma-204"><span class="linenos">204</span></a>            <span class="c1"># Force intercept through zero, if requested</span>
</span><span id="sma-205"><a href="#sma-205"><span class="linenos">205</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="sma-206"><a href="#sma-206"><span class="linenos">206</span></a>                <span class="n">Xmean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sma-207"><a href="#sma-207"><span class="linenos">207</span></a>                <span class="n">Ymean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sma-208"><a href="#sma-208"><span class="linenos">208</span></a>
</span><span id="sma-209"><a href="#sma-209"><span class="linenos">209</span></a>            <span class="c1"># Variance &amp; Covariance</span>
</span><span id="sma-210"><a href="#sma-210"><span class="linenos">210</span></a>            <span class="n">Vx</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">X0</span><span class="o">-</span><span class="n">Xmean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum2</span>
</span><span id="sma-211"><a href="#sma-211"><span class="linenos">211</span></a>            <span class="n">Vy</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">Y0</span><span class="o">-</span><span class="n">Ymean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum2</span>
</span><span id="sma-212"><a href="#sma-212"><span class="linenos">212</span></a>            <span class="n">Vxy</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">X0</span><span class="o">-</span><span class="n">Xmean</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y0</span><span class="o">-</span><span class="n">Ymean</span><span class="p">)</span> <span class="o">*</span> <span class="n">rweights</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="n">rsum2</span>
</span><span id="sma-213"><a href="#sma-213"><span class="linenos">213</span></a>
</span><span id="sma-214"><a href="#sma-214"><span class="linenos">214</span></a>            <span class="c1"># Effective number of observations</span>
</span><span id="sma-215"><a href="#sma-215"><span class="linenos">215</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="n">rsum</span>
</span><span id="sma-216"><a href="#sma-216"><span class="linenos">216</span></a>
</span><span id="sma-217"><a href="#sma-217"><span class="linenos">217</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="sma-218"><a href="#sma-218"><span class="linenos">218</span></a>
</span><span id="sma-219"><a href="#sma-219"><span class="linenos">219</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;sma hasn&#39;t implemented robust_method={:</span><span class="si">%s</span><span class="s2">}&quot;</span><span class="o">.</span>\
</span><span id="sma-220"><a href="#sma-220"><span class="linenos">220</span></a>                                      <span class="nb">format</span><span class="p">(</span><span class="n">robust_method</span><span class="p">))</span>
</span><span id="sma-221"><a href="#sma-221"><span class="linenos">221</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="sma-222"><a href="#sma-222"><span class="linenos">222</span></a>
</span><span id="sma-223"><a href="#sma-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="sma-224"><a href="#sma-224"><span class="linenos">224</span></a>
</span><span id="sma-225"><a href="#sma-225"><span class="linenos">225</span></a>            <span class="n">wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="sma-226"><a href="#sma-226"><span class="linenos">226</span></a>
</span><span id="sma-227"><a href="#sma-227"><span class="linenos">227</span></a>            <span class="c1"># Average values</span>
</span><span id="sma-228"><a href="#sma-228"><span class="linenos">228</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X0</span> <span class="o">*</span> <span class="n">W0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="sma-229"><a href="#sma-229"><span class="linenos">229</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Y0</span> <span class="o">*</span> <span class="n">W0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="sma-230"><a href="#sma-230"><span class="linenos">230</span></a>
</span><span id="sma-231"><a href="#sma-231"><span class="linenos">231</span></a>            <span class="c1"># Covariance matrix</span>
</span><span id="sma-232"><a href="#sma-232"><span class="linenos">232</span></a>            <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span> <span class="n">X0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aweights</span><span class="o">=</span><span class="n">W0</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</span><span id="sma-233"><a href="#sma-233"><span class="linenos">233</span></a>
</span><span id="sma-234"><a href="#sma-234"><span class="linenos">234</span></a>            <span class="c1"># Variance</span>
</span><span id="sma-235"><a href="#sma-235"><span class="linenos">235</span></a>            <span class="n">Vx</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="sma-236"><a href="#sma-236"><span class="linenos">236</span></a>            <span class="n">Vy</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="sma-237"><a href="#sma-237"><span class="linenos">237</span></a>
</span><span id="sma-238"><a href="#sma-238"><span class="linenos">238</span></a>            <span class="c1"># Covariance</span>
</span><span id="sma-239"><a href="#sma-239"><span class="linenos">239</span></a>            <span class="n">Vxy</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="sma-240"><a href="#sma-240"><span class="linenos">240</span></a>
</span><span id="sma-241"><a href="#sma-241"><span class="linenos">241</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="sma-242"><a href="#sma-242"><span class="linenos">242</span></a>
</span><span id="sma-243"><a href="#sma-243"><span class="linenos">243</span></a>            <span class="c1"># Force the line to pass through origin by setting means to zero</span>
</span><span id="sma-244"><a href="#sma-244"><span class="linenos">244</span></a>            <span class="n">Xmean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sma-245"><a href="#sma-245"><span class="linenos">245</span></a>            <span class="n">Ymean</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sma-246"><a href="#sma-246"><span class="linenos">246</span></a>
</span><span id="sma-247"><a href="#sma-247"><span class="linenos">247</span></a>            <span class="n">wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W0</span><span class="p">)</span>
</span><span id="sma-248"><a href="#sma-248"><span class="linenos">248</span></a>
</span><span id="sma-249"><a href="#sma-249"><span class="linenos">249</span></a>            <span class="c1"># Sum of squares in place of variance and covariance</span>
</span><span id="sma-250"><a href="#sma-250"><span class="linenos">250</span></a>            <span class="n">Vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">X0</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">W0</span> <span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="sma-251"><a href="#sma-251"><span class="linenos">251</span></a>            <span class="n">Vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">Y0</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">W0</span> <span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="sma-252"><a href="#sma-252"><span class="linenos">252</span></a>            <span class="n">Vxy</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">X0</span><span class="o">*</span><span class="n">Y0</span> <span class="o">*</span> <span class="n">W0</span> <span class="p">)</span> <span class="o">/</span> <span class="n">wsum</span>
</span><span id="sma-253"><a href="#sma-253"><span class="linenos">253</span></a>
</span><span id="sma-254"><a href="#sma-254"><span class="linenos">254</span></a>    <span class="c1"># Standard deviation</span>
</span><span id="sma-255"><a href="#sma-255"><span class="linenos">255</span></a>    <span class="n">Sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Vx</span> <span class="p">)</span>
</span><span id="sma-256"><a href="#sma-256"><span class="linenos">256</span></a>    <span class="n">Sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Vy</span> <span class="p">)</span>
</span><span id="sma-257"><a href="#sma-257"><span class="linenos">257</span></a>
</span><span id="sma-258"><a href="#sma-258"><span class="linenos">258</span></a>    <span class="c1"># Correlation coefficient (equivalent to np.corrcoef()[1,0] for non-robust cases)</span>
</span><span id="sma-259"><a href="#sma-259"><span class="linenos">259</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">Vxy</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Vx</span> <span class="o">*</span> <span class="n">Vy</span> <span class="p">)</span>
</span><span id="sma-260"><a href="#sma-260"><span class="linenos">260</span></a>
</span><span id="sma-261"><a href="#sma-261"><span class="linenos">261</span></a>    <span class="c1">#############</span>
</span><span id="sma-262"><a href="#sma-262"><span class="linenos">262</span></a>    <span class="c1"># SLOPE</span>
</span><span id="sma-263"><a href="#sma-263"><span class="linenos">263</span></a>
</span><span id="sma-264"><a href="#sma-264"><span class="linenos">264</span></a>    <span class="n">Slope</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">Sy</span> <span class="o">/</span> <span class="n">Sx</span>
</span><span id="sma-265"><a href="#sma-265"><span class="linenos">265</span></a>
</span><span id="sma-266"><a href="#sma-266"><span class="linenos">266</span></a>    <span class="c1"># Standard error of slope estimate</span>
</span><span id="sma-267"><a href="#sma-267"><span class="linenos">267</span></a>    <span class="n">ste_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span> <span class="o">*</span> <span class="n">Sy</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">Sx</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
</span><span id="sma-268"><a href="#sma-268"><span class="linenos">268</span></a>
</span><span id="sma-269"><a href="#sma-269"><span class="linenos">269</span></a>    <span class="c1"># Confidence interval for Slope</span>
</span><span id="sma-270"><a href="#sma-270"><span class="linenos">270</span></a>    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span>
</span><span id="sma-271"><a href="#sma-271"><span class="linenos">271</span></a>    <span class="n">ci_grad</span> <span class="o">=</span> <span class="n">Slope</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">B</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
</span><span id="sma-272"><a href="#sma-272"><span class="linenos">272</span></a>
</span><span id="sma-273"><a href="#sma-273"><span class="linenos">273</span></a>    <span class="c1">#############</span>
</span><span id="sma-274"><a href="#sma-274"><span class="linenos">274</span></a>    <span class="c1"># INTERCEPT</span>
</span><span id="sma-275"><a href="#sma-275"><span class="linenos">275</span></a>
</span><span id="sma-276"><a href="#sma-276"><span class="linenos">276</span></a>    <span class="k">if</span> <span class="n">intercept</span><span class="p">:</span>
</span><span id="sma-277"><a href="#sma-277"><span class="linenos">277</span></a>        <span class="n">Intercept</span> <span class="o">=</span> <span class="n">Ymean</span> <span class="o">-</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">Xmean</span>
</span><span id="sma-278"><a href="#sma-278"><span class="linenos">278</span></a>
</span><span id="sma-279"><a href="#sma-279"><span class="linenos">279</span></a>        <span class="c1"># Standard deviation of residuals</span>
</span><span id="sma-280"><a href="#sma-280"><span class="linenos">280</span></a>        <span class="c1"># New Method: Formula from smatr R package (Warton)</span>
</span><span id="sma-281"><a href="#sma-281"><span class="linenos">281</span></a>        <span class="c1"># This formula avoids large residuals of outliers when using robust=True</span>
</span><span id="sma-282"><a href="#sma-282"><span class="linenos">282</span></a>        <span class="n">Sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Vy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">Vxy</span> <span class="o">+</span> <span class="n">Slope</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>  <span class="n">Vx</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span> <span class="p">)</span>
</span><span id="sma-283"><a href="#sma-283"><span class="linenos">283</span></a>
</span><span id="sma-284"><a href="#sma-284"><span class="linenos">284</span></a>        <span class="c1"># OLD METHOD</span>
</span><span id="sma-285"><a href="#sma-285"><span class="linenos">285</span></a>        <span class="c1"># Standard deviation of residuals</span>
</span><span id="sma-286"><a href="#sma-286"><span class="linenos">286</span></a>        <span class="c1">#resid = Y0 - (Intercept + Slope * X0 )    </span>
</span><span id="sma-287"><a href="#sma-287"><span class="linenos">287</span></a>        <span class="c1"># Population standard deviation of the residuals</span>
</span><span id="sma-288"><a href="#sma-288"><span class="linenos">288</span></a>        <span class="c1">#Sr = np.std( resid, ddof=0 )      </span>
</span><span id="sma-289"><a href="#sma-289"><span class="linenos">289</span></a>
</span><span id="sma-290"><a href="#sma-290"><span class="linenos">290</span></a>        <span class="c1"># Standard error of the intercept estimate</span>
</span><span id="sma-291"><a href="#sma-291"><span class="linenos">291</span></a>        <span class="n">ste_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Sr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">N</span> <span class="o">+</span> <span class="n">Xmean</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ste_slope</span><span class="o">**</span><span class="mi">2</span>  <span class="p">)</span>
</span><span id="sma-292"><a href="#sma-292"><span class="linenos">292</span></a>
</span><span id="sma-293"><a href="#sma-293"><span class="linenos">293</span></a>        <span class="c1"># Confidence interval for Intercept</span>
</span><span id="sma-294"><a href="#sma-294"><span class="linenos">294</span></a>        <span class="n">tcrit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">isf</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cl</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">)</span>
</span><span id="sma-295"><a href="#sma-295"><span class="linenos">295</span></a>        <span class="n">ci_int</span> <span class="o">=</span> <span class="n">Intercept</span> <span class="o">+</span> <span class="n">ste_int</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">tcrit</span><span class="p">,</span><span class="n">tcrit</span><span class="p">])</span>
</span><span id="sma-296"><a href="#sma-296"><span class="linenos">296</span></a>
</span><span id="sma-297"><a href="#sma-297"><span class="linenos">297</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="sma-298"><a href="#sma-298"><span class="linenos">298</span></a>
</span><span id="sma-299"><a href="#sma-299"><span class="linenos">299</span></a>        <span class="c1"># Set Intercept quantities to zero</span>
</span><span id="sma-300"><a href="#sma-300"><span class="linenos">300</span></a>        <span class="n">Intercept</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sma-301"><a href="#sma-301"><span class="linenos">301</span></a>        <span class="n">ste_int</span>   <span class="o">=</span> <span class="mi">0</span>
</span><span id="sma-302"><a href="#sma-302"><span class="linenos">302</span></a>        <span class="n">ci_int</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="sma-303"><a href="#sma-303"><span class="linenos">303</span></a>
</span><span id="sma-304"><a href="#sma-304"><span class="linenos">304</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">slope</span>            <span class="o">=</span> <span class="n">Slope</span><span class="p">,</span>
</span><span id="sma-305"><a href="#sma-305"><span class="linenos">305</span></a>                   <span class="n">intercept</span>        <span class="o">=</span> <span class="n">Intercept</span><span class="p">,</span>
</span><span id="sma-306"><a href="#sma-306"><span class="linenos">306</span></a>                   <span class="n">slope_ste</span>        <span class="o">=</span> <span class="n">ste_slope</span><span class="p">,</span>
</span><span id="sma-307"><a href="#sma-307"><span class="linenos">307</span></a>                   <span class="n">intercept_ste</span>    <span class="o">=</span> <span class="n">ste_int</span><span class="p">,</span>
</span><span id="sma-308"><a href="#sma-308"><span class="linenos">308</span></a>                   <span class="n">slope_interval</span>   <span class="o">=</span> <span class="n">ci_grad</span><span class="p">,</span>
</span><span id="sma-309"><a href="#sma-309"><span class="linenos">309</span></a>                   <span class="n">intercept_interval</span> <span class="o">=</span> <span class="n">ci_int</span><span class="p">,</span>
</span><span id="sma-310"><a href="#sma-310"><span class="linenos">310</span></a>                   <span class="n">df_model</span>         <span class="o">=</span> <span class="n">dfmod</span><span class="p">,</span>
</span><span id="sma-311"><a href="#sma-311"><span class="linenos">311</span></a>                   <span class="n">df_resid</span>         <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">,</span>
</span><span id="sma-312"><a href="#sma-312"><span class="linenos">312</span></a>                   <span class="n">params</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Slope</span><span class="p">,</span><span class="n">Intercept</span><span class="p">]),</span>
</span><span id="sma-313"><a href="#sma-313"><span class="linenos">313</span></a>                   <span class="n">nobs</span>             <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
</span><span id="sma-314"><a href="#sma-314"><span class="linenos">314</span></a>                   <span class="n">fittedvalues</span>     <span class="o">=</span> <span class="n">Intercept</span> <span class="o">+</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">X0</span><span class="p">,</span>
</span><span id="sma-315"><a href="#sma-315"><span class="linenos">315</span></a>                   <span class="n">resid</span>            <span class="o">=</span> <span class="n">Intercept</span> <span class="o">+</span> <span class="n">Slope</span> <span class="o">*</span> <span class="n">X0</span> <span class="o">-</span> <span class="n">Y0</span> <span class="p">)</span>
</span><span id="sma-316"><a href="#sma-316"><span class="linenos">316</span></a>
</span><span id="sma-317"><a href="#sma-317"><span class="linenos">317</span></a>    <span class="c1"># return Slope, Intercept, ste_slope, ste_int, ci_grad, ci_int</span>
</span><span id="sma-318"><a href="#sma-318"><span class="linenos">318</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Standard Major-Axis (SMA) line fitting</p>

<p>Calculate standard major axis, aka reduced major axis, fit to 
data X and Y. The main advantage of this over ordinary least squares is 
that the best fit of Y to X will be the same as the best fit of X to Y.</p>

<p>The fit equations and confidence intervals are implemented following 
Warton et al. (2006). Robust fits use the FastMCD covariance estimate 
from Rousseeuw and Van Driessen (1999). While there are many alternative 
robust covariance estimators (e.g. other papers by D.I. Warton using M-estimators), 
the FastMCD algorithm is default in Matlab. When the standard error or 
uncertainty of each point is known, then weighted SMA may be preferrable to 
robust SMA. The conventional choice of weights for each point i is 
W_i = 1 / ( var(X_i) + var(Y_i) ), where var() is the variance 
(squared standard error).</p>

<p>References 
Warton, D. I., Wright, I. J., Falster, D. S. and Westoby, M.: 
    Bivariate line-fitting methods for allometry, Biol. Rev., 81(02), 259, 
    doi:10.1017/S1464793106007007, 2006.
Rousseeuw, P. J. and Van Driessen, K.: A Fast Algorithm for the Minimum 
    Covariance Determinant Estimator, Technometrics, 41(3), 1999.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>X, Y</strong> (array_like or str):
Input values, Must have same length.</li>
<li><strong>W</strong> (array_like or str, optional):
array of weights for each X-Y point, typically W_i = 1/(var(X_i)+var(Y_i))</li>
<li><strong>data</strong> (dict_like, optional):
data structure containing variables. Used when X, Y, or W are str.</li>
<li><strong>cl</strong> (float (default = 0.95)):
Desired confidence level for output.</li>
<li><strong>intercept</strong> (bool, default=True):
Specify if the fitted model should include a non-zero intercept.
The model will be forced through the origin (0,0) if intercept=False.</li>
<li><strong>robust</strong> (bool, default=False):
Use statistical methods that are robust to the presence of outliers</li>
<li><strong>robust_method</strong> ({'FastMCD' (default), 'Huber', 'Biweight'}):
Method for calculating robust variance and covariance. Options:
<ul>
<li>'MCD' or 'FastMCD' for Fast MCD</li>
<li>'Huber' for Huber's T: reduce, not eliminate, influence of outliers</li>
<li>'Biweight' for Tukey's Biweight: reduces then eliminates influence of outliers</li>
</ul></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>fitresult</strong> (dict):
Contains the following keys:
<ul>
<li>slope (float)
Slope or Gradient of Y vs. X</li>
<li>intercept (float)
Y intercept.</li>
<li>slope_ste (float)
Standard error of slope estimate</li>
<li>intercept_ste (float)
standard error of intercept estimate</li>
<li>slope_interval ([float, float])
confidence interval for gradient at confidence level cl</li>
<li>intercept_interval ([float, float])
confidence interval for intercept at confidence level cl</li>
<li>df_model (float)
degrees of freedom for model</li>
<li>df_resid (float)
degrees of freedom for residuals</li>
<li>params ([float,float])
array of fitted parameters</li>
</ul></li>
</ul>
</div>


                </section>
                <section id="smafit">
                            <input id="smafit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">smafit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="smafit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#smafit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="smafit-29"><a href="#smafit-29"><span class="linenos">29</span></a><span class="k">def</span> <span class="nf">smafit</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="smafit-30"><a href="#smafit-30"><span class="linenos">30</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Alias for `sma`&#39;&#39;&#39;</span>
</span><span id="smafit-31"><a href="#smafit-31"><span class="linenos">31</span></a>    <span class="k">return</span> <span class="n">sma</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Alias for <code><a href="#sma">sma</a></code></p>
</div>


                </section>
                <section id="sen">
                            <input id="sen-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sen</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sen-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sen"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sen-452"><a href="#sen-452"><span class="linenos">452</span></a><span class="k">def</span> <span class="nf">sen</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">):</span>
</span><span id="sen-453"><a href="#sen-453"><span class="linenos">453</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Estimate linear trend using the Thiel-Sen method</span>
</span><span id="sen-454"><a href="#sen-454"><span class="linenos">454</span></a><span class="sd">    </span>
</span><span id="sen-455"><a href="#sen-455"><span class="linenos">455</span></a><span class="sd">    This non-parametric method finds the median slope among all</span>
</span><span id="sen-456"><a href="#sen-456"><span class="linenos">456</span></a><span class="sd">    combinations of time points. </span>
</span><span id="sen-457"><a href="#sen-457"><span class="linenos">457</span></a><span class="sd">    scipy.stats.theilslopes provides the same slope estimate, with  </span>
</span><span id="sen-458"><a href="#sen-458"><span class="linenos">458</span></a><span class="sd">    confidence intervals. However, this function is faster for </span>
</span><span id="sen-459"><a href="#sen-459"><span class="linenos">459</span></a><span class="sd">    large datasets due to Numba </span>
</span><span id="sen-460"><a href="#sen-460"><span class="linenos">460</span></a><span class="sd">    </span>
</span><span id="sen-461"><a href="#sen-461"><span class="linenos">461</span></a><span class="sd">    Parameters</span>
</span><span id="sen-462"><a href="#sen-462"><span class="linenos">462</span></a><span class="sd">    ----------</span>
</span><span id="sen-463"><a href="#sen-463"><span class="linenos">463</span></a><span class="sd">    x : array_like (N,)</span>
</span><span id="sen-464"><a href="#sen-464"><span class="linenos">464</span></a><span class="sd">        independent variable</span>
</span><span id="sen-465"><a href="#sen-465"><span class="linenos">465</span></a><span class="sd">    y : array_like (N,)</span>
</span><span id="sen-466"><a href="#sen-466"><span class="linenos">466</span></a><span class="sd">        dependent variable</span>
</span><span id="sen-467"><a href="#sen-467"><span class="linenos">467</span></a><span class="sd">    </span>
</span><span id="sen-468"><a href="#sen-468"><span class="linenos">468</span></a><span class="sd">    Returns</span>
</span><span id="sen-469"><a href="#sen-469"><span class="linenos">469</span></a><span class="sd">    -------</span>
</span><span id="sen-470"><a href="#sen-470"><span class="linenos">470</span></a><span class="sd">    sen : float</span>
</span><span id="sen-471"><a href="#sen-471"><span class="linenos">471</span></a><span class="sd">        the median slope</span>
</span><span id="sen-472"><a href="#sen-472"><span class="linenos">472</span></a><span class="sd">    slopes : array (N*N,)</span>
</span><span id="sen-473"><a href="#sen-473"><span class="linenos">473</span></a><span class="sd">        all slope estimates from all combinations of x and y</span>
</span><span id="sen-474"><a href="#sen-474"><span class="linenos">474</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="sen-475"><a href="#sen-475"><span class="linenos">475</span></a>
</span><span id="sen-476"><a href="#sen-476"><span class="linenos">476</span></a>    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="sen-477"><a href="#sen-477"><span class="linenos">477</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="sen-478"><a href="#sen-478"><span class="linenos">478</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sen function is slow unless numba.jit is used. Use scipy.stats.theilslopes instead.&#39;</span><span class="p">,</span>
</span><span id="sen-479"><a href="#sen-479"><span class="linenos">479</span></a>                    <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="sen-480"><a href="#sen-480"><span class="linenos">480</span></a>        
</span><span id="sen-481"><a href="#sen-481"><span class="linenos">481</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">y</span> <span class="p">):</span>
</span><span id="sen-482"><a href="#sen-482"><span class="linenos">482</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inputs x and y must have same dimension&#39;</span><span class="p">)</span>
</span><span id="sen-483"><a href="#sen-483"><span class="linenos">483</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="sen-484"><a href="#sen-484"><span class="linenos">484</span></a>
</span><span id="sen-485"><a href="#sen-485"><span class="linenos">485</span></a>    <span class="c1"># Find number of time points</span>
</span><span id="sen-486"><a href="#sen-486"><span class="linenos">486</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
</span><span id="sen-487"><a href="#sen-487"><span class="linenos">487</span></a>
</span><span id="sen-488"><a href="#sen-488"><span class="linenos">488</span></a>    <span class="c1"># Array to hold all slope estimates</span>
</span><span id="sen-489"><a href="#sen-489"><span class="linenos">489</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span id="sen-490"><a href="#sen-490"><span class="linenos">490</span></a>    <span class="n">slopes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="sen-491"><a href="#sen-491"><span class="linenos">491</span></a>
</span><span id="sen-492"><a href="#sen-492"><span class="linenos">492</span></a>    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sen-493"><a href="#sen-493"><span class="linenos">493</span></a>
</span><span id="sen-494"><a href="#sen-494"><span class="linenos">494</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="sen-495"><a href="#sen-495"><span class="linenos">495</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="sen-496"><a href="#sen-496"><span class="linenos">496</span></a>
</span><span id="sen-497"><a href="#sen-497"><span class="linenos">497</span></a>            <span class="c1"># Slope between elements i and j</span>
</span><span id="sen-498"><a href="#sen-498"><span class="linenos">498</span></a>            <span class="n">slopeij</span> <span class="o">=</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span><span id="sen-499"><a href="#sen-499"><span class="linenos">499</span></a>
</span><span id="sen-500"><a href="#sen-500"><span class="linenos">500</span></a>            <span class="n">slopes</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">slopeij</span>
</span><span id="sen-501"><a href="#sen-501"><span class="linenos">501</span></a>
</span><span id="sen-502"><a href="#sen-502"><span class="linenos">502</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="sen-503"><a href="#sen-503"><span class="linenos">503</span></a>
</span><span id="sen-504"><a href="#sen-504"><span class="linenos">504</span></a>    <span class="c1"># Thiel-Sen estimate is the median slope, neglecting NaN</span>
</span><span id="sen-505"><a href="#sen-505"><span class="linenos">505</span></a>    <span class="n">sen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span> <span class="n">slopes</span> <span class="p">)</span>
</span><span id="sen-506"><a href="#sen-506"><span class="linenos">506</span></a>
</span><span id="sen-507"><a href="#sen-507"><span class="linenos">507</span></a>    <span class="k">return</span> <span class="n">sen</span><span class="p">,</span> <span class="n">slopes</span>
</span></pre></div>


            <div class="docstring"><p>Estimate linear trend using the Thiel-Sen method</p>

<p>This non-parametric method finds the median slope among all
combinations of time points. 
scipy.stats.theilslopes provides the same slope estimate, with <br />
confidence intervals. However, this function is faster for 
large datasets due to Numba </p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like (N,)):
independent variable</li>
<li><strong>y</strong> (array_like (N,)):
dependent variable</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>sen</strong> (float):
the median slope</li>
<li><strong>slopes</strong> (array (N*N,)):
all slope estimates from all combinations of x and y</li>
</ul>
</div>


                </section>
                <section id="sen_slope">
                            <input id="sen_slope-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sen_slope</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sen_slope-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sen_slope"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sen_slope-26"><a href="#sen_slope-26"><span class="linenos">26</span></a><span class="k">def</span> <span class="nf">sen_slope</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="sen_slope-27"><a href="#sen_slope-27"><span class="linenos">27</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Alias for `sen`&#39;&#39;&#39;</span>
</span><span id="sen_slope-28"><a href="#sen_slope-28"><span class="linenos">28</span></a>    <span class="k">return</span> <span class="n">sen</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Alias for <code><a href="#sen">sen</a></code></p>
</div>


                </section>
                <section id="york">
                            <input id="york-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">york</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">err_x</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">err_y</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">rerr_xy</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="york-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#york"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="york-320"><a href="#york-320"><span class="linenos">320</span></a><span class="k">def</span> <span class="nf">york</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">err_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">err_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rerr_xy</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
</span><span id="york-321"><a href="#york-321"><span class="linenos">321</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;York regression accounting for error in x and y</span>
</span><span id="york-322"><a href="#york-322"><span class="linenos">322</span></a><span class="sd">    Follows the notation and algorithm of York et al. (2004) Section III</span>
</span><span id="york-323"><a href="#york-323"><span class="linenos">323</span></a><span class="sd">    </span>
</span><span id="york-324"><a href="#york-324"><span class="linenos">324</span></a><span class="sd">    Parameters</span>
</span><span id="york-325"><a href="#york-325"><span class="linenos">325</span></a><span class="sd">    ----------</span>
</span><span id="york-326"><a href="#york-326"><span class="linenos">326</span></a><span class="sd">    x, y : ndarray</span>
</span><span id="york-327"><a href="#york-327"><span class="linenos">327</span></a><span class="sd">        dependent (x) and independent (y) variables for fitting</span>
</span><span id="york-328"><a href="#york-328"><span class="linenos">328</span></a><span class="sd">    err_x, err_y : ndarray (default=1)</span>
</span><span id="york-329"><a href="#york-329"><span class="linenos">329</span></a><span class="sd">        standard deviation of errors/uncertainty in x and y</span>
</span><span id="york-330"><a href="#york-330"><span class="linenos">330</span></a><span class="sd">    rerr_xy : float (default=0)</span>
</span><span id="york-331"><a href="#york-331"><span class="linenos">331</span></a><span class="sd">        correlation coefficient for errors in x and y, </span>
</span><span id="york-332"><a href="#york-332"><span class="linenos">332</span></a><span class="sd">        default to rerr_xy=0 meaning that the errors in x are unrelated to errors in y</span>
</span><span id="york-333"><a href="#york-333"><span class="linenos">333</span></a><span class="sd">        err_x, err_y, and rerr_xy can be constants or arrays of the same length as x and y</span>
</span><span id="york-334"><a href="#york-334"><span class="linenos">334</span></a><span class="sd">    </span>
</span><span id="york-335"><a href="#york-335"><span class="linenos">335</span></a><span class="sd">    Returns</span>
</span><span id="york-336"><a href="#york-336"><span class="linenos">336</span></a><span class="sd">    -------</span>
</span><span id="york-337"><a href="#york-337"><span class="linenos">337</span></a><span class="sd">    fitresult : dict </span>
</span><span id="york-338"><a href="#york-338"><span class="linenos">338</span></a><span class="sd">        Contains the following keys:</span>
</span><span id="york-339"><a href="#york-339"><span class="linenos">339</span></a><span class="sd">        - slope (float)</span>
</span><span id="york-340"><a href="#york-340"><span class="linenos">340</span></a><span class="sd">            Slope or Gradient of Y vs. X</span>
</span><span id="york-341"><a href="#york-341"><span class="linenos">341</span></a><span class="sd">        - intercept (float)</span>
</span><span id="york-342"><a href="#york-342"><span class="linenos">342</span></a><span class="sd">            Y intercept.</span>
</span><span id="york-343"><a href="#york-343"><span class="linenos">343</span></a><span class="sd">        - slope_ste (float)</span>
</span><span id="york-344"><a href="#york-344"><span class="linenos">344</span></a><span class="sd">            Standard error of slope estimate</span>
</span><span id="york-345"><a href="#york-345"><span class="linenos">345</span></a><span class="sd">        - intercept_ste (float)</span>
</span><span id="york-346"><a href="#york-346"><span class="linenos">346</span></a><span class="sd">            standard error of intercept estimate</span>
</span><span id="york-347"><a href="#york-347"><span class="linenos">347</span></a><span class="sd">        - slope_interval ([float, float])</span>
</span><span id="york-348"><a href="#york-348"><span class="linenos">348</span></a><span class="sd">            confidence interval for gradient at confidence level cl</span>
</span><span id="york-349"><a href="#york-349"><span class="linenos">349</span></a><span class="sd">        - intercept_interval ([float, float])</span>
</span><span id="york-350"><a href="#york-350"><span class="linenos">350</span></a><span class="sd">            confidence interval for intercept at confidence level cl</span>
</span><span id="york-351"><a href="#york-351"><span class="linenos">351</span></a><span class="sd">        - df_model (float)</span>
</span><span id="york-352"><a href="#york-352"><span class="linenos">352</span></a><span class="sd">            degrees of freedom for model</span>
</span><span id="york-353"><a href="#york-353"><span class="linenos">353</span></a><span class="sd">        - df_resid (float)</span>
</span><span id="york-354"><a href="#york-354"><span class="linenos">354</span></a><span class="sd">            degrees of freedom for residuals</span>
</span><span id="york-355"><a href="#york-355"><span class="linenos">355</span></a><span class="sd">        - params ([float,float])</span>
</span><span id="york-356"><a href="#york-356"><span class="linenos">356</span></a><span class="sd">            array of fitted parameters</span>
</span><span id="york-357"><a href="#york-357"><span class="linenos">357</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="york-358"><a href="#york-358"><span class="linenos">358</span></a>
</span><span id="york-359"><a href="#york-359"><span class="linenos">359</span></a>    <span class="c1"># relative error tolerance required for convergence</span>
</span><span id="york-360"><a href="#york-360"><span class="linenos">360</span></a>    <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-15</span>
</span><span id="york-361"><a href="#york-361"><span class="linenos">361</span></a>
</span><span id="york-362"><a href="#york-362"><span class="linenos">362</span></a>    <span class="c1"># Initial guess for slope, from ordinary least squares</span>
</span><span id="york-363"><a href="#york-363"><span class="linenos">363</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>
</span><span id="york-364"><a href="#york-364"><span class="linenos">364</span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="york-365"><a href="#york-365"><span class="linenos">365</span></a>
</span><span id="york-366"><a href="#york-366"><span class="linenos">366</span></a>    <span class="c1"># Weights for x and y</span>
</span><span id="york-367"><a href="#york-367"><span class="linenos">367</span></a>    <span class="n">wx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">err_x</span><span class="o">**</span><span class="mi">2</span>
</span><span id="york-368"><a href="#york-368"><span class="linenos">368</span></a>    <span class="n">wy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">err_y</span><span class="o">**</span><span class="mi">2</span>
</span><span id="york-369"><a href="#york-369"><span class="linenos">369</span></a>
</span><span id="york-370"><a href="#york-370"><span class="linenos">370</span></a>    <span class="c1"># Combined weights</span>
</span><span id="york-371"><a href="#york-371"><span class="linenos">371</span></a>    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span> <span class="p">)</span>
</span><span id="york-372"><a href="#york-372"><span class="linenos">372</span></a>
</span><span id="york-373"><a href="#york-373"><span class="linenos">373</span></a>    <span class="c1"># Iterate until solution converges, but not more 50 times</span>
</span><span id="york-374"><a href="#york-374"><span class="linenos">374</span></a>    <span class="n">maxiter</span><span class="o">=</span><span class="mi">50</span>
</span><span id="york-375"><a href="#york-375"><span class="linenos">375</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">maxiter</span><span class="p">):</span>
</span><span id="york-376"><a href="#york-376"><span class="linenos">376</span></a>
</span><span id="york-377"><a href="#york-377"><span class="linenos">377</span></a>        <span class="c1"># Weight for point i</span>
</span><span id="york-378"><a href="#york-378"><span class="linenos">378</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">/</span> <span class="p">(</span> <span class="n">wx</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">rerr_xy</span> <span class="o">*</span> <span class="n">alpha</span> <span class="p">)</span>
</span><span id="york-379"><a href="#york-379"><span class="linenos">379</span></a>        <span class="n">Wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="p">)</span>
</span><span id="york-380"><a href="#york-380"><span class="linenos">380</span></a>
</span><span id="york-381"><a href="#york-381"><span class="linenos">381</span></a>        <span class="c1"># Weighted means</span>
</span><span id="york-382"><a href="#york-382"><span class="linenos">382</span></a>        <span class="n">Xbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">x</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="york-383"><a href="#york-383"><span class="linenos">383</span></a>        <span class="n">Ybar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">y</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="york-384"><a href="#york-384"><span class="linenos">384</span></a>
</span><span id="york-385"><a href="#york-385"><span class="linenos">385</span></a>        <span class="c1"># Deviation from weighted means</span>
</span><span id="york-386"><a href="#york-386"><span class="linenos">386</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">Xbar</span>
</span><span id="york-387"><a href="#york-387"><span class="linenos">387</span></a>        <span class="n">V</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">Ybar</span>
</span><span id="york-388"><a href="#york-388"><span class="linenos">388</span></a>
</span><span id="york-389"><a href="#york-389"><span class="linenos">389</span></a>        <span class="c1"># parameter needed for slope</span>
</span><span id="york-390"><a href="#york-390"><span class="linenos">390</span></a>        <span class="n">beta</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="p">(</span> <span class="n">U</span> <span class="o">/</span> <span class="n">wy</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span> <span class="o">/</span> <span class="n">wx</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">U</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">rerr_xy</span> <span class="o">/</span> <span class="n">alpha</span> <span class="p">)</span>
</span><span id="york-391"><a href="#york-391"><span class="linenos">391</span></a>
</span><span id="york-392"><a href="#york-392"><span class="linenos">392</span></a>        <span class="c1"># Update slope estimate</span>
</span><span id="york-393"><a href="#york-393"><span class="linenos">393</span></a>        <span class="n">bnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">V</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">U</span> <span class="p">)</span>
</span><span id="york-394"><a href="#york-394"><span class="linenos">394</span></a>
</span><span id="york-395"><a href="#york-395"><span class="linenos">395</span></a>        <span class="c1"># Break from loop if new value is very close to old value</span>
</span><span id="york-396"><a href="#york-396"><span class="linenos">396</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">bnew</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">b</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">rtol</span><span class="p">:</span>
</span><span id="york-397"><a href="#york-397"><span class="linenos">397</span></a>            <span class="k">break</span>
</span><span id="york-398"><a href="#york-398"><span class="linenos">398</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="york-399"><a href="#york-399"><span class="linenos">399</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">bnew</span>
</span><span id="york-400"><a href="#york-400"><span class="linenos">400</span></a>
</span><span id="york-401"><a href="#york-401"><span class="linenos">401</span></a>    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">maxiter</span><span class="p">:</span>
</span><span id="york-402"><a href="#york-402"><span class="linenos">402</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;York regression failed to converge in </span><span class="si">{</span><span class="n">maxiter</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1"> iterations&#39;</span> <span class="p">)</span>
</span><span id="york-403"><a href="#york-403"><span class="linenos">403</span></a>
</span><span id="york-404"><a href="#york-404"><span class="linenos">404</span></a>    <span class="c1"># Intercept</span>
</span><span id="york-405"><a href="#york-405"><span class="linenos">405</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">Ybar</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">Xbar</span>
</span><span id="york-406"><a href="#york-406"><span class="linenos">406</span></a>
</span><span id="york-407"><a href="#york-407"><span class="linenos">407</span></a>    <span class="c1"># least-squares adjusted points, expectation values of X and Y</span>
</span><span id="york-408"><a href="#york-408"><span class="linenos">408</span></a>    <span class="n">xa</span> <span class="o">=</span> <span class="n">Xbar</span> <span class="o">+</span> <span class="n">beta</span>
</span><span id="york-409"><a href="#york-409"><span class="linenos">409</span></a>    <span class="n">ya</span> <span class="o">=</span> <span class="n">Ybar</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">beta</span>
</span><span id="york-410"><a href="#york-410"><span class="linenos">410</span></a>
</span><span id="york-411"><a href="#york-411"><span class="linenos">411</span></a>    <span class="c1"># Mean of adjusted points</span>
</span><span id="york-412"><a href="#york-412"><span class="linenos">412</span></a>    <span class="n">xabar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">xa</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="york-413"><a href="#york-413"><span class="linenos">413</span></a>    <span class="n">yabar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">ya</span> <span class="p">)</span> <span class="o">/</span> <span class="n">Wsum</span>
</span><span id="york-414"><a href="#york-414"><span class="linenos">414</span></a>
</span><span id="york-415"><a href="#york-415"><span class="linenos">415</span></a>    <span class="c1"># Devaiation of adjusted points from their means</span>
</span><span id="york-416"><a href="#york-416"><span class="linenos">416</span></a>    <span class="n">u</span> <span class="o">=</span> <span class="n">xa</span> <span class="o">-</span> <span class="n">xabar</span>
</span><span id="york-417"><a href="#york-417"><span class="linenos">417</span></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">ya</span> <span class="o">-</span> <span class="n">yabar</span>
</span><span id="york-418"><a href="#york-418"><span class="linenos">418</span></a>
</span><span id="york-419"><a href="#york-419"><span class="linenos">419</span></a>    <span class="c1"># Variance of slope and intercept estimates</span>
</span><span id="york-420"><a href="#york-420"><span class="linenos">420</span></a>    <span class="n">varb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">W</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</span><span id="york-421"><a href="#york-421"><span class="linenos">421</span></a>    <span class="n">vara</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Wsum</span> <span class="o">+</span> <span class="n">xabar</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">varb</span>
</span><span id="york-422"><a href="#york-422"><span class="linenos">422</span></a>
</span><span id="york-423"><a href="#york-423"><span class="linenos">423</span></a>    <span class="c1"># Standard error of slope and intercept</span>
</span><span id="york-424"><a href="#york-424"><span class="linenos">424</span></a>    <span class="n">siga</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">vara</span> <span class="p">)</span>
</span><span id="york-425"><a href="#york-425"><span class="linenos">425</span></a>    <span class="n">sigb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">varb</span> <span class="p">)</span>
</span><span id="york-426"><a href="#york-426"><span class="linenos">426</span></a>
</span><span id="york-427"><a href="#york-427"><span class="linenos">427</span></a>    <span class="c1"># Define a named tuple type that will contain the results</span>
</span><span id="york-428"><a href="#york-428"><span class="linenos">428</span></a>    <span class="c1"># result = namedtuple( &#39;result&#39;, &#39;slope intercept sigs sigi params sigma&#39; )</span>
</span><span id="york-429"><a href="#york-429"><span class="linenos">429</span></a>
</span><span id="york-430"><a href="#york-430"><span class="linenos">430</span></a>    <span class="c1"># Return results as a named tuple, User can access as a regular tuple too</span>
</span><span id="york-431"><a href="#york-431"><span class="linenos">431</span></a>    <span class="c1"># return result( b, a, sigb, siga, [b,a], [sigb, siga] )</span>
</span><span id="york-432"><a href="#york-432"><span class="linenos">432</span></a>
</span><span id="york-433"><a href="#york-433"><span class="linenos">433</span></a>    <span class="n">dfmod</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="york-434"><a href="#york-434"><span class="linenos">434</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">)</span>
</span><span id="york-435"><a href="#york-435"><span class="linenos">435</span></a>
</span><span id="york-436"><a href="#york-436"><span class="linenos">436</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">slope</span>         <span class="o">=</span> <span class="n">b</span><span class="p">,</span>
</span><span id="york-437"><a href="#york-437"><span class="linenos">437</span></a>                <span class="n">intercept</span>        <span class="o">=</span> <span class="n">a</span><span class="p">,</span>
</span><span id="york-438"><a href="#york-438"><span class="linenos">438</span></a>                <span class="n">slope_ste</span>        <span class="o">=</span> <span class="n">sigb</span><span class="p">,</span>
</span><span id="york-439"><a href="#york-439"><span class="linenos">439</span></a>                <span class="n">intercept_ste</span>    <span class="o">=</span> <span class="n">siga</span><span class="p">,</span>
</span><span id="york-440"><a href="#york-440"><span class="linenos">440</span></a>                <span class="n">slope_interval</span>   <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span>
</span><span id="york-441"><a href="#york-441"><span class="linenos">441</span></a>                <span class="n">intercept_interval</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span>
</span><span id="york-442"><a href="#york-442"><span class="linenos">442</span></a>                <span class="n">df_model</span>         <span class="o">=</span> <span class="n">dfmod</span><span class="p">,</span>
</span><span id="york-443"><a href="#york-443"><span class="linenos">443</span></a>                <span class="n">df_resid</span>         <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="n">dfmod</span><span class="p">,</span>
</span><span id="york-444"><a href="#york-444"><span class="linenos">444</span></a>                <span class="n">params</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">]),</span>
</span><span id="york-445"><a href="#york-445"><span class="linenos">445</span></a>                <span class="n">nobs</span>             <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
</span><span id="york-446"><a href="#york-446"><span class="linenos">446</span></a>                <span class="n">fittedvalues</span>     <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span>
</span><span id="york-447"><a href="#york-447"><span class="linenos">447</span></a>                <span class="n">resid</span>            <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="p">)</span>
</span><span id="york-448"><a href="#york-448"><span class="linenos">448</span></a>
</span><span id="york-449"><a href="#york-449"><span class="linenos">449</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>York regression accounting for error in x and y
Follows the notation and algorithm of York et al. (2004) Section III</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x, y</strong> (ndarray):
dependent (x) and independent (y) variables for fitting</li>
<li><strong>err_x, err_y</strong> (ndarray (default=1)):
standard deviation of errors/uncertainty in x and y</li>
<li><strong>rerr_xy</strong> (float (default=0)):
correlation coefficient for errors in x and y, 
default to rerr_xy=0 meaning that the errors in x are unrelated to errors in y
err_x, err_y, and rerr_xy can be constants or arrays of the same length as x and y</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>fitresult</strong> (dict):
Contains the following keys:
<ul>
<li>slope (float)
Slope or Gradient of Y vs. X</li>
<li>intercept (float)
Y intercept.</li>
<li>slope_ste (float)
Standard error of slope estimate</li>
<li>intercept_ste (float)
standard error of intercept estimate</li>
<li>slope_interval ([float, float])
confidence interval for gradient at confidence level cl</li>
<li>intercept_interval ([float, float])
confidence interval for intercept at confidence level cl</li>
<li>df_model (float)
degrees of freedom for model</li>
<li>df_resid (float)
degrees of freedom for residuals</li>
<li>params ([float,float])
array of fitted parameters</li>
</ul></li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>