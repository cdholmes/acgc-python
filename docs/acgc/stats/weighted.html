<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.2.0"/>
    <title>acgc.stats.weighted API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../stats.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;acgc.stats</a>

            <img src="https://acgc.eoas.fsu.edu/wiki/_media/wiki/logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#wcorr">wcorr</a>
            </li>
            <li>
                    <a class="function" href="#wcorrcoef">wcorrcoef</a>
            </li>
            <li>
                    <a class="function" href="#wcov">wcov</a>
            </li>
            <li>
                    <a class="function" href="#wmean">wmean</a>
            </li>
            <li>
                    <a class="function" href="#wmedian">wmedian</a>
            </li>
            <li>
                    <a class="function" href="#wquantile">wquantile</a>
            </li>
            <li>
                    <a class="function" href="#wstd">wstd</a>
            </li>
            <li>
                    <a class="function" href="#wvar">wvar</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../acgc.html">acgc</a><wbr>.<a href="./../stats.html">stats</a><wbr>.weighted    </h1>

                        <div class="docstring"><p>Weighted variance, covariance, correlation, median, and quantiles</p>
</div>

                        <input id="mod-weighted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-weighted-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">&quot;&quot;&quot; Weighted variance, covariance, correlation, median, and quantiles</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">sklearn.covariance</span> <span class="kn">import</span> <span class="n">MinCovDet</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>    <span class="s1">&#39;wcorr&#39;</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="s1">&#39;wcorrcoef&#39;</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>    <span class="s1">&#39;wcov&#39;</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="s1">&#39;wmean&#39;</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>    <span class="s1">&#39;wmedian&#39;</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="s1">&#39;wquantile&#39;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="s1">&#39;wstd&#39;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="s1">&#39;wvar&#39;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="p">]</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="k">def</span> <span class="nf">wmean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted mean </span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    </span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    Calculate the mean of x using weights w.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    </span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    Parameters</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    ----------</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    x : array_like </span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        values to be averaged</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        ignored if w is used</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        </span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    Returns</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    -------</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    float</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        weighted mean of x </span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="n">w</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="k">def</span> <span class="nf">wstd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted standard deviation</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    </span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    Calculate the standard deviation of x using weights w. If ddof=1 (default),</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    then the result is the unbiased (sample) standard deviation when w=1.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    </span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    Parameters</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    ----------</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    x : array_like </span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        values to be analyzed</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    ddof : int, default=1</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        ignored if w is used</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        </span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    Returns</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    -------</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    float</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        weighted standard deviation of x </span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">ddof</span><span class="p">,</span><span class="n">robust</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="k">def</span> <span class="nf">wvar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted variance </span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    </span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    Calculate the variance of x using weights w. If ddof=1 (default),</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    then the result is the unbiased (sample) variance when w=1.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    </span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    Parameters</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    ----------</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    x : array_like </span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        values to be analyzed</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">    ddof : int, default=1</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        ignored if w is used</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        </span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    Returns</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    -------</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    float</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        weighted variance of x </span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="k">return</span> <span class="n">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">ddof</span><span class="p">,</span><span class="n">robust</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="k">def</span> <span class="nf">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted covariance </span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">    </span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">    Calculate the covariance of x and y using weights w. If ddof=1 (default),</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">    then the result is the unbiased (sample) covariance when w=1.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">    </span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">    Implements weighted covariance as defined by NIST Dataplot </span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    https://www.itl.nist.gov/div898/software/dataplot/refman2/ch2/weighvar.pdf</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">    </span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">    Parameters</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">    ----------</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">    x, y : array_like </span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        values to be analyzed</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    ddof : int (default=1)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">    robust : bool, default=False </span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        ignored if w is used</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        </span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">    Returns</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">    -------</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">    float</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        weighted covariance of x and y</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;y must be the same length as x&#39;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">_wscale</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">nw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span> <span class="n">x</span> <span class="o">-</span> <span class="n">wmean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">y</span> <span class="o">-</span> <span class="n">wmean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="n">w</span> <span class="p">)</span> <span class="o">/</span> \
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">nw</span> <span class="o">*</span> <span class="p">(</span><span class="n">nw</span> <span class="o">-</span> <span class="n">ddof</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="k">def</span> <span class="nf">wcorr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted correlation coeffient</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">    </span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">    Calculate the Pearson linear correlation coefficient of x and y using weights w. </span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">    This is derived from the weighted covariance and weighted variance.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">    Equivalent to R2w in Eq. 4 from Willett and Singer (1988).</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">    See notes below on interpretation.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">    </span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">    Parameters</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">    ----------</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">    x, y : array_like </span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        values to be analyzed</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">    ddof : int, default=1</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        ignored if w is used</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        </span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">    Returns</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">    -------</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">    float</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        weighted correlation coefficient of x and y</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">    Notes</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">    -----</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">    The weighted correlation coefficient here may be usedful to construct a </span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">    a &quot;weighted R2&quot; or &quot;weighted coefficient of determination&quot; from a </span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">    Weighted Least Squares regression: R2w = wcorr(x,y,w)**2. The resulting R2w is</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">    equivalent to equation 4 from Willett and Singer (1988, American Statistician) </span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">    and their caveats apply. </span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">    Craig Milligan provides the following advice in an online forum:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">    &quot;What is the meaning of this (corrected) weighted r-squared? </span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">    Willett and Singer interpret it as: &quot;the coefficient of determination in the </span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">    transformed [weighted] dataset. It is a measure of the proportion of the </span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">    variation in weighted Y that can be accounted for by weighted X, and is the </span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">    quantity that is output as R2 by the major statistical computer packages when a </span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">    WLS regression is performed&quot;.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">    Is it meaningful as a measure of goodness of fit? </span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">    This depends on how it is presented and interpreted. Willett and Singer caution </span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">    that it is typically quite a bit higher than the r-squared obtained in ordinary </span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">    least squares regression, and the high value encourages prominent display... </span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">    but this display may be deceptive IF it is interpreted in the conventional </span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">    sense of r-squared (as the proportion of unweighted variation explained by a </span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">    model). Willett and Singer propose that a less &#39;deceptive&#39; alternative is </span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">    their equation 7 [usual unweighted R2, called pseudor2wls by Willett and Singer]. </span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">    In general, Willett and Singer also caution that it is </span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">    not good to rely on any r2 (even their pseudor2wls) as a sole measure of </span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">    goodness of fit. Despite these cautions, the whole premise of robust regression </span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">    is that some cases are judged &#39;not as good&#39; and don&#39;t count as much in the model </span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">    fitting, and it may be good to reflect this in part of the model assessment </span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">    process. The weighted r-squared described, can be one good measure of goodness </span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">    of fit - as long as the correct interpretation is clearly given in the </span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">    presentation and it is not relied on as the sole assessment of goodness of fit.&quot;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">    Willett, J. B. and Singer, J. D.: Another Cautionary Note About R2: </span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        Its Use in Weighted Least-Squares Regression-Analysis, American Statistician, </span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        42(3), 236–238, 1988.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;y must be the same length as x&#39;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">_wscale</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">return</span> <span class="n">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">wvar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">wvar</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="c1"># Alias for wcorr</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="n">wcorrcoef</span> <span class="o">=</span> <span class="n">wcorr</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="k">def</span> <span class="nf">_wscale</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Scale array to a maximum value of 1</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">    Rescale array to a maximum value of 1. </span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">    In weighted averaging, we will assume that a weight of 1 means 1 degree of </span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">    freedom in the observations.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">    </span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">    Parameters</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">    ----------</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">    w : array_like</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        weights </span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        </span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">    Returns</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">    -------</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">    array_like</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        input array rescaled so the largest element is 1</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>    <span class="k">return</span> <span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="k">def</span> <span class="nf">wmedian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted median</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">    See documentation for `wquantile`</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">    Parameters</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">    ----------</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">    x : array_like </span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        values to be analyzed</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">    w : array_like</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        weights for each element of x, representing frequency</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">    **kwargs passed to `wquantile`</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    Returns</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">    -------</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">    float</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        weighted median of x </span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>    <span class="k">return</span> <span class="n">wquantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="k">def</span> <span class="nf">wquantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;partition&#39;</span><span class="p">):</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted quantile </span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">    </span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">    Calculate the quantile q from data array x using data weights w.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">    If weights reflect the relative frequency of the elements of x in a large population,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">    then the weighted quantile result is equivalent to numpy.quantile or numpy.percentile </span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">    operating on an array of that larger population (containing many repeated elements).</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">    For uniform weights and interpolation=partition or partition0, this function </span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">    differs from numpy.percentile. This behavior is expected and desirable.</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">    The numpy.percentile behaviro can be reproduced here by using </span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">    interpolation = linear, lower, higher, or nearest.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    Note that numpy.quantile is equivalent to numpy.percentile(interpolation=&#39;linear&#39;)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">    </span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    This naive algorithm is O(n) and may be slow for large samples (x).</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    Consider using Robustats or another optimized package.       </span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">    </span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">    Parameters</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">    ----------</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">    x : array_like (N,)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        values to be analyzed</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">    q : list (m,)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        quantiles that will be calculated, in range 0-1</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">    w : array_like (N,)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        weights for each element of x. </span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        These represent the frequency of elements x in a large population</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">    interpolation : {&#39;partition&#39; (default),&#39;partition0&#39;,&#39;linear&#39;,&#39;nearest&#39;,&#39;lower&#39;,&#39;higher&#39;}</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        This parameter specifies the interpolation method to use when the desired quantile </span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        lies bewteen elements i &lt; j in x. Allowed values:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        - &#39;partition&#39;: [default] choose the element of x that partitions the </span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">                        sum of weights on either side to q and (1-q)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">                        When two elements both satisfy partition, then average them.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">                        This is the Edgeworth method (https://en.wikipedia.org/wiki/Weighted_median)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        - &#39;partition0&#39;: Same as partition, but result is always an element of x (no averaging). </span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">                        Instead return the element of x that partitions weights most closely </span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">                        to q and (1-q) or, if there is still a tie, then the smaller element.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        - &#39;linear&#39;  : i + (j-1) * fraction. replicates behavior of numpy.quantile when all </span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">                    weights are equal</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        - &#39;nearest&#39; : i or j element that most closely divides data at the q quantile</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        - &#39;lower&#39;   : i, the largest element &lt;= the q quantile</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        - &#39;higher&#39;  : j, the smallest element &gt;= the q quantile</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">                         </span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">    Result</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">    ------</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">    array (m,)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        weighted quantiles of x. Length is the same as input q</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="c1"># Ensure arguments are arrays</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>    <span class="c1"># Number of elements</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>    <span class="c1"># Ensure weights are same length as x</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;weights w must be the same length as array x&#39;</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>    <span class="c1"># Ensure inputs are all finite, no NaN or Inf</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Array x contains non-finite elements&#39;</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Weights w contains non-finite elements&#39;</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="c1"># Sort x from smallest to largest</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;partition&#39;</span><span class="p">,</span><span class="s1">&#39;partition2&#39;</span><span class="p">]:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="c1"># To calculate multiple quantiles, call function iteratively for each quantile requested</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">wquantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">qi</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">interpolation</span><span class="p">)</span> <span class="k">for</span> <span class="n">qi</span> <span class="ow">in</span> <span class="n">q</span><span class="p">]</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="c1"># Cumulative sum of weights, divided by sum</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="n">wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="c1"># Reverse cumulative sum (cumulative sum of elements in reverse order)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="n">wsumr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="c1"># Lower bound for quantile; il is an index into the sorted array</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">wsum</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">il</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>            <span class="n">il</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span> <span class="n">wsum</span> <span class="o">&lt;</span> <span class="n">q</span> <span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="c1"># Upper bound for quantile; iu is an index into the sorted array</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">wsumr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            <span class="n">iu</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>            <span class="n">iu</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span> <span class="n">wsumr</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="n">il</span> <span class="o">==</span> <span class="n">iu</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="c1"># Upper and lower bounds are the same; we&#39;re done</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="n">xq</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">il</span><span class="p">]]</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="c1"># Several methods for reconciling different upper and lower bounds</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>            <span class="k">if</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;partition&#39;</span><span class="p">:</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                <span class="c1"># Average the upper and lower bounds</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                <span class="c1"># This creates an element not found in the input array,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>                <span class="c1"># which may be inappropriate in some cases</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>                <span class="n">xq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[[</span><span class="n">il</span><span class="p">,</span><span class="n">iu</span><span class="p">]]]</span> <span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>                <span class="c1"># Choose the element with the smaller weight</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>                <span class="c1"># This guarantees that the value is an element of the input array</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>                <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">il</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">iu</span><span class="p">]]:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>                    <span class="n">iq</span> <span class="o">=</span> <span class="n">il</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>                    <span class="n">iq</span> <span class="o">=</span> <span class="n">iu</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>                <span class="n">xq</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">iq</span><span class="p">]]</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="c1"># These methods give the same results as numpy.percentile when using</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="c1"># the same interpolation method and uniform weights.</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="c1"># Define the quantile for each element in x</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">w</span>         <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">qx</span>        <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="n">qx</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="n">qx</span>       <span class="o">/=</span> <span class="n">qx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="c1"># Interpolate to get quantile value</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;previous&#39;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;higher&#39;</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;next&#39;</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;midpoint&#39;</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="c1"># Average the lower and higher values</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>                <span class="k">return</span> <span class="p">(</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;previous&#39;</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                         <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;next&#39;</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span>     <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unrecognized value for interpolation: &#39;</span> <span class="o">+</span> <span class="n">interpolation</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="n">xq</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">return</span> <span class="n">xq</span>
</span></pre></div>


            </section>
                <section id="wcorr">
                            <input id="wcorr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wcorr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">w</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">robust</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wcorr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wcorr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wcorr-165"><a href="#wcorr-165"><span class="linenos">165</span></a><span class="k">def</span> <span class="nf">wcorr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="wcorr-166"><a href="#wcorr-166"><span class="linenos">166</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted correlation coeffient</span>
</span><span id="wcorr-167"><a href="#wcorr-167"><span class="linenos">167</span></a><span class="sd">    </span>
</span><span id="wcorr-168"><a href="#wcorr-168"><span class="linenos">168</span></a><span class="sd">    Calculate the Pearson linear correlation coefficient of x and y using weights w. </span>
</span><span id="wcorr-169"><a href="#wcorr-169"><span class="linenos">169</span></a><span class="sd">    This is derived from the weighted covariance and weighted variance.</span>
</span><span id="wcorr-170"><a href="#wcorr-170"><span class="linenos">170</span></a><span class="sd">    Equivalent to R2w in Eq. 4 from Willett and Singer (1988).</span>
</span><span id="wcorr-171"><a href="#wcorr-171"><span class="linenos">171</span></a><span class="sd">    See notes below on interpretation.</span>
</span><span id="wcorr-172"><a href="#wcorr-172"><span class="linenos">172</span></a><span class="sd">    </span>
</span><span id="wcorr-173"><a href="#wcorr-173"><span class="linenos">173</span></a><span class="sd">    Parameters</span>
</span><span id="wcorr-174"><a href="#wcorr-174"><span class="linenos">174</span></a><span class="sd">    ----------</span>
</span><span id="wcorr-175"><a href="#wcorr-175"><span class="linenos">175</span></a><span class="sd">    x, y : array_like </span>
</span><span id="wcorr-176"><a href="#wcorr-176"><span class="linenos">176</span></a><span class="sd">        values to be analyzed</span>
</span><span id="wcorr-177"><a href="#wcorr-177"><span class="linenos">177</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="wcorr-178"><a href="#wcorr-178"><span class="linenos">178</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="wcorr-179"><a href="#wcorr-179"><span class="linenos">179</span></a><span class="sd">    ddof : int, default=1</span>
</span><span id="wcorr-180"><a href="#wcorr-180"><span class="linenos">180</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="wcorr-181"><a href="#wcorr-181"><span class="linenos">181</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="wcorr-182"><a href="#wcorr-182"><span class="linenos">182</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="wcorr-183"><a href="#wcorr-183"><span class="linenos">183</span></a><span class="sd">        ignored if w is used</span>
</span><span id="wcorr-184"><a href="#wcorr-184"><span class="linenos">184</span></a><span class="sd">        </span>
</span><span id="wcorr-185"><a href="#wcorr-185"><span class="linenos">185</span></a><span class="sd">    Returns</span>
</span><span id="wcorr-186"><a href="#wcorr-186"><span class="linenos">186</span></a><span class="sd">    -------</span>
</span><span id="wcorr-187"><a href="#wcorr-187"><span class="linenos">187</span></a><span class="sd">    float</span>
</span><span id="wcorr-188"><a href="#wcorr-188"><span class="linenos">188</span></a><span class="sd">        weighted correlation coefficient of x and y</span>
</span><span id="wcorr-189"><a href="#wcorr-189"><span class="linenos">189</span></a>
</span><span id="wcorr-190"><a href="#wcorr-190"><span class="linenos">190</span></a><span class="sd">    Notes</span>
</span><span id="wcorr-191"><a href="#wcorr-191"><span class="linenos">191</span></a><span class="sd">    -----</span>
</span><span id="wcorr-192"><a href="#wcorr-192"><span class="linenos">192</span></a><span class="sd">    The weighted correlation coefficient here may be usedful to construct a </span>
</span><span id="wcorr-193"><a href="#wcorr-193"><span class="linenos">193</span></a><span class="sd">    a &quot;weighted R2&quot; or &quot;weighted coefficient of determination&quot; from a </span>
</span><span id="wcorr-194"><a href="#wcorr-194"><span class="linenos">194</span></a><span class="sd">    Weighted Least Squares regression: R2w = wcorr(x,y,w)**2. The resulting R2w is</span>
</span><span id="wcorr-195"><a href="#wcorr-195"><span class="linenos">195</span></a><span class="sd">    equivalent to equation 4 from Willett and Singer (1988, American Statistician) </span>
</span><span id="wcorr-196"><a href="#wcorr-196"><span class="linenos">196</span></a><span class="sd">    and their caveats apply. </span>
</span><span id="wcorr-197"><a href="#wcorr-197"><span class="linenos">197</span></a>
</span><span id="wcorr-198"><a href="#wcorr-198"><span class="linenos">198</span></a><span class="sd">    Craig Milligan provides the following advice in an online forum:</span>
</span><span id="wcorr-199"><a href="#wcorr-199"><span class="linenos">199</span></a><span class="sd">    &quot;What is the meaning of this (corrected) weighted r-squared? </span>
</span><span id="wcorr-200"><a href="#wcorr-200"><span class="linenos">200</span></a><span class="sd">    Willett and Singer interpret it as: &quot;the coefficient of determination in the </span>
</span><span id="wcorr-201"><a href="#wcorr-201"><span class="linenos">201</span></a><span class="sd">    transformed [weighted] dataset. It is a measure of the proportion of the </span>
</span><span id="wcorr-202"><a href="#wcorr-202"><span class="linenos">202</span></a><span class="sd">    variation in weighted Y that can be accounted for by weighted X, and is the </span>
</span><span id="wcorr-203"><a href="#wcorr-203"><span class="linenos">203</span></a><span class="sd">    quantity that is output as R2 by the major statistical computer packages when a </span>
</span><span id="wcorr-204"><a href="#wcorr-204"><span class="linenos">204</span></a><span class="sd">    WLS regression is performed&quot;.</span>
</span><span id="wcorr-205"><a href="#wcorr-205"><span class="linenos">205</span></a>
</span><span id="wcorr-206"><a href="#wcorr-206"><span class="linenos">206</span></a><span class="sd">    Is it meaningful as a measure of goodness of fit? </span>
</span><span id="wcorr-207"><a href="#wcorr-207"><span class="linenos">207</span></a><span class="sd">    This depends on how it is presented and interpreted. Willett and Singer caution </span>
</span><span id="wcorr-208"><a href="#wcorr-208"><span class="linenos">208</span></a><span class="sd">    that it is typically quite a bit higher than the r-squared obtained in ordinary </span>
</span><span id="wcorr-209"><a href="#wcorr-209"><span class="linenos">209</span></a><span class="sd">    least squares regression, and the high value encourages prominent display... </span>
</span><span id="wcorr-210"><a href="#wcorr-210"><span class="linenos">210</span></a><span class="sd">    but this display may be deceptive IF it is interpreted in the conventional </span>
</span><span id="wcorr-211"><a href="#wcorr-211"><span class="linenos">211</span></a><span class="sd">    sense of r-squared (as the proportion of unweighted variation explained by a </span>
</span><span id="wcorr-212"><a href="#wcorr-212"><span class="linenos">212</span></a><span class="sd">    model). Willett and Singer propose that a less &#39;deceptive&#39; alternative is </span>
</span><span id="wcorr-213"><a href="#wcorr-213"><span class="linenos">213</span></a><span class="sd">    their equation 7 [usual unweighted R2, called pseudor2wls by Willett and Singer]. </span>
</span><span id="wcorr-214"><a href="#wcorr-214"><span class="linenos">214</span></a><span class="sd">    In general, Willett and Singer also caution that it is </span>
</span><span id="wcorr-215"><a href="#wcorr-215"><span class="linenos">215</span></a><span class="sd">    not good to rely on any r2 (even their pseudor2wls) as a sole measure of </span>
</span><span id="wcorr-216"><a href="#wcorr-216"><span class="linenos">216</span></a><span class="sd">    goodness of fit. Despite these cautions, the whole premise of robust regression </span>
</span><span id="wcorr-217"><a href="#wcorr-217"><span class="linenos">217</span></a><span class="sd">    is that some cases are judged &#39;not as good&#39; and don&#39;t count as much in the model </span>
</span><span id="wcorr-218"><a href="#wcorr-218"><span class="linenos">218</span></a><span class="sd">    fitting, and it may be good to reflect this in part of the model assessment </span>
</span><span id="wcorr-219"><a href="#wcorr-219"><span class="linenos">219</span></a><span class="sd">    process. The weighted r-squared described, can be one good measure of goodness </span>
</span><span id="wcorr-220"><a href="#wcorr-220"><span class="linenos">220</span></a><span class="sd">    of fit - as long as the correct interpretation is clearly given in the </span>
</span><span id="wcorr-221"><a href="#wcorr-221"><span class="linenos">221</span></a><span class="sd">    presentation and it is not relied on as the sole assessment of goodness of fit.&quot;</span>
</span><span id="wcorr-222"><a href="#wcorr-222"><span class="linenos">222</span></a>
</span><span id="wcorr-223"><a href="#wcorr-223"><span class="linenos">223</span></a><span class="sd">    Willett, J. B. and Singer, J. D.: Another Cautionary Note About R2: </span>
</span><span id="wcorr-224"><a href="#wcorr-224"><span class="linenos">224</span></a><span class="sd">        Its Use in Weighted Least-Squares Regression-Analysis, American Statistician, </span>
</span><span id="wcorr-225"><a href="#wcorr-225"><span class="linenos">225</span></a><span class="sd">        42(3), 236–238, 1988.</span>
</span><span id="wcorr-226"><a href="#wcorr-226"><span class="linenos">226</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wcorr-227"><a href="#wcorr-227"><span class="linenos">227</span></a>
</span><span id="wcorr-228"><a href="#wcorr-228"><span class="linenos">228</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;y must be the same length as x&#39;</span>
</span><span id="wcorr-229"><a href="#wcorr-229"><span class="linenos">229</span></a>
</span><span id="wcorr-230"><a href="#wcorr-230"><span class="linenos">230</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wcorr-231"><a href="#wcorr-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="wcorr-232"><a href="#wcorr-232"><span class="linenos">232</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="wcorr-233"><a href="#wcorr-233"><span class="linenos">233</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="wcorr-234"><a href="#wcorr-234"><span class="linenos">234</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wcorr-235"><a href="#wcorr-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="wcorr-236"><a href="#wcorr-236"><span class="linenos">236</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wcorr-237"><a href="#wcorr-237"><span class="linenos">237</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="wcorr-238"><a href="#wcorr-238"><span class="linenos">238</span></a>
</span><span id="wcorr-239"><a href="#wcorr-239"><span class="linenos">239</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">_wscale</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="wcorr-240"><a href="#wcorr-240"><span class="linenos">240</span></a>    <span class="k">return</span> <span class="n">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">wvar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">wvar</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Weighted correlation coeffient</p>

<p>Calculate the Pearson linear correlation coefficient of x and y using weights w. 
This is derived from the weighted covariance and weighted variance.
Equivalent to R2w in Eq. 4 from Willett and Singer (1988).
See notes below on interpretation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x, y</strong> (array_like):
values to be analyzed</li>
<li><strong>w</strong> (array_like, default=None):
weights for each element of x; can be ommitted if robust=True</li>
<li><strong>ddof</strong> (int, default=1):
differential degrees of freedom. See note above.</li>
<li><strong>robust</strong> (bool, default=False):
if robust=True, weights will be internally calculated using FastMCD;
ignored if w is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: weighted correlation coefficient of x and y</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The weighted correlation coefficient here may be usedful to construct a 
a "weighted R2" or "weighted coefficient of determination" from a 
Weighted Least Squares regression: R2w = wcorr(x,y,w)**2. The resulting R2w is
equivalent to equation 4 from Willett and Singer (1988, American Statistician) 
and their caveats apply. </p>

<p>Craig Milligan provides the following advice in an online forum:
"What is the meaning of this (corrected) weighted r-squared? 
Willett and Singer interpret it as: "the coefficient of determination in the 
transformed [weighted] dataset. It is a measure of the proportion of the 
variation in weighted Y that can be accounted for by weighted X, and is the 
quantity that is output as R2 by the major statistical computer packages when a 
WLS regression is performed".</p>

<p>Is it meaningful as a measure of goodness of fit? 
This depends on how it is presented and interpreted. Willett and Singer caution 
that it is typically quite a bit higher than the r-squared obtained in ordinary 
least squares regression, and the high value encourages prominent display... 
but this display may be deceptive IF it is interpreted in the conventional 
sense of r-squared (as the proportion of unweighted variation explained by a 
model). Willett and Singer propose that a less 'deceptive' alternative is 
their equation 7 [usual unweighted R2, called pseudor2wls by Willett and Singer]. 
In general, Willett and Singer also caution that it is 
not good to rely on any r2 (even their pseudor2wls) as a sole measure of 
goodness of fit. Despite these cautions, the whole premise of robust regression 
is that some cases are judged 'not as good' and don't count as much in the model 
fitting, and it may be good to reflect this in part of the model assessment 
process. The weighted r-squared described, can be one good measure of goodness 
of fit - as long as the correct interpretation is clearly given in the 
presentation and it is not relied on as the sole assessment of goodness of fit."</p>

<p>Willett, J. B. and Singer, J. D.: Another Cautionary Note About R2: 
    Its Use in Weighted Least-Squares Regression-Analysis, American Statistician, 
    42(3), 236–238, 1988.</p>
</div>


                </section>
                <section id="wcorrcoef">
                            <input id="wcorrcoef-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wcorrcoef</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">w</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">robust</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wcorrcoef-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wcorrcoef"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wcorrcoef-165"><a href="#wcorrcoef-165"><span class="linenos">165</span></a><span class="k">def</span> <span class="nf">wcorr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="wcorrcoef-166"><a href="#wcorrcoef-166"><span class="linenos">166</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted correlation coeffient</span>
</span><span id="wcorrcoef-167"><a href="#wcorrcoef-167"><span class="linenos">167</span></a><span class="sd">    </span>
</span><span id="wcorrcoef-168"><a href="#wcorrcoef-168"><span class="linenos">168</span></a><span class="sd">    Calculate the Pearson linear correlation coefficient of x and y using weights w. </span>
</span><span id="wcorrcoef-169"><a href="#wcorrcoef-169"><span class="linenos">169</span></a><span class="sd">    This is derived from the weighted covariance and weighted variance.</span>
</span><span id="wcorrcoef-170"><a href="#wcorrcoef-170"><span class="linenos">170</span></a><span class="sd">    Equivalent to R2w in Eq. 4 from Willett and Singer (1988).</span>
</span><span id="wcorrcoef-171"><a href="#wcorrcoef-171"><span class="linenos">171</span></a><span class="sd">    See notes below on interpretation.</span>
</span><span id="wcorrcoef-172"><a href="#wcorrcoef-172"><span class="linenos">172</span></a><span class="sd">    </span>
</span><span id="wcorrcoef-173"><a href="#wcorrcoef-173"><span class="linenos">173</span></a><span class="sd">    Parameters</span>
</span><span id="wcorrcoef-174"><a href="#wcorrcoef-174"><span class="linenos">174</span></a><span class="sd">    ----------</span>
</span><span id="wcorrcoef-175"><a href="#wcorrcoef-175"><span class="linenos">175</span></a><span class="sd">    x, y : array_like </span>
</span><span id="wcorrcoef-176"><a href="#wcorrcoef-176"><span class="linenos">176</span></a><span class="sd">        values to be analyzed</span>
</span><span id="wcorrcoef-177"><a href="#wcorrcoef-177"><span class="linenos">177</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="wcorrcoef-178"><a href="#wcorrcoef-178"><span class="linenos">178</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="wcorrcoef-179"><a href="#wcorrcoef-179"><span class="linenos">179</span></a><span class="sd">    ddof : int, default=1</span>
</span><span id="wcorrcoef-180"><a href="#wcorrcoef-180"><span class="linenos">180</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="wcorrcoef-181"><a href="#wcorrcoef-181"><span class="linenos">181</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="wcorrcoef-182"><a href="#wcorrcoef-182"><span class="linenos">182</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="wcorrcoef-183"><a href="#wcorrcoef-183"><span class="linenos">183</span></a><span class="sd">        ignored if w is used</span>
</span><span id="wcorrcoef-184"><a href="#wcorrcoef-184"><span class="linenos">184</span></a><span class="sd">        </span>
</span><span id="wcorrcoef-185"><a href="#wcorrcoef-185"><span class="linenos">185</span></a><span class="sd">    Returns</span>
</span><span id="wcorrcoef-186"><a href="#wcorrcoef-186"><span class="linenos">186</span></a><span class="sd">    -------</span>
</span><span id="wcorrcoef-187"><a href="#wcorrcoef-187"><span class="linenos">187</span></a><span class="sd">    float</span>
</span><span id="wcorrcoef-188"><a href="#wcorrcoef-188"><span class="linenos">188</span></a><span class="sd">        weighted correlation coefficient of x and y</span>
</span><span id="wcorrcoef-189"><a href="#wcorrcoef-189"><span class="linenos">189</span></a>
</span><span id="wcorrcoef-190"><a href="#wcorrcoef-190"><span class="linenos">190</span></a><span class="sd">    Notes</span>
</span><span id="wcorrcoef-191"><a href="#wcorrcoef-191"><span class="linenos">191</span></a><span class="sd">    -----</span>
</span><span id="wcorrcoef-192"><a href="#wcorrcoef-192"><span class="linenos">192</span></a><span class="sd">    The weighted correlation coefficient here may be usedful to construct a </span>
</span><span id="wcorrcoef-193"><a href="#wcorrcoef-193"><span class="linenos">193</span></a><span class="sd">    a &quot;weighted R2&quot; or &quot;weighted coefficient of determination&quot; from a </span>
</span><span id="wcorrcoef-194"><a href="#wcorrcoef-194"><span class="linenos">194</span></a><span class="sd">    Weighted Least Squares regression: R2w = wcorr(x,y,w)**2. The resulting R2w is</span>
</span><span id="wcorrcoef-195"><a href="#wcorrcoef-195"><span class="linenos">195</span></a><span class="sd">    equivalent to equation 4 from Willett and Singer (1988, American Statistician) </span>
</span><span id="wcorrcoef-196"><a href="#wcorrcoef-196"><span class="linenos">196</span></a><span class="sd">    and their caveats apply. </span>
</span><span id="wcorrcoef-197"><a href="#wcorrcoef-197"><span class="linenos">197</span></a>
</span><span id="wcorrcoef-198"><a href="#wcorrcoef-198"><span class="linenos">198</span></a><span class="sd">    Craig Milligan provides the following advice in an online forum:</span>
</span><span id="wcorrcoef-199"><a href="#wcorrcoef-199"><span class="linenos">199</span></a><span class="sd">    &quot;What is the meaning of this (corrected) weighted r-squared? </span>
</span><span id="wcorrcoef-200"><a href="#wcorrcoef-200"><span class="linenos">200</span></a><span class="sd">    Willett and Singer interpret it as: &quot;the coefficient of determination in the </span>
</span><span id="wcorrcoef-201"><a href="#wcorrcoef-201"><span class="linenos">201</span></a><span class="sd">    transformed [weighted] dataset. It is a measure of the proportion of the </span>
</span><span id="wcorrcoef-202"><a href="#wcorrcoef-202"><span class="linenos">202</span></a><span class="sd">    variation in weighted Y that can be accounted for by weighted X, and is the </span>
</span><span id="wcorrcoef-203"><a href="#wcorrcoef-203"><span class="linenos">203</span></a><span class="sd">    quantity that is output as R2 by the major statistical computer packages when a </span>
</span><span id="wcorrcoef-204"><a href="#wcorrcoef-204"><span class="linenos">204</span></a><span class="sd">    WLS regression is performed&quot;.</span>
</span><span id="wcorrcoef-205"><a href="#wcorrcoef-205"><span class="linenos">205</span></a>
</span><span id="wcorrcoef-206"><a href="#wcorrcoef-206"><span class="linenos">206</span></a><span class="sd">    Is it meaningful as a measure of goodness of fit? </span>
</span><span id="wcorrcoef-207"><a href="#wcorrcoef-207"><span class="linenos">207</span></a><span class="sd">    This depends on how it is presented and interpreted. Willett and Singer caution </span>
</span><span id="wcorrcoef-208"><a href="#wcorrcoef-208"><span class="linenos">208</span></a><span class="sd">    that it is typically quite a bit higher than the r-squared obtained in ordinary </span>
</span><span id="wcorrcoef-209"><a href="#wcorrcoef-209"><span class="linenos">209</span></a><span class="sd">    least squares regression, and the high value encourages prominent display... </span>
</span><span id="wcorrcoef-210"><a href="#wcorrcoef-210"><span class="linenos">210</span></a><span class="sd">    but this display may be deceptive IF it is interpreted in the conventional </span>
</span><span id="wcorrcoef-211"><a href="#wcorrcoef-211"><span class="linenos">211</span></a><span class="sd">    sense of r-squared (as the proportion of unweighted variation explained by a </span>
</span><span id="wcorrcoef-212"><a href="#wcorrcoef-212"><span class="linenos">212</span></a><span class="sd">    model). Willett and Singer propose that a less &#39;deceptive&#39; alternative is </span>
</span><span id="wcorrcoef-213"><a href="#wcorrcoef-213"><span class="linenos">213</span></a><span class="sd">    their equation 7 [usual unweighted R2, called pseudor2wls by Willett and Singer]. </span>
</span><span id="wcorrcoef-214"><a href="#wcorrcoef-214"><span class="linenos">214</span></a><span class="sd">    In general, Willett and Singer also caution that it is </span>
</span><span id="wcorrcoef-215"><a href="#wcorrcoef-215"><span class="linenos">215</span></a><span class="sd">    not good to rely on any r2 (even their pseudor2wls) as a sole measure of </span>
</span><span id="wcorrcoef-216"><a href="#wcorrcoef-216"><span class="linenos">216</span></a><span class="sd">    goodness of fit. Despite these cautions, the whole premise of robust regression </span>
</span><span id="wcorrcoef-217"><a href="#wcorrcoef-217"><span class="linenos">217</span></a><span class="sd">    is that some cases are judged &#39;not as good&#39; and don&#39;t count as much in the model </span>
</span><span id="wcorrcoef-218"><a href="#wcorrcoef-218"><span class="linenos">218</span></a><span class="sd">    fitting, and it may be good to reflect this in part of the model assessment </span>
</span><span id="wcorrcoef-219"><a href="#wcorrcoef-219"><span class="linenos">219</span></a><span class="sd">    process. The weighted r-squared described, can be one good measure of goodness </span>
</span><span id="wcorrcoef-220"><a href="#wcorrcoef-220"><span class="linenos">220</span></a><span class="sd">    of fit - as long as the correct interpretation is clearly given in the </span>
</span><span id="wcorrcoef-221"><a href="#wcorrcoef-221"><span class="linenos">221</span></a><span class="sd">    presentation and it is not relied on as the sole assessment of goodness of fit.&quot;</span>
</span><span id="wcorrcoef-222"><a href="#wcorrcoef-222"><span class="linenos">222</span></a>
</span><span id="wcorrcoef-223"><a href="#wcorrcoef-223"><span class="linenos">223</span></a><span class="sd">    Willett, J. B. and Singer, J. D.: Another Cautionary Note About R2: </span>
</span><span id="wcorrcoef-224"><a href="#wcorrcoef-224"><span class="linenos">224</span></a><span class="sd">        Its Use in Weighted Least-Squares Regression-Analysis, American Statistician, </span>
</span><span id="wcorrcoef-225"><a href="#wcorrcoef-225"><span class="linenos">225</span></a><span class="sd">        42(3), 236–238, 1988.</span>
</span><span id="wcorrcoef-226"><a href="#wcorrcoef-226"><span class="linenos">226</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wcorrcoef-227"><a href="#wcorrcoef-227"><span class="linenos">227</span></a>
</span><span id="wcorrcoef-228"><a href="#wcorrcoef-228"><span class="linenos">228</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;y must be the same length as x&#39;</span>
</span><span id="wcorrcoef-229"><a href="#wcorrcoef-229"><span class="linenos">229</span></a>
</span><span id="wcorrcoef-230"><a href="#wcorrcoef-230"><span class="linenos">230</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wcorrcoef-231"><a href="#wcorrcoef-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="wcorrcoef-232"><a href="#wcorrcoef-232"><span class="linenos">232</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="wcorrcoef-233"><a href="#wcorrcoef-233"><span class="linenos">233</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="wcorrcoef-234"><a href="#wcorrcoef-234"><span class="linenos">234</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wcorrcoef-235"><a href="#wcorrcoef-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="wcorrcoef-236"><a href="#wcorrcoef-236"><span class="linenos">236</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wcorrcoef-237"><a href="#wcorrcoef-237"><span class="linenos">237</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="wcorrcoef-238"><a href="#wcorrcoef-238"><span class="linenos">238</span></a>
</span><span id="wcorrcoef-239"><a href="#wcorrcoef-239"><span class="linenos">239</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">_wscale</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="wcorrcoef-240"><a href="#wcorrcoef-240"><span class="linenos">240</span></a>    <span class="k">return</span> <span class="n">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">wvar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">wvar</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Weighted correlation coeffient</p>

<p>Calculate the Pearson linear correlation coefficient of x and y using weights w. 
This is derived from the weighted covariance and weighted variance.
Equivalent to R2w in Eq. 4 from Willett and Singer (1988).
See notes below on interpretation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x, y</strong> (array_like):
values to be analyzed</li>
<li><strong>w</strong> (array_like, default=None):
weights for each element of x; can be ommitted if robust=True</li>
<li><strong>ddof</strong> (int, default=1):
differential degrees of freedom. See note above.</li>
<li><strong>robust</strong> (bool, default=False):
if robust=True, weights will be internally calculated using FastMCD;
ignored if w is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: weighted correlation coefficient of x and y</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The weighted correlation coefficient here may be usedful to construct a 
a "weighted R2" or "weighted coefficient of determination" from a 
Weighted Least Squares regression: R2w = wcorr(x,y,w)**2. The resulting R2w is
equivalent to equation 4 from Willett and Singer (1988, American Statistician) 
and their caveats apply. </p>

<p>Craig Milligan provides the following advice in an online forum:
"What is the meaning of this (corrected) weighted r-squared? 
Willett and Singer interpret it as: "the coefficient of determination in the 
transformed [weighted] dataset. It is a measure of the proportion of the 
variation in weighted Y that can be accounted for by weighted X, and is the 
quantity that is output as R2 by the major statistical computer packages when a 
WLS regression is performed".</p>

<p>Is it meaningful as a measure of goodness of fit? 
This depends on how it is presented and interpreted. Willett and Singer caution 
that it is typically quite a bit higher than the r-squared obtained in ordinary 
least squares regression, and the high value encourages prominent display... 
but this display may be deceptive IF it is interpreted in the conventional 
sense of r-squared (as the proportion of unweighted variation explained by a 
model). Willett and Singer propose that a less 'deceptive' alternative is 
their equation 7 [usual unweighted R2, called pseudor2wls by Willett and Singer]. 
In general, Willett and Singer also caution that it is 
not good to rely on any r2 (even their pseudor2wls) as a sole measure of 
goodness of fit. Despite these cautions, the whole premise of robust regression 
is that some cases are judged 'not as good' and don't count as much in the model 
fitting, and it may be good to reflect this in part of the model assessment 
process. The weighted r-squared described, can be one good measure of goodness 
of fit - as long as the correct interpretation is clearly given in the 
presentation and it is not relied on as the sole assessment of goodness of fit."</p>

<p>Willett, J. B. and Singer, J. D.: Another Cautionary Note About R2: 
    Its Use in Weighted Least-Squares Regression-Analysis, American Statistician, 
    42(3), 236–238, 1988.</p>
</div>


                </section>
                <section id="wcov">
                            <input id="wcov-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wcov</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">w</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">robust</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wcov-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wcov"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wcov-121"><a href="#wcov-121"><span class="linenos">121</span></a><span class="k">def</span> <span class="nf">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="wcov-122"><a href="#wcov-122"><span class="linenos">122</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted covariance </span>
</span><span id="wcov-123"><a href="#wcov-123"><span class="linenos">123</span></a><span class="sd">    </span>
</span><span id="wcov-124"><a href="#wcov-124"><span class="linenos">124</span></a><span class="sd">    Calculate the covariance of x and y using weights w. If ddof=1 (default),</span>
</span><span id="wcov-125"><a href="#wcov-125"><span class="linenos">125</span></a><span class="sd">    then the result is the unbiased (sample) covariance when w=1.</span>
</span><span id="wcov-126"><a href="#wcov-126"><span class="linenos">126</span></a><span class="sd">    </span>
</span><span id="wcov-127"><a href="#wcov-127"><span class="linenos">127</span></a><span class="sd">    Implements weighted covariance as defined by NIST Dataplot </span>
</span><span id="wcov-128"><a href="#wcov-128"><span class="linenos">128</span></a><span class="sd">    https://www.itl.nist.gov/div898/software/dataplot/refman2/ch2/weighvar.pdf</span>
</span><span id="wcov-129"><a href="#wcov-129"><span class="linenos">129</span></a><span class="sd">    </span>
</span><span id="wcov-130"><a href="#wcov-130"><span class="linenos">130</span></a><span class="sd">    Parameters</span>
</span><span id="wcov-131"><a href="#wcov-131"><span class="linenos">131</span></a><span class="sd">    ----------</span>
</span><span id="wcov-132"><a href="#wcov-132"><span class="linenos">132</span></a><span class="sd">    x, y : array_like </span>
</span><span id="wcov-133"><a href="#wcov-133"><span class="linenos">133</span></a><span class="sd">        values to be analyzed</span>
</span><span id="wcov-134"><a href="#wcov-134"><span class="linenos">134</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="wcov-135"><a href="#wcov-135"><span class="linenos">135</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="wcov-136"><a href="#wcov-136"><span class="linenos">136</span></a><span class="sd">    ddof : int (default=1)</span>
</span><span id="wcov-137"><a href="#wcov-137"><span class="linenos">137</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="wcov-138"><a href="#wcov-138"><span class="linenos">138</span></a><span class="sd">    robust : bool, default=False </span>
</span><span id="wcov-139"><a href="#wcov-139"><span class="linenos">139</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="wcov-140"><a href="#wcov-140"><span class="linenos">140</span></a><span class="sd">        ignored if w is used</span>
</span><span id="wcov-141"><a href="#wcov-141"><span class="linenos">141</span></a><span class="sd">        </span>
</span><span id="wcov-142"><a href="#wcov-142"><span class="linenos">142</span></a><span class="sd">    Returns</span>
</span><span id="wcov-143"><a href="#wcov-143"><span class="linenos">143</span></a><span class="sd">    -------</span>
</span><span id="wcov-144"><a href="#wcov-144"><span class="linenos">144</span></a><span class="sd">    float</span>
</span><span id="wcov-145"><a href="#wcov-145"><span class="linenos">145</span></a><span class="sd">        weighted covariance of x and y</span>
</span><span id="wcov-146"><a href="#wcov-146"><span class="linenos">146</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wcov-147"><a href="#wcov-147"><span class="linenos">147</span></a>
</span><span id="wcov-148"><a href="#wcov-148"><span class="linenos">148</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;y must be the same length as x&#39;</span>
</span><span id="wcov-149"><a href="#wcov-149"><span class="linenos">149</span></a>
</span><span id="wcov-150"><a href="#wcov-150"><span class="linenos">150</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wcov-151"><a href="#wcov-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="wcov-152"><a href="#wcov-152"><span class="linenos">152</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="wcov-153"><a href="#wcov-153"><span class="linenos">153</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="wcov-154"><a href="#wcov-154"><span class="linenos">154</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wcov-155"><a href="#wcov-155"><span class="linenos">155</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="wcov-156"><a href="#wcov-156"><span class="linenos">156</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wcov-157"><a href="#wcov-157"><span class="linenos">157</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="wcov-158"><a href="#wcov-158"><span class="linenos">158</span></a>
</span><span id="wcov-159"><a href="#wcov-159"><span class="linenos">159</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">_wscale</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="wcov-160"><a href="#wcov-160"><span class="linenos">160</span></a>    <span class="n">nw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="wcov-161"><a href="#wcov-161"><span class="linenos">161</span></a>
</span><span id="wcov-162"><a href="#wcov-162"><span class="linenos">162</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span> <span class="n">x</span> <span class="o">-</span> <span class="n">wmean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">y</span> <span class="o">-</span> <span class="n">wmean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="n">w</span> <span class="p">)</span> <span class="o">/</span> \
</span><span id="wcov-163"><a href="#wcov-163"><span class="linenos">163</span></a>        <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">nw</span> <span class="o">*</span> <span class="p">(</span><span class="n">nw</span> <span class="o">-</span> <span class="n">ddof</span><span class="p">)</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Weighted covariance </p>

<p>Calculate the covariance of x and y using weights w. If ddof=1 (default),
then the result is the unbiased (sample) covariance when w=1.</p>

<p>Implements weighted covariance as defined by NIST Dataplot 
<a href="https://www.itl.nist.gov/div898/software/dataplot/refman2/ch2/weighvar.pdf">https://www.itl.nist.gov/div898/software/dataplot/refman2/ch2/weighvar.pdf</a></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x, y</strong> (array_like):
values to be analyzed</li>
<li><strong>w</strong> (array_like, default=None):
weights for each element of x; can be ommitted if robust=True</li>
<li><strong>ddof</strong> (int (default=1)):
differential degrees of freedom. See note above.</li>
<li><strong>robust</strong> (bool, default=False):
if robust=True, weights will be internally calculated using FastMCD;
ignored if w is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: weighted covariance of x and y</li>
</ul>
</div>


                </section>
                <section id="wmean">
                            <input id="wmean-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wmean</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">w</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">robust</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wmean-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wmean"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wmean-22"><a href="#wmean-22"><span class="linenos">22</span></a><span class="k">def</span> <span class="nf">wmean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="wmean-23"><a href="#wmean-23"><span class="linenos">23</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted mean </span>
</span><span id="wmean-24"><a href="#wmean-24"><span class="linenos">24</span></a><span class="sd">    </span>
</span><span id="wmean-25"><a href="#wmean-25"><span class="linenos">25</span></a><span class="sd">    Calculate the mean of x using weights w.</span>
</span><span id="wmean-26"><a href="#wmean-26"><span class="linenos">26</span></a><span class="sd">    </span>
</span><span id="wmean-27"><a href="#wmean-27"><span class="linenos">27</span></a><span class="sd">    Parameters</span>
</span><span id="wmean-28"><a href="#wmean-28"><span class="linenos">28</span></a><span class="sd">    ----------</span>
</span><span id="wmean-29"><a href="#wmean-29"><span class="linenos">29</span></a><span class="sd">    x : array_like </span>
</span><span id="wmean-30"><a href="#wmean-30"><span class="linenos">30</span></a><span class="sd">        values to be averaged</span>
</span><span id="wmean-31"><a href="#wmean-31"><span class="linenos">31</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="wmean-32"><a href="#wmean-32"><span class="linenos">32</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="wmean-33"><a href="#wmean-33"><span class="linenos">33</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="wmean-34"><a href="#wmean-34"><span class="linenos">34</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="wmean-35"><a href="#wmean-35"><span class="linenos">35</span></a><span class="sd">        ignored if w is used</span>
</span><span id="wmean-36"><a href="#wmean-36"><span class="linenos">36</span></a><span class="sd">        </span>
</span><span id="wmean-37"><a href="#wmean-37"><span class="linenos">37</span></a><span class="sd">    Returns</span>
</span><span id="wmean-38"><a href="#wmean-38"><span class="linenos">38</span></a><span class="sd">    -------</span>
</span><span id="wmean-39"><a href="#wmean-39"><span class="linenos">39</span></a><span class="sd">    float</span>
</span><span id="wmean-40"><a href="#wmean-40"><span class="linenos">40</span></a><span class="sd">        weighted mean of x </span>
</span><span id="wmean-41"><a href="#wmean-41"><span class="linenos">41</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wmean-42"><a href="#wmean-42"><span class="linenos">42</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wmean-43"><a href="#wmean-43"><span class="linenos">43</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="wmean-44"><a href="#wmean-44"><span class="linenos">44</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="wmean-45"><a href="#wmean-45"><span class="linenos">45</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="wmean-46"><a href="#wmean-46"><span class="linenos">46</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wmean-47"><a href="#wmean-47"><span class="linenos">47</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="wmean-48"><a href="#wmean-48"><span class="linenos">48</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wmean-49"><a href="#wmean-49"><span class="linenos">49</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="wmean-50"><a href="#wmean-50"><span class="linenos">50</span></a>
</span><span id="wmean-51"><a href="#wmean-51"><span class="linenos">51</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="n">w</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Weighted mean </p>

<p>Calculate the mean of x using weights w.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like):
values to be averaged</li>
<li><strong>w</strong> (array_like, default=None):
weights for each element of x; can be ommitted if robust=True</li>
<li><strong>robust</strong> (bool, default=False):
if robust=True, weights will be internally calculated using FastMCD;
ignored if w is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: weighted mean of x</li>
</ul>
</div>


                </section>
                <section id="wmedian">
                            <input id="wmedian-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wmedian</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">w</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wmedian-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wmedian"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wmedian-264"><a href="#wmedian-264"><span class="linenos">264</span></a><span class="k">def</span> <span class="nf">wmedian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="wmedian-265"><a href="#wmedian-265"><span class="linenos">265</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted median</span>
</span><span id="wmedian-266"><a href="#wmedian-266"><span class="linenos">266</span></a>
</span><span id="wmedian-267"><a href="#wmedian-267"><span class="linenos">267</span></a><span class="sd">    See documentation for `wquantile`</span>
</span><span id="wmedian-268"><a href="#wmedian-268"><span class="linenos">268</span></a>
</span><span id="wmedian-269"><a href="#wmedian-269"><span class="linenos">269</span></a><span class="sd">    Parameters</span>
</span><span id="wmedian-270"><a href="#wmedian-270"><span class="linenos">270</span></a><span class="sd">    ----------</span>
</span><span id="wmedian-271"><a href="#wmedian-271"><span class="linenos">271</span></a><span class="sd">    x : array_like </span>
</span><span id="wmedian-272"><a href="#wmedian-272"><span class="linenos">272</span></a><span class="sd">        values to be analyzed</span>
</span><span id="wmedian-273"><a href="#wmedian-273"><span class="linenos">273</span></a><span class="sd">    w : array_like</span>
</span><span id="wmedian-274"><a href="#wmedian-274"><span class="linenos">274</span></a><span class="sd">        weights for each element of x, representing frequency</span>
</span><span id="wmedian-275"><a href="#wmedian-275"><span class="linenos">275</span></a><span class="sd">    **kwargs passed to `wquantile`</span>
</span><span id="wmedian-276"><a href="#wmedian-276"><span class="linenos">276</span></a>
</span><span id="wmedian-277"><a href="#wmedian-277"><span class="linenos">277</span></a><span class="sd">    Returns</span>
</span><span id="wmedian-278"><a href="#wmedian-278"><span class="linenos">278</span></a><span class="sd">    -------</span>
</span><span id="wmedian-279"><a href="#wmedian-279"><span class="linenos">279</span></a><span class="sd">    float</span>
</span><span id="wmedian-280"><a href="#wmedian-280"><span class="linenos">280</span></a><span class="sd">        weighted median of x </span>
</span><span id="wmedian-281"><a href="#wmedian-281"><span class="linenos">281</span></a>
</span><span id="wmedian-282"><a href="#wmedian-282"><span class="linenos">282</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wmedian-283"><a href="#wmedian-283"><span class="linenos">283</span></a>    <span class="k">return</span> <span class="n">wquantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Weighted median</p>

<p>See documentation for <code><a href="#wquantile">wquantile</a></code></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like):
values to be analyzed</li>
<li><strong>w</strong> (array_like):
weights for each element of x, representing frequency</li>
<li><strong>**kwargs passed to <code><a href="#wquantile">wquantile</a></code></strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: weighted median of x</li>
</ul>
</div>


                </section>
                <section id="wquantile">
                            <input id="wquantile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wquantile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">q</span>, </span><span class="param"><span class="n">w</span>, </span><span class="param"><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;partition&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wquantile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wquantile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wquantile-285"><a href="#wquantile-285"><span class="linenos">285</span></a><span class="k">def</span> <span class="nf">wquantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;partition&#39;</span><span class="p">):</span>
</span><span id="wquantile-286"><a href="#wquantile-286"><span class="linenos">286</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted quantile </span>
</span><span id="wquantile-287"><a href="#wquantile-287"><span class="linenos">287</span></a><span class="sd">    </span>
</span><span id="wquantile-288"><a href="#wquantile-288"><span class="linenos">288</span></a><span class="sd">    Calculate the quantile q from data array x using data weights w.</span>
</span><span id="wquantile-289"><a href="#wquantile-289"><span class="linenos">289</span></a><span class="sd">    If weights reflect the relative frequency of the elements of x in a large population,</span>
</span><span id="wquantile-290"><a href="#wquantile-290"><span class="linenos">290</span></a><span class="sd">    then the weighted quantile result is equivalent to numpy.quantile or numpy.percentile </span>
</span><span id="wquantile-291"><a href="#wquantile-291"><span class="linenos">291</span></a><span class="sd">    operating on an array of that larger population (containing many repeated elements).</span>
</span><span id="wquantile-292"><a href="#wquantile-292"><span class="linenos">292</span></a>
</span><span id="wquantile-293"><a href="#wquantile-293"><span class="linenos">293</span></a><span class="sd">    For uniform weights and interpolation=partition or partition0, this function </span>
</span><span id="wquantile-294"><a href="#wquantile-294"><span class="linenos">294</span></a><span class="sd">    differs from numpy.percentile. This behavior is expected and desirable.</span>
</span><span id="wquantile-295"><a href="#wquantile-295"><span class="linenos">295</span></a><span class="sd">    The numpy.percentile behaviro can be reproduced here by using </span>
</span><span id="wquantile-296"><a href="#wquantile-296"><span class="linenos">296</span></a><span class="sd">    interpolation = linear, lower, higher, or nearest.</span>
</span><span id="wquantile-297"><a href="#wquantile-297"><span class="linenos">297</span></a><span class="sd">    Note that numpy.quantile is equivalent to numpy.percentile(interpolation=&#39;linear&#39;)</span>
</span><span id="wquantile-298"><a href="#wquantile-298"><span class="linenos">298</span></a><span class="sd">    </span>
</span><span id="wquantile-299"><a href="#wquantile-299"><span class="linenos">299</span></a><span class="sd">    This naive algorithm is O(n) and may be slow for large samples (x).</span>
</span><span id="wquantile-300"><a href="#wquantile-300"><span class="linenos">300</span></a><span class="sd">    Consider using Robustats or another optimized package.       </span>
</span><span id="wquantile-301"><a href="#wquantile-301"><span class="linenos">301</span></a><span class="sd">    </span>
</span><span id="wquantile-302"><a href="#wquantile-302"><span class="linenos">302</span></a><span class="sd">    Parameters</span>
</span><span id="wquantile-303"><a href="#wquantile-303"><span class="linenos">303</span></a><span class="sd">    ----------</span>
</span><span id="wquantile-304"><a href="#wquantile-304"><span class="linenos">304</span></a><span class="sd">    x : array_like (N,)</span>
</span><span id="wquantile-305"><a href="#wquantile-305"><span class="linenos">305</span></a><span class="sd">        values to be analyzed</span>
</span><span id="wquantile-306"><a href="#wquantile-306"><span class="linenos">306</span></a><span class="sd">    q : list (m,)</span>
</span><span id="wquantile-307"><a href="#wquantile-307"><span class="linenos">307</span></a><span class="sd">        quantiles that will be calculated, in range 0-1</span>
</span><span id="wquantile-308"><a href="#wquantile-308"><span class="linenos">308</span></a><span class="sd">    w : array_like (N,)</span>
</span><span id="wquantile-309"><a href="#wquantile-309"><span class="linenos">309</span></a><span class="sd">        weights for each element of x. </span>
</span><span id="wquantile-310"><a href="#wquantile-310"><span class="linenos">310</span></a><span class="sd">        These represent the frequency of elements x in a large population</span>
</span><span id="wquantile-311"><a href="#wquantile-311"><span class="linenos">311</span></a><span class="sd">    interpolation : {&#39;partition&#39; (default),&#39;partition0&#39;,&#39;linear&#39;,&#39;nearest&#39;,&#39;lower&#39;,&#39;higher&#39;}</span>
</span><span id="wquantile-312"><a href="#wquantile-312"><span class="linenos">312</span></a><span class="sd">        This parameter specifies the interpolation method to use when the desired quantile </span>
</span><span id="wquantile-313"><a href="#wquantile-313"><span class="linenos">313</span></a><span class="sd">        lies bewteen elements i &lt; j in x. Allowed values:</span>
</span><span id="wquantile-314"><a href="#wquantile-314"><span class="linenos">314</span></a><span class="sd">        - &#39;partition&#39;: [default] choose the element of x that partitions the </span>
</span><span id="wquantile-315"><a href="#wquantile-315"><span class="linenos">315</span></a><span class="sd">                        sum of weights on either side to q and (1-q)</span>
</span><span id="wquantile-316"><a href="#wquantile-316"><span class="linenos">316</span></a><span class="sd">                        When two elements both satisfy partition, then average them.</span>
</span><span id="wquantile-317"><a href="#wquantile-317"><span class="linenos">317</span></a><span class="sd">                        This is the Edgeworth method (https://en.wikipedia.org/wiki/Weighted_median)</span>
</span><span id="wquantile-318"><a href="#wquantile-318"><span class="linenos">318</span></a><span class="sd">        - &#39;partition0&#39;: Same as partition, but result is always an element of x (no averaging). </span>
</span><span id="wquantile-319"><a href="#wquantile-319"><span class="linenos">319</span></a><span class="sd">                        Instead return the element of x that partitions weights most closely </span>
</span><span id="wquantile-320"><a href="#wquantile-320"><span class="linenos">320</span></a><span class="sd">                        to q and (1-q) or, if there is still a tie, then the smaller element.</span>
</span><span id="wquantile-321"><a href="#wquantile-321"><span class="linenos">321</span></a><span class="sd">        - &#39;linear&#39;  : i + (j-1) * fraction. replicates behavior of numpy.quantile when all </span>
</span><span id="wquantile-322"><a href="#wquantile-322"><span class="linenos">322</span></a><span class="sd">                    weights are equal</span>
</span><span id="wquantile-323"><a href="#wquantile-323"><span class="linenos">323</span></a><span class="sd">        - &#39;nearest&#39; : i or j element that most closely divides data at the q quantile</span>
</span><span id="wquantile-324"><a href="#wquantile-324"><span class="linenos">324</span></a><span class="sd">        - &#39;lower&#39;   : i, the largest element &lt;= the q quantile</span>
</span><span id="wquantile-325"><a href="#wquantile-325"><span class="linenos">325</span></a><span class="sd">        - &#39;higher&#39;  : j, the smallest element &gt;= the q quantile</span>
</span><span id="wquantile-326"><a href="#wquantile-326"><span class="linenos">326</span></a><span class="sd">                         </span>
</span><span id="wquantile-327"><a href="#wquantile-327"><span class="linenos">327</span></a><span class="sd">    Result</span>
</span><span id="wquantile-328"><a href="#wquantile-328"><span class="linenos">328</span></a><span class="sd">    ------</span>
</span><span id="wquantile-329"><a href="#wquantile-329"><span class="linenos">329</span></a><span class="sd">    array (m,)</span>
</span><span id="wquantile-330"><a href="#wquantile-330"><span class="linenos">330</span></a><span class="sd">        weighted quantiles of x. Length is the same as input q</span>
</span><span id="wquantile-331"><a href="#wquantile-331"><span class="linenos">331</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wquantile-332"><a href="#wquantile-332"><span class="linenos">332</span></a>
</span><span id="wquantile-333"><a href="#wquantile-333"><span class="linenos">333</span></a>    <span class="c1"># Ensure arguments are arrays</span>
</span><span id="wquantile-334"><a href="#wquantile-334"><span class="linenos">334</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
</span><span id="wquantile-335"><a href="#wquantile-335"><span class="linenos">335</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
</span><span id="wquantile-336"><a href="#wquantile-336"><span class="linenos">336</span></a>
</span><span id="wquantile-337"><a href="#wquantile-337"><span class="linenos">337</span></a>    <span class="c1"># Number of elements</span>
</span><span id="wquantile-338"><a href="#wquantile-338"><span class="linenos">338</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="wquantile-339"><a href="#wquantile-339"><span class="linenos">339</span></a>
</span><span id="wquantile-340"><a href="#wquantile-340"><span class="linenos">340</span></a>    <span class="c1"># Ensure weights are same length as x</span>
</span><span id="wquantile-341"><a href="#wquantile-341"><span class="linenos">341</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
</span><span id="wquantile-342"><a href="#wquantile-342"><span class="linenos">342</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;weights w must be the same length as array x&#39;</span><span class="p">)</span>
</span><span id="wquantile-343"><a href="#wquantile-343"><span class="linenos">343</span></a>
</span><span id="wquantile-344"><a href="#wquantile-344"><span class="linenos">344</span></a>    <span class="c1"># Ensure inputs are all finite, no NaN or Inf</span>
</span><span id="wquantile-345"><a href="#wquantile-345"><span class="linenos">345</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">):</span>
</span><span id="wquantile-346"><a href="#wquantile-346"><span class="linenos">346</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Array x contains non-finite elements&#39;</span><span class="p">)</span>
</span><span id="wquantile-347"><a href="#wquantile-347"><span class="linenos">347</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="p">):</span>
</span><span id="wquantile-348"><a href="#wquantile-348"><span class="linenos">348</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Weights w contains non-finite elements&#39;</span><span class="p">)</span>
</span><span id="wquantile-349"><a href="#wquantile-349"><span class="linenos">349</span></a>
</span><span id="wquantile-350"><a href="#wquantile-350"><span class="linenos">350</span></a>    <span class="c1"># Sort x from smallest to largest</span>
</span><span id="wquantile-351"><a href="#wquantile-351"><span class="linenos">351</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
</span><span id="wquantile-352"><a href="#wquantile-352"><span class="linenos">352</span></a>
</span><span id="wquantile-353"><a href="#wquantile-353"><span class="linenos">353</span></a>    <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;partition&#39;</span><span class="p">,</span><span class="s1">&#39;partition2&#39;</span><span class="p">]:</span>
</span><span id="wquantile-354"><a href="#wquantile-354"><span class="linenos">354</span></a>
</span><span id="wquantile-355"><a href="#wquantile-355"><span class="linenos">355</span></a>        <span class="c1"># To calculate multiple quantiles, call function iteratively for each quantile requested</span>
</span><span id="wquantile-356"><a href="#wquantile-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
</span><span id="wquantile-357"><a href="#wquantile-357"><span class="linenos">357</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">wquantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">qi</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">interpolation</span><span class="p">)</span> <span class="k">for</span> <span class="n">qi</span> <span class="ow">in</span> <span class="n">q</span><span class="p">]</span>
</span><span id="wquantile-358"><a href="#wquantile-358"><span class="linenos">358</span></a>
</span><span id="wquantile-359"><a href="#wquantile-359"><span class="linenos">359</span></a>        <span class="c1"># Cumulative sum of weights, divided by sum</span>
</span><span id="wquantile-360"><a href="#wquantile-360"><span class="linenos">360</span></a>        <span class="n">wsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
</span><span id="wquantile-361"><a href="#wquantile-361"><span class="linenos">361</span></a>        <span class="c1"># Reverse cumulative sum (cumulative sum of elements in reverse order)</span>
</span><span id="wquantile-362"><a href="#wquantile-362"><span class="linenos">362</span></a>        <span class="n">wsumr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
</span><span id="wquantile-363"><a href="#wquantile-363"><span class="linenos">363</span></a>
</span><span id="wquantile-364"><a href="#wquantile-364"><span class="linenos">364</span></a>        <span class="c1"># Lower bound for quantile; il is an index into the sorted array</span>
</span><span id="wquantile-365"><a href="#wquantile-365"><span class="linenos">365</span></a>        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">wsum</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="wquantile-366"><a href="#wquantile-366"><span class="linenos">366</span></a>            <span class="n">il</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="wquantile-367"><a href="#wquantile-367"><span class="linenos">367</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wquantile-368"><a href="#wquantile-368"><span class="linenos">368</span></a>            <span class="n">il</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span> <span class="n">wsum</span> <span class="o">&lt;</span> <span class="n">q</span> <span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="wquantile-369"><a href="#wquantile-369"><span class="linenos">369</span></a>
</span><span id="wquantile-370"><a href="#wquantile-370"><span class="linenos">370</span></a>        <span class="c1"># Upper bound for quantile; iu is an index into the sorted array</span>
</span><span id="wquantile-371"><a href="#wquantile-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">wsumr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="wquantile-372"><a href="#wquantile-372"><span class="linenos">372</span></a>            <span class="n">iu</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
</span><span id="wquantile-373"><a href="#wquantile-373"><span class="linenos">373</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wquantile-374"><a href="#wquantile-374"><span class="linenos">374</span></a>            <span class="n">iu</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span> <span class="n">wsumr</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="wquantile-375"><a href="#wquantile-375"><span class="linenos">375</span></a>
</span><span id="wquantile-376"><a href="#wquantile-376"><span class="linenos">376</span></a>        <span class="k">if</span> <span class="n">il</span> <span class="o">==</span> <span class="n">iu</span><span class="p">:</span>
</span><span id="wquantile-377"><a href="#wquantile-377"><span class="linenos">377</span></a>            <span class="c1"># Upper and lower bounds are the same; we&#39;re done</span>
</span><span id="wquantile-378"><a href="#wquantile-378"><span class="linenos">378</span></a>            <span class="n">xq</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">il</span><span class="p">]]</span>
</span><span id="wquantile-379"><a href="#wquantile-379"><span class="linenos">379</span></a>
</span><span id="wquantile-380"><a href="#wquantile-380"><span class="linenos">380</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wquantile-381"><a href="#wquantile-381"><span class="linenos">381</span></a>            <span class="c1"># Several methods for reconciling different upper and lower bounds</span>
</span><span id="wquantile-382"><a href="#wquantile-382"><span class="linenos">382</span></a>
</span><span id="wquantile-383"><a href="#wquantile-383"><span class="linenos">383</span></a>            <span class="k">if</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;partition&#39;</span><span class="p">:</span>
</span><span id="wquantile-384"><a href="#wquantile-384"><span class="linenos">384</span></a>                <span class="c1"># Average the upper and lower bounds</span>
</span><span id="wquantile-385"><a href="#wquantile-385"><span class="linenos">385</span></a>                <span class="c1"># This creates an element not found in the input array,</span>
</span><span id="wquantile-386"><a href="#wquantile-386"><span class="linenos">386</span></a>                <span class="c1"># which may be inappropriate in some cases</span>
</span><span id="wquantile-387"><a href="#wquantile-387"><span class="linenos">387</span></a>                <span class="n">xq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[[</span><span class="n">il</span><span class="p">,</span><span class="n">iu</span><span class="p">]]]</span> <span class="p">)</span>
</span><span id="wquantile-388"><a href="#wquantile-388"><span class="linenos">388</span></a>
</span><span id="wquantile-389"><a href="#wquantile-389"><span class="linenos">389</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="wquantile-390"><a href="#wquantile-390"><span class="linenos">390</span></a>                <span class="c1"># Choose the element with the smaller weight</span>
</span><span id="wquantile-391"><a href="#wquantile-391"><span class="linenos">391</span></a>                <span class="c1"># This guarantees that the value is an element of the input array</span>
</span><span id="wquantile-392"><a href="#wquantile-392"><span class="linenos">392</span></a>                <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">il</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">iu</span><span class="p">]]:</span>
</span><span id="wquantile-393"><a href="#wquantile-393"><span class="linenos">393</span></a>                    <span class="n">iq</span> <span class="o">=</span> <span class="n">il</span>
</span><span id="wquantile-394"><a href="#wquantile-394"><span class="linenos">394</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="wquantile-395"><a href="#wquantile-395"><span class="linenos">395</span></a>                    <span class="n">iq</span> <span class="o">=</span> <span class="n">iu</span>
</span><span id="wquantile-396"><a href="#wquantile-396"><span class="linenos">396</span></a>                <span class="n">xq</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">iq</span><span class="p">]]</span>
</span><span id="wquantile-397"><a href="#wquantile-397"><span class="linenos">397</span></a>
</span><span id="wquantile-398"><a href="#wquantile-398"><span class="linenos">398</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wquantile-399"><a href="#wquantile-399"><span class="linenos">399</span></a>
</span><span id="wquantile-400"><a href="#wquantile-400"><span class="linenos">400</span></a>        <span class="c1"># These methods give the same results as numpy.percentile when using</span>
</span><span id="wquantile-401"><a href="#wquantile-401"><span class="linenos">401</span></a>        <span class="c1"># the same interpolation method and uniform weights.</span>
</span><span id="wquantile-402"><a href="#wquantile-402"><span class="linenos">402</span></a>
</span><span id="wquantile-403"><a href="#wquantile-403"><span class="linenos">403</span></a>        <span class="c1"># Define the quantile for each element in x</span>
</span><span id="wquantile-404"><a href="#wquantile-404"><span class="linenos">404</span></a>        <span class="n">w</span>         <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="wquantile-405"><a href="#wquantile-405"><span class="linenos">405</span></a>        <span class="n">qx</span>        <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="wquantile-406"><a href="#wquantile-406"><span class="linenos">406</span></a>        <span class="n">qx</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="wquantile-407"><a href="#wquantile-407"><span class="linenos">407</span></a>        <span class="n">qx</span>       <span class="o">/=</span> <span class="n">qx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="wquantile-408"><a href="#wquantile-408"><span class="linenos">408</span></a>
</span><span id="wquantile-409"><a href="#wquantile-409"><span class="linenos">409</span></a>        <span class="c1"># Interpolate to get quantile value</span>
</span><span id="wquantile-410"><a href="#wquantile-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="wquantile-411"><a href="#wquantile-411"><span class="linenos">411</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
</span><span id="wquantile-412"><a href="#wquantile-412"><span class="linenos">412</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="wquantile-413"><a href="#wquantile-413"><span class="linenos">413</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
</span><span id="wquantile-414"><a href="#wquantile-414"><span class="linenos">414</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
</span><span id="wquantile-415"><a href="#wquantile-415"><span class="linenos">415</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;previous&#39;</span><span class="p">)</span>
</span><span id="wquantile-416"><a href="#wquantile-416"><span class="linenos">416</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;higher&#39;</span><span class="p">:</span>
</span><span id="wquantile-417"><a href="#wquantile-417"><span class="linenos">417</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;next&#39;</span><span class="p">)</span>
</span><span id="wquantile-418"><a href="#wquantile-418"><span class="linenos">418</span></a>        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s1">&#39;midpoint&#39;</span><span class="p">:</span>
</span><span id="wquantile-419"><a href="#wquantile-419"><span class="linenos">419</span></a>            <span class="c1"># Average the lower and higher values</span>
</span><span id="wquantile-420"><a href="#wquantile-420"><span class="linenos">420</span></a>            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="wquantile-421"><a href="#wquantile-421"><span class="linenos">421</span></a>                <span class="k">return</span> <span class="p">(</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;previous&#39;</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span>
</span><span id="wquantile-422"><a href="#wquantile-422"><span class="linenos">422</span></a>                         <span class="n">interp1d</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;next&#39;</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span>     <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="wquantile-423"><a href="#wquantile-423"><span class="linenos">423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wquantile-424"><a href="#wquantile-424"><span class="linenos">424</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unrecognized value for interpolation: &#39;</span> <span class="o">+</span> <span class="n">interpolation</span><span class="p">)</span>
</span><span id="wquantile-425"><a href="#wquantile-425"><span class="linenos">425</span></a>
</span><span id="wquantile-426"><a href="#wquantile-426"><span class="linenos">426</span></a>        <span class="n">xq</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="wquantile-427"><a href="#wquantile-427"><span class="linenos">427</span></a>
</span><span id="wquantile-428"><a href="#wquantile-428"><span class="linenos">428</span></a>    <span class="k">return</span> <span class="n">xq</span>
</span></pre></div>


            <div class="docstring"><p>Weighted quantile </p>

<p>Calculate the quantile q from data array x using data weights w.
If weights reflect the relative frequency of the elements of x in a large population,
then the weighted quantile result is equivalent to numpy.quantile or numpy.percentile 
operating on an array of that larger population (containing many repeated elements).</p>

<p>For uniform weights and interpolation=partition or partition0, this function 
differs from numpy.percentile. This behavior is expected and desirable.
The numpy.percentile behaviro can be reproduced here by using 
interpolation = linear, lower, higher, or nearest.
Note that numpy.quantile is equivalent to numpy.percentile(interpolation='linear')</p>

<p>This naive algorithm is O(n) and may be slow for large samples (x).
Consider using Robustats or another optimized package.       </p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like (N,)):
values to be analyzed</li>
<li><strong>q</strong> (list (m,)):
quantiles that will be calculated, in range 0-1</li>
<li><strong>w</strong> (array_like (N,)):
weights for each element of x. 
These represent the frequency of elements x in a large population</li>
<li><strong>interpolation</strong> ({'partition' (default),'partition0','linear','nearest','lower','higher'}):
This parameter specifies the interpolation method to use when the desired quantile 
lies bewteen elements i &lt; j in x. Allowed values:
<ul>
<li>'partition': [default] choose the element of x that partitions the 
sum of weights on either side to q and (1-q)
When two elements both satisfy partition, then average them.
This is the Edgeworth method (<a href="https://en.wikipedia.org/wiki/Weighted_median"><a href="https://en.wikipedia.org/wiki/Weighted_median">https://en.wikipedia.org/wiki/Weighted_median</a></a>)</li>
<li>'partition0': Same as partition, but result is always an element of x (no averaging). 
Instead return the element of x that partitions weights most closely 
to q and (1-q) or, if there is still a tie, then the smaller element.</li>
<li>'linear'  : i + (j-1) * fraction. replicates behavior of numpy.quantile when all 
weights are equal</li>
<li>'nearest' : i or j element that most closely divides data at the q quantile</li>
<li>'lower'   : i, the largest element &lt;= the q quantile</li>
<li>'higher'  : j, the smallest element &gt;= the q quantile</li>
</ul></li>
</ul>

<h6 id="result">Result</h6>

<p>array (m,)
    weighted quantiles of x. Length is the same as input q</p>
</div>


                </section>
                <section id="wstd">
                            <input id="wstd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wstd</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">w</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">robust</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wstd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wstd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wstd-53"><a href="#wstd-53"><span class="linenos">53</span></a><span class="k">def</span> <span class="nf">wstd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="wstd-54"><a href="#wstd-54"><span class="linenos">54</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted standard deviation</span>
</span><span id="wstd-55"><a href="#wstd-55"><span class="linenos">55</span></a><span class="sd">    </span>
</span><span id="wstd-56"><a href="#wstd-56"><span class="linenos">56</span></a><span class="sd">    Calculate the standard deviation of x using weights w. If ddof=1 (default),</span>
</span><span id="wstd-57"><a href="#wstd-57"><span class="linenos">57</span></a><span class="sd">    then the result is the unbiased (sample) standard deviation when w=1.</span>
</span><span id="wstd-58"><a href="#wstd-58"><span class="linenos">58</span></a><span class="sd">    </span>
</span><span id="wstd-59"><a href="#wstd-59"><span class="linenos">59</span></a><span class="sd">    Parameters</span>
</span><span id="wstd-60"><a href="#wstd-60"><span class="linenos">60</span></a><span class="sd">    ----------</span>
</span><span id="wstd-61"><a href="#wstd-61"><span class="linenos">61</span></a><span class="sd">    x : array_like </span>
</span><span id="wstd-62"><a href="#wstd-62"><span class="linenos">62</span></a><span class="sd">        values to be analyzed</span>
</span><span id="wstd-63"><a href="#wstd-63"><span class="linenos">63</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="wstd-64"><a href="#wstd-64"><span class="linenos">64</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="wstd-65"><a href="#wstd-65"><span class="linenos">65</span></a><span class="sd">    ddof : int, default=1</span>
</span><span id="wstd-66"><a href="#wstd-66"><span class="linenos">66</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="wstd-67"><a href="#wstd-67"><span class="linenos">67</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="wstd-68"><a href="#wstd-68"><span class="linenos">68</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="wstd-69"><a href="#wstd-69"><span class="linenos">69</span></a><span class="sd">        ignored if w is used</span>
</span><span id="wstd-70"><a href="#wstd-70"><span class="linenos">70</span></a><span class="sd">        </span>
</span><span id="wstd-71"><a href="#wstd-71"><span class="linenos">71</span></a><span class="sd">    Returns</span>
</span><span id="wstd-72"><a href="#wstd-72"><span class="linenos">72</span></a><span class="sd">    -------</span>
</span><span id="wstd-73"><a href="#wstd-73"><span class="linenos">73</span></a><span class="sd">    float</span>
</span><span id="wstd-74"><a href="#wstd-74"><span class="linenos">74</span></a><span class="sd">        weighted standard deviation of x </span>
</span><span id="wstd-75"><a href="#wstd-75"><span class="linenos">75</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wstd-76"><a href="#wstd-76"><span class="linenos">76</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wstd-77"><a href="#wstd-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="wstd-78"><a href="#wstd-78"><span class="linenos">78</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="wstd-79"><a href="#wstd-79"><span class="linenos">79</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="wstd-80"><a href="#wstd-80"><span class="linenos">80</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wstd-81"><a href="#wstd-81"><span class="linenos">81</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="wstd-82"><a href="#wstd-82"><span class="linenos">82</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wstd-83"><a href="#wstd-83"><span class="linenos">83</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="wstd-84"><a href="#wstd-84"><span class="linenos">84</span></a>
</span><span id="wstd-85"><a href="#wstd-85"><span class="linenos">85</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">ddof</span><span class="p">,</span><span class="n">robust</span><span class="p">)</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Weighted standard deviation</p>

<p>Calculate the standard deviation of x using weights w. If ddof=1 (default),
then the result is the unbiased (sample) standard deviation when w=1.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like):
values to be analyzed</li>
<li><strong>w</strong> (array_like, default=None):
weights for each element of x; can be ommitted if robust=True</li>
<li><strong>ddof</strong> (int, default=1):
differential degrees of freedom. See note above.</li>
<li><strong>robust</strong> (bool, default=False):
if robust=True, weights will be internally calculated using FastMCD;
ignored if w is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: weighted standard deviation of x</li>
</ul>
</div>


                </section>
                <section id="wvar">
                            <input id="wvar-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wvar</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">w</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">robust</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wvar-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wvar"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wvar-87"><a href="#wvar-87"><span class="linenos"> 87</span></a><span class="k">def</span> <span class="nf">wvar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="wvar-88"><a href="#wvar-88"><span class="linenos"> 88</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Weighted variance </span>
</span><span id="wvar-89"><a href="#wvar-89"><span class="linenos"> 89</span></a><span class="sd">    </span>
</span><span id="wvar-90"><a href="#wvar-90"><span class="linenos"> 90</span></a><span class="sd">    Calculate the variance of x using weights w. If ddof=1 (default),</span>
</span><span id="wvar-91"><a href="#wvar-91"><span class="linenos"> 91</span></a><span class="sd">    then the result is the unbiased (sample) variance when w=1.</span>
</span><span id="wvar-92"><a href="#wvar-92"><span class="linenos"> 92</span></a><span class="sd">    </span>
</span><span id="wvar-93"><a href="#wvar-93"><span class="linenos"> 93</span></a><span class="sd">    Parameters</span>
</span><span id="wvar-94"><a href="#wvar-94"><span class="linenos"> 94</span></a><span class="sd">    ----------</span>
</span><span id="wvar-95"><a href="#wvar-95"><span class="linenos"> 95</span></a><span class="sd">    x : array_like </span>
</span><span id="wvar-96"><a href="#wvar-96"><span class="linenos"> 96</span></a><span class="sd">        values to be analyzed</span>
</span><span id="wvar-97"><a href="#wvar-97"><span class="linenos"> 97</span></a><span class="sd">    w : array_like, default=None</span>
</span><span id="wvar-98"><a href="#wvar-98"><span class="linenos"> 98</span></a><span class="sd">        weights for each element of x; can be ommitted if robust=True</span>
</span><span id="wvar-99"><a href="#wvar-99"><span class="linenos"> 99</span></a><span class="sd">    ddof : int, default=1</span>
</span><span id="wvar-100"><a href="#wvar-100"><span class="linenos">100</span></a><span class="sd">        differential degrees of freedom. See note above.</span>
</span><span id="wvar-101"><a href="#wvar-101"><span class="linenos">101</span></a><span class="sd">    robust : bool, default=False</span>
</span><span id="wvar-102"><a href="#wvar-102"><span class="linenos">102</span></a><span class="sd">        if robust=True, weights will be internally calculated using FastMCD;</span>
</span><span id="wvar-103"><a href="#wvar-103"><span class="linenos">103</span></a><span class="sd">        ignored if w is used</span>
</span><span id="wvar-104"><a href="#wvar-104"><span class="linenos">104</span></a><span class="sd">        </span>
</span><span id="wvar-105"><a href="#wvar-105"><span class="linenos">105</span></a><span class="sd">    Returns</span>
</span><span id="wvar-106"><a href="#wvar-106"><span class="linenos">106</span></a><span class="sd">    -------</span>
</span><span id="wvar-107"><a href="#wvar-107"><span class="linenos">107</span></a><span class="sd">    float</span>
</span><span id="wvar-108"><a href="#wvar-108"><span class="linenos">108</span></a><span class="sd">        weighted variance of x </span>
</span><span id="wvar-109"><a href="#wvar-109"><span class="linenos">109</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="wvar-110"><a href="#wvar-110"><span class="linenos">110</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wvar-111"><a href="#wvar-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="wvar-112"><a href="#wvar-112"><span class="linenos">112</span></a>            <span class="c1"># Use FastMCD to calculate weights; Another method could be used here</span>
</span><span id="wvar-113"><a href="#wvar-113"><span class="linenos">113</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">MinCovDet</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span><span class="o">.</span><span class="n">support_</span>
</span><span id="wvar-114"><a href="#wvar-114"><span class="linenos">114</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="wvar-115"><a href="#wvar-115"><span class="linenos">115</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify weights w or select robust=True&#39;</span><span class="p">)</span>
</span><span id="wvar-116"><a href="#wvar-116"><span class="linenos">116</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wvar-117"><a href="#wvar-117"><span class="linenos">117</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;w must be the same length as x&#39;</span>
</span><span id="wvar-118"><a href="#wvar-118"><span class="linenos">118</span></a>
</span><span id="wvar-119"><a href="#wvar-119"><span class="linenos">119</span></a>    <span class="k">return</span> <span class="n">wcov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">ddof</span><span class="p">,</span><span class="n">robust</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Weighted variance </p>

<p>Calculate the variance of x using weights w. If ddof=1 (default),
then the result is the unbiased (sample) variance when w=1.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like):
values to be analyzed</li>
<li><strong>w</strong> (array_like, default=None):
weights for each element of x; can be ommitted if robust=True</li>
<li><strong>ddof</strong> (int, default=1):
differential degrees of freedom. See note above.</li>
<li><strong>robust</strong> (bool, default=False):
if robust=True, weights will be internally calculated using FastMCD;
ignored if w is used</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: weighted variance of x</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>